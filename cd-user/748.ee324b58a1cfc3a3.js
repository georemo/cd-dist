(self.webpackChunkcd_user=self.webpackChunkcd_user||[]).push([[748],{2090:(pr,ft,he)=>{he.d(ft,{BH:()=>an,G6:()=>Mt,L:()=>S,LL:()=>cn,Pz:()=>nt,Sg:()=>Ln,UG:()=>ie,ZB:()=>B,ZR:()=>Qt,aH:()=>le,b$:()=>Kt,eu:()=>Bn,hl:()=>_r,jU:()=>At,m9:()=>Rr,ne:()=>xt,pd:()=>Gn,r3:()=>li,ru:()=>mt,tV:()=>P,uI:()=>at,vZ:()=>Er,w1:()=>un,xO:()=>Tr,xb:()=>fn,z$:()=>ce,zd:()=>Rt});const se=function(f){const d=[];let g=0;for(let A=0;A<f.length;A++){let E=f.charCodeAt(A);E<128?d[g++]=E:E<2048?(d[g++]=E>>6|192,d[g++]=63&E|128):55296==(64512&E)&&A+1<f.length&&56320==(64512&f.charCodeAt(A+1))?(E=65536+((1023&E)<<10)+(1023&f.charCodeAt(++A)),d[g++]=E>>18|240,d[g++]=E>>12&63|128,d[g++]=E>>6&63|128,d[g++]=63&E|128):(d[g++]=E>>12|224,d[g++]=E>>6&63|128,d[g++]=63&E|128)}return d},Q={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(f,d){if(!Array.isArray(f))throw Error("encodeByteArray takes an array as a parameter");this.init_();const g=d?this.byteToCharMapWebSafe_:this.byteToCharMap_,A=[];for(let E=0;E<f.length;E+=3){const O=f[E],K=E+1<f.length,Ee=K?f[E+1]:0,Ke=E+2<f.length,ze=Ke?f[E+2]:0;let Et=(15&Ee)<<2|ze>>6,Pt=63&ze;Ke||(Pt=64,K||(Et=64)),A.push(g[O>>2],g[(3&O)<<4|Ee>>4],g[Et],g[Pt])}return A.join("")},encodeString(f,d){return this.HAS_NATIVE_SUPPORT&&!d?btoa(f):this.encodeByteArray(se(f),d)},decodeString(f,d){return this.HAS_NATIVE_SUPPORT&&!d?atob(f):function(f){const d=[];let g=0,A=0;for(;g<f.length;){const E=f[g++];if(E<128)d[A++]=String.fromCharCode(E);else if(E>191&&E<224){const O=f[g++];d[A++]=String.fromCharCode((31&E)<<6|63&O)}else if(E>239&&E<365){const Ke=((7&E)<<18|(63&f[g++])<<12|(63&f[g++])<<6|63&f[g++])-65536;d[A++]=String.fromCharCode(55296+(Ke>>10)),d[A++]=String.fromCharCode(56320+(1023&Ke))}else{const O=f[g++],K=f[g++];d[A++]=String.fromCharCode((15&E)<<12|(63&O)<<6|63&K)}}return d.join("")}(this.decodeStringToByteArray(f,d))},decodeStringToByteArray(f,d){this.init_();const g=d?this.charToByteMapWebSafe_:this.charToByteMap_,A=[];for(let E=0;E<f.length;){const O=g[f.charAt(E++)],Ee=E<f.length?g[f.charAt(E)]:0;++E;const ze=E<f.length?g[f.charAt(E)]:64;++E;const oe=E<f.length?g[f.charAt(E)]:64;if(++E,null==O||null==Ee||null==ze||null==oe)throw new $e;A.push(O<<2|Ee>>4),64!==ze&&(A.push(Ee<<4&240|ze>>2),64!==oe&&A.push(ze<<6&192|oe))}return A},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let f=0;f<this.ENCODED_VALS.length;f++)this.byteToCharMap_[f]=this.ENCODED_VALS.charAt(f),this.charToByteMap_[this.byteToCharMap_[f]]=f,this.byteToCharMapWebSafe_[f]=this.ENCODED_VALS_WEBSAFE.charAt(f),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[f]]=f,f>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(f)]=f,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(f)]=f)}}};class $e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const S=function(f){return function(f){const d=se(f);return Q.encodeByteArray(d,!0)}(f).replace(/\./g,"")},P=function(f){try{return Q.decodeString(f,!0)}catch(d){console.error("base64Decode failed: ",d)}return null};function B(f,d){if(!(d instanceof Object))return d;switch(d.constructor){case Date:return new Date(d.getTime());case Object:void 0===f&&(f={});break;case Array:f=[];break;default:return d}for(const g in d)!d.hasOwnProperty(g)||!H(g)||(f[g]=B(f[g],d[g]));return f}function H(f){return"__proto__"!==f}const J=()=>{try{return function _e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const f=process.env.__FIREBASE_DEFAULTS__;return f?JSON.parse(f):void 0})()||(()=>{if(typeof document>"u")return;let f;try{f=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const d=f&&P(f[1]);return d&&JSON.parse(d)})()}catch(f){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${f}`)}},le=()=>{var f;return null===(f=J())||void 0===f?void 0:f.config},nt=f=>{var d;return null===(d=J())||void 0===d?void 0:d[`_${f}`]};class an{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((d,g)=>{this.resolve=d,this.reject=g})}wrapCallback(d){return(g,A)=>{g?this.reject(g):this.resolve(A),"function"==typeof d&&(this.promise.catch(()=>{}),1===d.length?d(g):d(g,A))}}}function Ln(f,d){if(f.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const A=d||"demo-project",E=f.iat||0,O=f.sub||f.user_id;if(!O)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const K=Object.assign({iss:`https://securetoken.google.com/${A}`,aud:A,iat:E,exp:E+3600,auth_time:E,sub:O,user_id:O,firebase:{sign_in_provider:"custom",identities:{}}},f);return[S(JSON.stringify({alg:"none",type:"JWT"})),S(JSON.stringify(K)),""].join(".")}function ce(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function at(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ce())}function ie(){var f;const d=null===(f=J())||void 0===f?void 0:f.forceEnvironment;if("node"===d)return!0;if("browser"===d)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}function At(){return"object"==typeof self&&self.self===self}function mt(){const f="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof f&&void 0!==f.id}function Kt(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function un(){const f=ce();return f.indexOf("MSIE ")>=0||f.indexOf("Trident/")>=0}function Mt(){return!ie()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _r(){try{return"object"==typeof indexedDB}catch{return!1}}function Bn(){return new Promise((f,d)=>{try{let g=!0;const A="validate-browser-context-for-indexeddb-analytics-module",E=self.indexedDB.open(A);E.onsuccess=()=>{E.result.close(),g||self.indexedDB.deleteDatabase(A),f(!0)},E.onupgradeneeded=()=>{g=!1},E.onerror=()=>{var O;d((null===(O=E.error)||void 0===O?void 0:O.message)||"")}}catch(g){d(g)}})}class Qt extends Error{constructor(d,g,A){super(g),this.code=d,this.customData=A,this.name="FirebaseError",Object.setPrototypeOf(this,Qt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cn.prototype.create)}}class cn{constructor(d,g,A){this.service=d,this.serviceName=g,this.errors=A}create(d,...g){const A=g[0]||{},E=`${this.service}/${d}`,O=this.errors[d],K=O?function Un(f,d){return f.replace(qn,(g,A)=>{const E=d[A];return null!=E?String(E):`<${A}?>`})}(O,A):"Error";return new Qt(E,`${this.serviceName}: ${K} (${E}).`,A)}}const qn=/\{\$([^}]+)}/g;function li(f,d){return Object.prototype.hasOwnProperty.call(f,d)}function fn(f){for(const d in f)if(Object.prototype.hasOwnProperty.call(f,d))return!1;return!0}function Er(f,d){if(f===d)return!0;const g=Object.keys(f),A=Object.keys(d);for(const E of g){if(!A.includes(E))return!1;const O=f[E],K=d[E];if(zn(O)&&zn(K)){if(!Er(O,K))return!1}else if(O!==K)return!1}for(const E of A)if(!g.includes(E))return!1;return!0}function zn(f){return null!==f&&"object"==typeof f}function Tr(f){const d=[];for(const[g,A]of Object.entries(f))Array.isArray(A)?A.forEach(E=>{d.push(encodeURIComponent(g)+"="+encodeURIComponent(E))}):d.push(encodeURIComponent(g)+"="+encodeURIComponent(A));return d.length?"&"+d.join("&"):""}function Rt(f){const d={};return f.replace(/^\?/,"").split("&").forEach(A=>{if(A){const[E,O]=A.split("=");d[decodeURIComponent(E)]=decodeURIComponent(O)}}),d}function Gn(f){const d=f.indexOf("?");if(!d)return"";const g=f.indexOf("#",d);return f.substring(d,g>0?g:void 0)}function xt(f,d){const g=new mn(f,d);return g.subscribe.bind(g)}class mn{constructor(d,g){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=g,this.task.then(()=>{d(this)}).catch(A=>{this.error(A)})}next(d){this.forEachObserver(g=>{g.next(d)})}error(d){this.forEachObserver(g=>{g.error(d)}),this.close(d)}complete(){this.forEachObserver(d=>{d.complete()}),this.close()}subscribe(d,g,A){let E;if(void 0===d&&void 0===g&&void 0===A)throw new Error("Missing Observer.");E=function Ht(f,d){if("object"!=typeof f||null===f)return!1;for(const g of d)if(g in f&&"function"==typeof f[g])return!0;return!1}(d,["next","error","complete"])?d:{next:d,error:g,complete:A},void 0===E.next&&(E.next=gn),void 0===E.error&&(E.error=gn),void 0===E.complete&&(E.complete=gn);const O=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?E.error(this.finalError):E.complete()}catch{}}),this.observers.push(E),O}unsubscribeOne(d){void 0===this.observers||void 0===this.observers[d]||(delete this.observers[d],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(d){if(!this.finalized)for(let g=0;g<this.observers.length;g++)this.sendOne(g,d)}sendOne(d,g){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[d])try{g(this.observers[d])}catch(A){typeof console<"u"&&console.error&&console.error(A)}})}close(d){this.finalized||(this.finalized=!0,void 0!==d&&(this.finalError=d),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function gn(){}function Rr(f){return f&&f._delegate?f._delegate:f}},3942:(pr,ft,he)=>{he.d(ft,{Z:()=>Ze});var ne=he(2090),p=he(4859),re=he(6881),se=he(1877);class Me{constructor(Y,J){this._delegate=Y,this.firebase=J,(0,re._addComponent)(Y,new p.wA("app-compat",()=>this,"PUBLIC")),this.container=Y.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(Y){this._delegate.automaticDataCollectionEnabled=Y}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(Y=>{this._delegate.checkDestroyed(),Y()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,re.deleteApp)(this._delegate)))}_getService(Y,J=re._DEFAULT_ENTRY_NAME){var ye;this._delegate.checkDestroyed();const tt=this._delegate.container.getProvider(Y);return!tt.isInitialized()&&"EXPLICIT"===(null===(ye=tt.getComponent())||void 0===ye?void 0:ye.instantiationMode)&&tt.initialize(),tt.getImmediate({identifier:J})}_removeServiceInstance(Y,J=re._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(Y).clearInstance(J)}_addComponent(Y){(0,re._addComponent)(this._delegate,Y)}_addOrOverwriteComponent(Y){(0,re._addOrOverwriteComponent)(this._delegate,Y)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const $e=new ne.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),P=function S(){const ve=function Ie(ve){const Y={},J={__esModule:!0,initializeApp:function le(ce,at={}){const ie=re.initializeApp(ce,at);if((0,ne.r3)(Y,ie.name))return Y[ie.name];const At=new ve(ie,J);return Y[ie.name]=At,At},app:tt,registerVersion:re.registerVersion,setLogLevel:re.setLogLevel,onLog:re.onLog,apps:null,SDK_VERSION:re.SDK_VERSION,INTERNAL:{registerComponent:function an(ce){const at=ce.name,ie=at.replace("-compat","");if(re._registerComponent(ce)&&"PUBLIC"===ce.type){const At=(mt=tt())=>{if("function"!=typeof mt[ie])throw $e.create("invalid-app-argument",{appName:at});return mt[ie]()};void 0!==ce.serviceProps&&(0,ne.ZB)(At,ce.serviceProps),J[ie]=At,ve.prototype[ie]=function(...mt){return this._getService.bind(this,at).apply(this,ce.multipleInstances?mt:[])}}return"PUBLIC"===ce.type?J[ie]:null},removeApp:function ye(ce){delete Y[ce]},useAsService:function Ln(ce,at){return"serverAuth"===at?null:at},modularAPIs:re}};function tt(ce){if(!(0,ne.r3)(Y,ce=ce||re._DEFAULT_ENTRY_NAME))throw $e.create("no-app",{appName:ce});return Y[ce]}return J.default=J,Object.defineProperty(J,"apps",{get:function nt(){return Object.keys(Y).map(ce=>Y[ce])}}),tt.App=ve,J}(Me);return ve.INTERNAL=Object.assign(Object.assign({},ve.INTERNAL),{createFirebaseNamespace:S,extendNamespace:function Y(J){(0,ne.ZB)(ve,J)},createSubscribe:ne.ne,ErrorFactory:ne.LL,deepExtend:ne.ZB}),ve}(),v=new se.Yd("@firebase/app-compat");if((0,ne.jU)()&&void 0!==self.firebase){v.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const ve=self.firebase.SDK_VERSION;ve&&ve.indexOf("LITE")>=0&&v.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Ze=P;!function _e(ve){(0,re.registerVersion)("@firebase/app-compat","0.2.14",ve)}()},6881:(pr,ft,he)=>{he.r(ft),he.d(ft,{FirebaseError:()=>se.ZR,SDK_VERSION:()=>wr,_DEFAULT_ENTRY_NAME:()=>Rt,_addComponent:()=>mn,_addOrOverwriteComponent:()=>di,_apps:()=>yt,_clearComponents:()=>pn,_components:()=>xt,_getProvider:()=>gn,_registerComponent:()=>Ht,_removeServiceInstance:()=>fi,deleteApp:()=>Oe,getApp:()=>Ar,getApps:()=>xe,initializeApp:()=>jn,onLog:()=>Ps,registerVersion:()=>Ft,setLogLevel:()=>Ss});var ne=he(5861),p=he(4859),re=he(1877),se=he(2090);let Q,$e;const P=new WeakMap,v=new WeakMap,B=new WeakMap,H=new WeakMap,_e=new WeakMap;let Y={get(w,y,V){if(w instanceof IDBTransaction){if("done"===y)return v.get(w);if("objectStoreNames"===y)return w.objectStoreNames||B.get(w);if("store"===y)return V.objectStoreNames[1]?void 0:V.objectStore(V.objectStoreNames[0])}return le(w[y])},set:(w,y,V)=>(w[y]=V,!0),has:(w,y)=>w instanceof IDBTransaction&&("done"===y||"store"===y)||y in w};function tt(w){return"function"==typeof w?function ye(w){return w!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function S(){return $e||($e=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(w)?function(...y){return w.apply(nt(this),y),le(P.get(this))}:function(...y){return le(w.apply(nt(this),y))}:function(y,...V){const U=w.call(nt(this),y,...V);return B.set(U,y.sort?y.sort():[y]),le(U)}}(w):(w instanceof IDBTransaction&&function ve(w){if(v.has(w))return;const y=new Promise((V,U)=>{const G=()=>{w.removeEventListener("complete",Z),w.removeEventListener("error",ge),w.removeEventListener("abort",ge)},Z=()=>{V(),G()},ge=()=>{U(w.error||new DOMException("AbortError","AbortError")),G()};w.addEventListener("complete",Z),w.addEventListener("error",ge),w.addEventListener("abort",ge)});v.set(w,y)}(w),((w,y)=>y.some(V=>w instanceof V))(w,function Ie(){return Q||(Q=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(w,Y):w)}function le(w){if(w instanceof IDBRequest)return function Ze(w){const y=new Promise((V,U)=>{const G=()=>{w.removeEventListener("success",Z),w.removeEventListener("error",ge)},Z=()=>{V(le(w.result)),G()},ge=()=>{U(w.error),G()};w.addEventListener("success",Z),w.addEventListener("error",ge)});return y.then(V=>{V instanceof IDBCursor&&P.set(V,w)}).catch(()=>{}),_e.set(y,w),y}(w);if(H.has(w))return H.get(w);const y=tt(w);return y!==w&&(H.set(w,y),_e.set(y,w)),y}const nt=w=>_e.get(w),ce=["get","getKey","getAll","getAllKeys","count"],at=["put","add","delete","clear"],ie=new Map;function At(w,y){if(!(w instanceof IDBDatabase)||y in w||"string"!=typeof y)return;if(ie.get(y))return ie.get(y);const V=y.replace(/FromIndex$/,""),U=y!==V,G=at.includes(V);if(!(V in(U?IDBIndex:IDBObjectStore).prototype)||!G&&!ce.includes(V))return;const Z=function(){var ge=(0,ne.Z)(function*(Ce,...Ue){const Ct=this.transaction(Ce,G?"readwrite":"readonly");let Pr=Ct.store;return U&&(Pr=Pr.index(Ue.shift())),(yield Promise.all([Pr[V](...Ue),G&&Ct.done]))[0]});return function(Ue){return ge.apply(this,arguments)}}();return ie.set(y,Z),Z}!function J(w){Y=w(Y)}(w=>({...w,get:(y,V,U)=>At(y,V)||w.get(y,V,U),has:(y,V)=>!!At(y,V)||w.has(y,V)}));class mt{constructor(y){this.container=y}getPlatformInfoString(){return this.container.getProviders().map(V=>{if(function Kt(w){return"VERSION"===w.getComponent()?.type}(V)){const U=V.getImmediate();return`${U.library}/${U.version}`}return null}).filter(V=>V).join(" ")}}const ut="@firebase/app",kt=new re.Yd("@firebase/app"),Rt="[DEFAULT]",Gn={[ut]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},yt=new Map,xt=new Map;function mn(w,y){try{w.container.addComponent(y)}catch(V){kt.debug(`Component ${y.name} failed to register with FirebaseApp ${w.name}`,V)}}function di(w,y){w.container.addOrOverwriteComponent(y)}function Ht(w){const y=w.name;if(xt.has(y))return kt.debug(`There were multiple attempts to register component ${y}.`),!1;xt.set(y,w);for(const V of yt.values())mn(V,w);return!0}function gn(w,y){const V=w.container.getProvider("heartbeat").getImmediate({optional:!0});return V&&V.triggerHeartbeat(),w.container.getProvider(y)}function fi(w,y,V=Rt){gn(w,y).clearInstance(V)}function pn(){xt.clear()}const It=new se.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Rs{constructor(y,V,U){this._isDeleted=!1,this._options=Object.assign({},y),this._config=Object.assign({},V),this._name=V.name,this._automaticDataCollectionEnabled=V.automaticDataCollectionEnabled,this._container=U,this.container.addComponent(new p.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(y){this.checkDestroyed(),this._automaticDataCollectionEnabled=y}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(y){this._isDeleted=y}checkDestroyed(){if(this.isDeleted)throw It.create("app-deleted",{appName:this._name})}}const wr="10.0.0";function jn(w,y={}){let V=w;"object"!=typeof y&&(y={name:y});const U=Object.assign({name:Rt,automaticDataCollectionEnabled:!1},y),G=U.name;if("string"!=typeof G||!G)throw It.create("bad-app-name",{appName:String(G)});if(V||(V=(0,se.aH)()),!V)throw It.create("no-options");const Z=yt.get(G);if(Z){if((0,se.vZ)(V,Z.options)&&(0,se.vZ)(U,Z.config))return Z;throw It.create("duplicate-app",{appName:G})}const ge=new p.H0(G);for(const Ue of xt.values())ge.addComponent(Ue);const Ce=new Rs(V,U,ge);return yt.set(G,Ce),Ce}function Ar(w=Rt){const y=yt.get(w);if(!y&&w===Rt&&(0,se.aH)())return jn();if(!y)throw It.create("no-app",{appName:w});return y}function xe(){return Array.from(yt.values())}function Oe(w){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,ne.Z)(function*(w){const y=w.name;yt.has(y)&&(yt.delete(y),yield Promise.all(w.container.getProviders().map(V=>V.delete())),w.isDeleted=!0)})).apply(this,arguments)}function Ft(w,y,V){var U;let G=null!==(U=Gn[w])&&void 0!==U?U:w;V&&(G+=`-${V}`);const Z=G.match(/\s|\//),ge=y.match(/\s|\//);if(Z||ge){const Ce=[`Unable to register library "${G}" with version "${y}":`];return Z&&Ce.push(`library name "${G}" contains illegal characters (whitespace or "/")`),Z&&ge&&Ce.push("and"),ge&&Ce.push(`version name "${y}" contains illegal characters (whitespace or "/")`),void kt.warn(Ce.join(" "))}Ht(new p.wA(`${G}-version`,()=>({library:G,version:y}),"VERSION"))}function Ps(w,y){if(null!==w&&"function"!=typeof w)throw It.create("invalid-log-argument");(0,re.Am)(w,y)}function Ss(w){(0,re.Ub)(w)}const f="firebase-heartbeat-store";let d=null;function g(){return d||(d=function an(w,y,{blocked:V,upgrade:U,blocking:G,terminated:Z}={}){const ge=indexedDB.open(w,y),Ce=le(ge);return U&&ge.addEventListener("upgradeneeded",Ue=>{U(le(ge.result),Ue.oldVersion,Ue.newVersion,le(ge.transaction),Ue)}),V&&ge.addEventListener("blocked",Ue=>V(Ue.oldVersion,Ue.newVersion,Ue)),Ce.then(Ue=>{Z&&Ue.addEventListener("close",()=>Z()),G&&Ue.addEventListener("versionchange",Ct=>G(Ct.oldVersion,Ct.newVersion,Ct))}).catch(()=>{}),Ce}("firebase-heartbeat-database",1,{upgrade:(w,y)=>{0===y&&w.createObjectStore(f)}}).catch(w=>{throw It.create("idb-open",{originalErrorMessage:w.message})})),d}function E(){return(E=(0,ne.Z)(function*(w){try{return yield(yield g()).transaction(f).objectStore(f).get(Ee(w))}catch(y){if(y instanceof se.ZR)kt.warn(y.message);else{const V=It.create("idb-get",{originalErrorMessage:y?.message});kt.warn(V.message)}}})).apply(this,arguments)}function O(w,y){return K.apply(this,arguments)}function K(){return(K=(0,ne.Z)(function*(w,y){try{const U=(yield g()).transaction(f,"readwrite");yield U.objectStore(f).put(y,Ee(w)),yield U.done}catch(V){if(V instanceof se.ZR)kt.warn(V.message);else{const U=It.create("idb-set",{originalErrorMessage:V?.message});kt.warn(U.message)}}})).apply(this,arguments)}function Ee(w){return`${w.name}!${w.options.appId}`}class gt{constructor(y){this.container=y,this._heartbeatsCache=null;const V=this.container.getProvider("app").getImmediate();this._storage=new Pt(V),this._heartbeatsCachePromise=this._storage.read().then(U=>(this._heartbeatsCache=U,U))}triggerHeartbeat(){var y=this;return(0,ne.Z)(function*(){const U=y.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),G=oe();if(null===y._heartbeatsCache&&(y._heartbeatsCache=yield y._heartbeatsCachePromise),y._heartbeatsCache.lastSentHeartbeatDate!==G&&!y._heartbeatsCache.heartbeats.some(Z=>Z.date===G))return y._heartbeatsCache.heartbeats.push({date:G,agent:U}),y._heartbeatsCache.heartbeats=y._heartbeatsCache.heartbeats.filter(Z=>{const ge=new Date(Z.date).valueOf();return Date.now()-ge<=2592e6}),y._storage.overwrite(y._heartbeatsCache)})()}getHeartbeatsHeader(){var y=this;return(0,ne.Z)(function*(){if(null===y._heartbeatsCache&&(yield y._heartbeatsCachePromise),null===y._heartbeatsCache||0===y._heartbeatsCache.heartbeats.length)return"";const V=oe(),{heartbeatsToSend:U,unsentEntries:G}=function Et(w,y=1024){const V=[];let U=w.slice();for(const G of w){const Z=V.find(ge=>ge.agent===G.agent);if(Z){if(Z.dates.push(G.date),$n(V)>y){Z.dates.pop();break}}else if(V.push({agent:G.agent,dates:[G.date]}),$n(V)>y){V.pop();break}U=U.slice(1)}return{heartbeatsToSend:V,unsentEntries:U}}(y._heartbeatsCache.heartbeats),Z=(0,se.L)(JSON.stringify({version:2,heartbeats:U}));return y._heartbeatsCache.lastSentHeartbeatDate=V,G.length>0?(y._heartbeatsCache.heartbeats=G,yield y._storage.overwrite(y._heartbeatsCache)):(y._heartbeatsCache.heartbeats=[],y._storage.overwrite(y._heartbeatsCache)),Z})()}}function oe(){return(new Date).toISOString().substring(0,10)}class Pt{constructor(y){this.app=y,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,ne.Z)(function*(){return!!(0,se.hl)()&&(0,se.eu)().then(()=>!0).catch(()=>!1)})()}read(){var y=this;return(0,ne.Z)(function*(){return(yield y._canUseIndexedDBPromise)&&(yield function A(w){return E.apply(this,arguments)}(y.app))||{heartbeats:[]}})()}overwrite(y){var V=this;return(0,ne.Z)(function*(){var U;if(yield V._canUseIndexedDBPromise){const Z=yield V.read();return O(V.app,{lastSentHeartbeatDate:null!==(U=y.lastSentHeartbeatDate)&&void 0!==U?U:Z.lastSentHeartbeatDate,heartbeats:y.heartbeats})}})()}add(y){var V=this;return(0,ne.Z)(function*(){var U;if(yield V._canUseIndexedDBPromise){const Z=yield V.read();return O(V.app,{lastSentHeartbeatDate:null!==(U=y.lastSentHeartbeatDate)&&void 0!==U?U:Z.lastSentHeartbeatDate,heartbeats:[...Z.heartbeats,...y.heartbeats]})}})()}}function $n(w){return(0,se.L)(JSON.stringify({version:2,heartbeats:w})).length}!function bs(w){Ht(new p.wA("platform-logger",y=>new mt(y),"PRIVATE")),Ht(new p.wA("heartbeat",y=>new gt(y),"PRIVATE")),Ft(ut,"0.9.14",w),Ft(ut,"0.9.14","esm2017"),Ft("fire-js","")}("")},4859:(pr,ft,he)=>{he.d(ft,{H0:()=>Ie,wA:()=>re});var ne=he(5861),p=he(2090);class re{constructor(P,v,B){this.name=P,this.instanceFactory=v,this.type=B,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(P){return this.instantiationMode=P,this}setMultipleInstances(P){return this.multipleInstances=P,this}setServiceProps(P){return this.serviceProps=P,this}setInstanceCreatedCallback(P){return this.onInstanceCreated=P,this}}const se="[DEFAULT]";class Me{constructor(P,v){this.name=P,this.container=v,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(P){const v=this.normalizeInstanceIdentifier(P);if(!this.instancesDeferred.has(v)){const B=new p.BH;if(this.instancesDeferred.set(v,B),this.isInitialized(v)||this.shouldAutoInitialize())try{const H=this.getOrInitializeService({instanceIdentifier:v});H&&B.resolve(H)}catch{}}return this.instancesDeferred.get(v).promise}getImmediate(P){var v;const B=this.normalizeInstanceIdentifier(P?.identifier),H=null!==(v=P?.optional)&&void 0!==v&&v;if(!this.isInitialized(B)&&!this.shouldAutoInitialize()){if(H)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:B})}catch(_e){if(H)return null;throw _e}}getComponent(){return this.component}setComponent(P){if(P.name!==this.name)throw Error(`Mismatching Component ${P.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=P,this.shouldAutoInitialize()){if(function $e(S){return"EAGER"===S.instantiationMode}(P))try{this.getOrInitializeService({instanceIdentifier:se})}catch{}for(const[v,B]of this.instancesDeferred.entries()){const H=this.normalizeInstanceIdentifier(v);try{const _e=this.getOrInitializeService({instanceIdentifier:H});B.resolve(_e)}catch{}}}}clearInstance(P=se){this.instancesDeferred.delete(P),this.instancesOptions.delete(P),this.instances.delete(P)}delete(){var P=this;return(0,ne.Z)(function*(){const v=Array.from(P.instances.values());yield Promise.all([...v.filter(B=>"INTERNAL"in B).map(B=>B.INTERNAL.delete()),...v.filter(B=>"_delete"in B).map(B=>B._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(P=se){return this.instances.has(P)}getOptions(P=se){return this.instancesOptions.get(P)||{}}initialize(P={}){const{options:v={}}=P,B=this.normalizeInstanceIdentifier(P.instanceIdentifier);if(this.isInitialized(B))throw Error(`${this.name}(${B}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const H=this.getOrInitializeService({instanceIdentifier:B,options:v});for(const[_e,Ze]of this.instancesDeferred.entries())B===this.normalizeInstanceIdentifier(_e)&&Ze.resolve(H);return H}onInit(P,v){var B;const H=this.normalizeInstanceIdentifier(v),_e=null!==(B=this.onInitCallbacks.get(H))&&void 0!==B?B:new Set;_e.add(P),this.onInitCallbacks.set(H,_e);const Ze=this.instances.get(H);return Ze&&P(Ze,H),()=>{_e.delete(P)}}invokeOnInitCallbacks(P,v){const B=this.onInitCallbacks.get(v);if(B)for(const H of B)try{H(P,v)}catch{}}getOrInitializeService({instanceIdentifier:P,options:v={}}){let B=this.instances.get(P);if(!B&&this.component&&(B=this.component.instanceFactory(this.container,{instanceIdentifier:(S=P,S===se?void 0:S),options:v}),this.instances.set(P,B),this.instancesOptions.set(P,v),this.invokeOnInitCallbacks(B,P),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,P,B)}catch{}var S;return B||null}normalizeInstanceIdentifier(P=se){return this.component?this.component.multipleInstances?P:se:P}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Ie{constructor(P){this.name=P,this.providers=new Map}addComponent(P){const v=this.getProvider(P.name);if(v.isComponentSet())throw new Error(`Component ${P.name} has already been registered with ${this.name}`);v.setComponent(P)}addOrOverwriteComponent(P){this.getProvider(P.name).isComponentSet()&&this.providers.delete(P.name),this.addComponent(P)}getProvider(P){if(this.providers.has(P))return this.providers.get(P);const v=new Me(P,this);return this.providers.set(P,v),v}getProviders(){return Array.from(this.providers.values())}}},1877:(pr,ft,he)=>{he.d(ft,{Am:()=>S,Ub:()=>Ie,Yd:()=>$e,in:()=>p});const ne=[];var p=(()=>{return(P=p||(p={}))[P.DEBUG=0]="DEBUG",P[P.VERBOSE=1]="VERBOSE",P[P.INFO=2]="INFO",P[P.WARN=3]="WARN",P[P.ERROR=4]="ERROR",P[P.SILENT=5]="SILENT",p;var P})();const re={debug:p.DEBUG,verbose:p.VERBOSE,info:p.INFO,warn:p.WARN,error:p.ERROR,silent:p.SILENT},se=p.INFO,Me={[p.DEBUG]:"log",[p.VERBOSE]:"log",[p.INFO]:"info",[p.WARN]:"warn",[p.ERROR]:"error"},Q=(P,v,...B)=>{if(v<P.logLevel)return;const H=(new Date).toISOString(),_e=Me[v];if(!_e)throw new Error(`Attempted to log a message with an invalid logType (value: ${v})`);console[_e](`[${H}]  ${P.name}:`,...B)};class $e{constructor(v){this.name=v,this._logLevel=se,this._logHandler=Q,this._userLogHandler=null,ne.push(this)}get logLevel(){return this._logLevel}set logLevel(v){if(!(v in p))throw new TypeError(`Invalid value "${v}" assigned to \`logLevel\``);this._logLevel=v}setLogLevel(v){this._logLevel="string"==typeof v?re[v]:v}get logHandler(){return this._logHandler}set logHandler(v){if("function"!=typeof v)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=v}get userLogHandler(){return this._userLogHandler}set userLogHandler(v){this._userLogHandler=v}debug(...v){this._userLogHandler&&this._userLogHandler(this,p.DEBUG,...v),this._logHandler(this,p.DEBUG,...v)}log(...v){this._userLogHandler&&this._userLogHandler(this,p.VERBOSE,...v),this._logHandler(this,p.VERBOSE,...v)}info(...v){this._userLogHandler&&this._userLogHandler(this,p.INFO,...v),this._logHandler(this,p.INFO,...v)}warn(...v){this._userLogHandler&&this._userLogHandler(this,p.WARN,...v),this._logHandler(this,p.WARN,...v)}error(...v){this._userLogHandler&&this._userLogHandler(this,p.ERROR,...v),this._logHandler(this,p.ERROR,...v)}}function Ie(P){ne.forEach(v=>{v.setLogLevel(P)})}function S(P,v){for(const B of ne){let H=null;v&&v.level&&(H=re[v.level]),B.userLogHandler=null===P?null:(_e,Ze,...ve)=>{const Y=ve.map(J=>{if(null==J)return null;if("string"==typeof J)return J;if("number"==typeof J||"boolean"==typeof J)return J.toString();if(J instanceof Error)return J.message;try{return JSON.stringify(J)}catch{return null}}).filter(J=>J).join(" ");Ze>=(H??_e.logLevel)&&P({level:p[Ze].toLowerCase(),message:Y,args:ve,type:_e.name})}}}},748:(pr,ft,he)=>{he.r(ft);var S,ne=he(3942),p=he(5861),re=he(6881),se=he(4859),Me=he(1877),Q=he(2090),$e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ie={},P=P||{},v=$e||self;function B(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function H(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Ze="closure_uid_"+(1e9*Math.random()>>>0),ve=0;function Y(n,e,t){return n.call.apply(n.bind,arguments)}function J(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function ye(n,e,t){return(ye=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Y:J).apply(null,arguments)}function tt(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function le(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function nt(){this.s=this.s,this.o=this.o}nt.prototype.s=!1,nt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function _e(n){Object.prototype.hasOwnProperty.call(n,Ze)&&n[Ze]||(n[Ze]=++ve)}(this)},nt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ln=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function ce(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function at(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(B(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function ie(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ie.prototype.h=function(){this.defaultPrevented=!0};var At=function(){if(!v.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{v.addEventListener("test",()=>{},e),v.removeEventListener("test",()=>{},e)}catch{}return n}();function mt(n){return/^[\s\xa0]*$/.test(n)}function Kt(){var n=v.navigator;return n&&(n=n.userAgent)?n:""}function ut(n){return-1!=Kt().indexOf(n)}function un(n){return un[" "](n),n}un[" "]=function(){};var cn,n,Ts=ut("Opera"),Mt=ut("Trident")||ut("MSIE"),_r=ut("Edge"),Bn=_r||Mt,ui=ut("Gecko")&&!(-1!=Kt().toLowerCase().indexOf("webkit")&&!ut("Edge"))&&!(ut("Trident")||ut("MSIE"))&&!ut("Edge"),ci=-1!=Kt().toLowerCase().indexOf("webkit")&&!ut("Edge");function Qt(){var n=v.document;return n?n.documentMode:void 0}e:{var Un="",qn=(n=Kt(),ui?/rv:([^\);]+)(\)|;)/.exec(n):_r?/Edge\/([\d\.]+)/.exec(n):Mt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):ci?/WebKit\/(\S+)/.exec(n):Ts?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(qn&&(Un=qn?qn[1]:""),Mt){var ln=Qt();if(null!=ln&&ln>parseFloat(Un)){cn=String(ln);break e}}cn=Un}var vs=v.document&&Mt&&(Qt()||parseInt(cn,10))||void 0;function hn(n,e){if(ie.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(ui){e:{try{un(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:ws[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&hn.$.h.call(this)}}le(hn,ie);var ws={2:"touch",3:"pen",4:"mouse"};hn.prototype.h=function(){hn.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var dn="closure_listenable_"+(1e6*Math.random()|0),li=0;function As(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++li,this.fa=this.ia=!1}function fn(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Ir(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function zn(n){const e={};for(const t in n)e[t]=n[t];return e}const hi="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Tr(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<hi.length;s++)t=hi[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Rt(n){this.src=n,this.g={},this.h=0}function Gn(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Ln(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(fn(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function yt(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}Rt.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=yt(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new As(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var xt="closure_lm_"+(1e6*Math.random()|0),mn={};function di(n,e,t,r,i){if(r&&r.once)return fi(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)di(n,e[s],t,r,i);return null}return t=Ar(t),n&&n[dn]?n.O(e,t,H(r)?!!r.capture:!!r,i):Ht(n,e,t,!1,r,i)}function Ht(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=H(i)?!!i.capture:!!i,a=wr(n);if(a||(n[xt]=a=new Rt(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function gn(){const e=Rs;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)At||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(It(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function fi(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)fi(n,e[s],t,r,i);return null}return t=Ar(t),n&&n[dn]?n.P(e,t,H(r)?!!r.capture:!!r,i):Ht(n,e,t,!0,r,i)}function pn(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)pn(n,e[s],t,r,i);else r=H(r)?!!r.capture:!!r,t=Ar(t),n&&n[dn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=yt(s=n.g[e],t,r,i))&&(fn(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=wr(n))&&(e=n.g[e.toString()],n=-1,e&&(n=yt(e,t,r,i)),(t=-1<n?e[n]:null)&&vr(t))}function vr(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[dn])Gn(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(It(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=wr(e))?(Gn(t,n),0==t.h&&(t.src=null,e[xt]=null)):fn(n)}}}function It(n){return n in mn?mn[n]:mn[n]="on"+n}function Rs(n,e){if(n.fa)n=!0;else{e=new hn(e,this);var t=n.listener,r=n.la||n.src;n.ia&&vr(n),n=t.call(r,e)}return n}function wr(n){return(n=n[xt])instanceof Rt?n:null}var jn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ar(n){return"function"==typeof n?n:(n[jn]||(n[jn]=function(e){return n.handleEvent(e)}),n[jn])}function xe(){nt.call(this),this.i=new Rt(this),this.S=this,this.J=null}function Oe(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new ie(e,n);else if(e instanceof ie)e.target=e.target||n;else{var i=e;Tr(e=new ie(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Ot(o,r,!0,e)&&i}if(i=Ot(o=e.g=n,r,!0,e)&&i,i=Ot(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=Ot(o=e.g=t[s],r,!1,e)&&i}function Ot(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&Gn(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}le(xe,nt),xe.prototype[dn]=!0,xe.prototype.removeEventListener=function(n,e,t,r){pn(this,n,e,t,r)},xe.prototype.N=function(){if(xe.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)fn(t[r]);delete n.g[e],n.h--}}this.J=null},xe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},xe.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Ft=v.JSON.stringify;function Ss(){var n=O;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Rr=new class Ps{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new f,n=>n.reset());class f{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function d(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function g(n){v.setTimeout(()=>{throw n},0)}let A,E=!1,O=new class mi{constructor(){this.h=this.g=null}add(e,t){const r=Rr.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},K=()=>{const n=v.Promise.resolve(void 0);A=()=>{n.then(Ee)}};var Ee=()=>{for(var n;n=Ss();){try{n.h.call(n.g)}catch(t){g(t)}var e=Rr;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}E=!1};function Ke(n,e){xe.call(this),this.h=n||1,this.g=e||v,this.j=ye(this.qb,this),this.l=Date.now()}function ze(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function gt(n,e,t){if("function"==typeof n)t&&(n=ye(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=ye(n.handleEvent,n)}return 2147483647<Number(e)?-1:v.setTimeout(n,e||0)}function oe(n){n.g=gt(()=>{n.g=null,n.i&&(n.i=!1,oe(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}le(Ke,xe),(S=Ke.prototype).ga=!1,S.T=null,S.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Oe(this,"tick"),this.ga&&(ze(this),this.start()))}},S.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},S.N=function(){Ke.$.N.call(this),ze(this),delete this.g};class Et extends nt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(v.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pt(n){nt.call(this),this.h=n,this.g={}}le(Pt,nt);var $n=[];function bs(n,e,t,r){Array.isArray(t)||(t&&($n[0]=t.toString()),t=$n);for(var i=0;i<t.length;i++){var s=di(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function w(n){Ir(n.g,function(e,t){this.g.hasOwnProperty(t)&&vr(e)},n),n.g={}}function y(){this.g=!0}function G(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function ge(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ft(t)}catch{return e}}(n,t)+(r?" "+r:"")})}Pt.prototype.N=function(){Pt.$.N.call(this),w(this)},Pt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},y.prototype.Ea=function(){this.g=!1},y.prototype.info=function(){};var Ce={},Ue=null;function Ct(){return Ue=Ue||new xe}function Pr(n){ie.call(this,Ce.Ta,n)}function gi(n){const e=Ct();Oe(e,new Pr(e))}function Cc(n,e){ie.call(this,Ce.STAT_EVENT,n),this.stat=e}function ct(n){const e=Ct();Oe(e,new Cc(e,n))}function Dc(n,e){ie.call(this,Ce.Ua,n),this.size=e}function pi(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return v.setTimeout(function(){n()},e)}Ce.Ta="serverreachability",le(Pr,ie),Ce.STAT_EVENT="statevent",le(Cc,ie),Ce.Ua="timingevent",le(Dc,ie);var Vs={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Nc={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Wo(){}function Mc(){}Wo.prototype.h=null;var Yo,_i={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Ho(){ie.call(this,"d")}function Zo(){ie.call(this,"c")}function xs(){}function yi(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Pt(this),this.P=em,this.V=new Ke(n=Bn?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Oc}function Oc(){this.i=null,this.g="",this.h=!1}le(Ho,ie),le(Zo,ie),le(xs,Wo),xs.prototype.g=function(){return new XMLHttpRequest},xs.prototype.i=function(){return{}},Yo=new xs;var em=45e3,Jo={},Cs={};function Xo(n,e,t){n.L=1,n.v=Ms(Zt(e)),n.s=t,n.S=!0,Fc(n,null)}function Fc(n,e){n.G=Date.now(),Ii(n),n.A=Zt(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),Qc(t.i,"t",r),n.C=0,t=n.l.J,n.h=new Oc,n.g=_l(n.l,t?e:null,!n.s),0<n.O&&(n.M=new Et(ye(n.Pa,n,n.g),n.O)),bs(n.U,n.g,"readystatechange",n.nb),e=n.I?zn(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),gi(),function V(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.W,n.s)}function Lc(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function Bc(n,e,t){let i,r=!0;for(;!n.J&&n.C<t.length;){if(i=tm(n,t),i==Cs){4==e&&(n.o=4,ct(14),r=!1),G(n.j,n.m,null,"[Incomplete Response]");break}if(i==Jo){n.o=4,ct(15),G(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}G(n.j,n.m,i,null),ea(n,i)}Lc(n)&&i!=Cs&&i!=Jo&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,ct(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),aa(e),e.M=!0,ct(11))):(G(n.j,n.m,t,"[Invalid Chunked Response]"),Kn(n),Ei(n))}function tm(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Cs:(t=Number(e.substring(t,r)),isNaN(t)?Jo:(r+=1)+t>e.length?Cs:(e=e.slice(r,r+t),n.C=r+t,e))}function Ii(n){n.Y=Date.now()+n.P,Uc(n,n.P)}function Uc(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=pi(ye(n.lb,n),e)}function Ds(n){n.B&&(v.clearTimeout(n.B),n.B=null)}function Ei(n){0==n.l.H||n.J||fl(n.l,n)}function Kn(n){Ds(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,ze(n.V),w(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function ea(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||ta(t.i,n)))if(!n.K&&ta(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;qs(t),Bs(t)}oa(t),ct(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=pi(ye(t.ib,t),6e3));if(1>=Zc(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Wn(t,11)}else if((n.K||t.g==n)&&qs(t),!mt(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const l=c[3];null!=l&&(t.ra=l,t.l.info("VER="+t.ra));const h=c[4];null!=h&&(t.Ga=h,t.l.info("SVER="+t.Ga));const m=c[5];null!=m&&"number"==typeof m&&0<m&&(t.L=r=1.5*m,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const I=n.g;if(I){const x=I.g?I.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(x){var s=r.i;s.g||-1==x.indexOf("spdy")&&-1==x.indexOf("quic")&&-1==x.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(na(s,s.h),s.h=null))}if(r.F){const C=I.g?I.g.getResponseHeader("X-HTTP-Session-Id"):null;C&&(r.Da=C,we(r.I,r.F,C))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=pl(r,r.J?r.pa:null,r.Y),o.K){Yc(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.B&&(Ds(a),Ii(a)),r.g=o}else hl(r);0<t.j.length&&Us(t)}else"stop"!=c[0]&&"close"!=c[0]||Wn(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Wn(t,7):sa(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}gi()}catch{}}function qc(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(B(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function rm(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(B(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function nm(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(B(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(S=yi.prototype).setTimeout=function(n){this.P=n},S.nb=function(n){n=n.target;const e=this.M;e&&3==Lt(n)?e.l():this.Pa(n)},S.Pa=function(n){try{if(n==this.g)e:{const l=Lt(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||Bn||this.g&&(this.h.h||this.g.ja()||sl(this.g)))){this.J||4!=l||7==e||gi(),Ds(this);var t=this.g.da();this.ca=t;t:if(Lc(this)){var r=sl(this.g);n="";var i=r.length,s=4==Lt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Kn(this),Ei(this);var o="";break t}this.h.i=new v.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function U(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.u,this.A,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!mt(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,ct(12),Kn(this),Ei(this);break e}G(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ea(this,t)}this.S?(Bc(this,l,o),Bn&&this.i&&3==l&&(bs(this.U,this.V,"tick",this.mb),this.V.start())):(G(this.j,this.m,o,null),ea(this,o)),4==l&&Kn(this),this.i&&!this.J&&(4==l?fl(this.l,this):(this.i=!1,Ii(this)))}else(function Tm(n){const e={};n=(n.g&&2<=Lt(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(mt(n[r]))continue;var t=d(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function Er(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.o=3,ct(12)):(this.o=0,ct(13)),Kn(this),Ei(this)}}}catch{}},S.mb=function(){if(this.g){var n=Lt(this.g),e=this.g.ja();this.C<e.length&&(Ds(this),Bc(this,n,e),this.i&&4!=n&&Ii(this))}},S.cancel=function(){this.J=!0,Kn(this)},S.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function Z(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(gi(),ct(17)),Kn(this),this.o=2,Ei(this)):Uc(this,this.Y-n)};var zc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Qn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Qn){this.h=n.h,Ns(this,n.j),this.s=n.s,this.g=n.g,ks(this,n.m),this.l=n.l;var e=n.i,t=new wi;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Gc(this,t),this.o=n.o}else n&&(e=String(n).match(zc))?(this.h=!1,Ns(this,e[1]||"",!0),this.s=Ti(e[2]||""),this.g=Ti(e[3]||"",!0),ks(this,e[4]),this.l=Ti(e[5]||"",!0),Gc(this,e[6]||"",!0),this.o=Ti(e[7]||"")):(this.h=!1,this.i=new wi(null,this.h))}function Zt(n){return new Qn(n)}function Ns(n,e,t){n.j=t?Ti(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ks(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Gc(n,e,t){e instanceof wi?(n.i=e,function lm(n,e){e&&!n.j&&(_n(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&($c(this,r),Qc(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=vi(e,um)),n.i=new wi(e,n.h))}function we(n,e,t){n.i.set(e,t)}function Ms(n){return we(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ti(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function vi(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,sm),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function sm(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Qn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(vi(e,jc,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(vi(e,jc,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(vi(t,"/"==t.charAt(0)?am:om,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",vi(t,cm)),n.join("")};var jc=/[#\/\?@]/g,om=/[#\?:]/g,am=/[#\?]/g,um=/[#\?@]/g,cm=/#/g;function wi(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function _n(n){n.g||(n.g=new Map,n.h=0,n.i&&function im(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function $c(n,e){_n(n),e=Sr(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Kc(n,e){return _n(n),e=Sr(n,e),n.g.has(e)}function Qc(n,e,t){$c(n,e),0<t.length&&(n.i=null,n.g.set(Sr(n,e),ce(t)),n.h+=t.length)}function Sr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Wc(n){this.l=n||dm,n=v.PerformanceNavigationTiming?0<(n=v.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(v.g&&v.g.Ka&&v.g.Ka()&&v.g.Ka().ec),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(S=wi.prototype).add=function(n,e){_n(this),this.i=null,n=Sr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},S.forEach=function(n,e){_n(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},S.ta=function(){_n(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},S.Z=function(n){_n(this);let e=[];if("string"==typeof n)Kc(this,n)&&(e=e.concat(this.g.get(Sr(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},S.set=function(n,e){return _n(this),this.i=null,Kc(this,n=Sr(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},S.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},S.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var dm=10;function Hc(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Zc(n){return n.h?1:n.g?n.g.size:0}function ta(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function na(n,e){n.g?n.g.add(e):n.h=e}function Yc(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Jc(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return ce(n.i)}function mm(){this.g=new class{stringify(n){return v.JSON.stringify(n,void 0)}parse(n){return v.JSON.parse(n,void 0)}}}function gm(n,e,t){const r=t||"";try{qc(n,function(i,s){let o=i;H(i)&&(o=Ft(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Os(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Ai(n){this.l=n.fc||null,this.j=n.ob||!1}function Fs(n,e){xe.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=ra,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Wc.prototype.cancel=function(){if(this.i=Jc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},le(Ai,Wo),Ai.prototype.g=function(){return new Fs(this.l,this.j)},Ai.prototype.i=function(n){return function(){return n}}({}),le(Fs,xe);var ra=0;function Xc(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function Ri(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Pi(n)}function Pi(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(S=Fs.prototype).open=function(n,e){if(this.readyState!=ra)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Pi(this)},S.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||v).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ri(this)),this.readyState=ra},S.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Pi(this)),this.g&&(this.readyState=3,Pi(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof v.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Xc(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},S.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Ri(this):Pi(this),3==this.readyState&&Xc(this)}},S.Za=function(n){this.g&&(this.response=this.responseText=n,Ri(this))},S.Ya=function(n){this.g&&(this.response=n,Ri(this))},S.ka=function(){this.g&&Ri(this)},S.setRequestHeader=function(n,e){this.v.append(n,e)},S.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},S.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Fs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var _m=v.JSON.parse;function De(n){xe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=el,this.L=this.M=!1}le(De,xe);var el="",ym=/^https?$/i,Im=["POST","PUT"];function tl(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,nl(n),Ls(n)}function nl(n){n.F||(n.F=!0,Oe(n,"complete"),Oe(n,"error"))}function rl(n){if(n.h&&typeof P<"u"&&(!n.C[1]||4!=Lt(n)||2!=n.da()))if(n.v&&4==Lt(n))gt(n.La,0,n);else if(Oe(n,"readystatechange"),4==Lt(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(zc)[1]||null;!i&&v.self&&v.self.location&&(i=v.self.location.protocol.slice(0,-1)),r=!ym.test(i?i.toLowerCase():"")}t=r}if(t)Oe(n,"complete"),Oe(n,"success");else{n.m=6;try{var s=2<Lt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",nl(n)}}finally{Ls(n)}}}function Ls(n,e){if(n.g){il(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Oe(n,"ready");try{t.onreadystatechange=r}catch{}}}function il(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(v.clearTimeout(n.A),n.A=null)}function Lt(n){return n.g?n.g.readyState:0}function sl(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case el:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function ol(n){let e="";return Ir(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function ia(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=ol(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):we(n,e,t))}function Si(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function al(n){this.Ga=0,this.j=[],this.l=new y,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Si("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Si("baseRetryDelayMs",5e3,n),this.hb=Si("retryDelaySeedMs",1e4,n),this.eb=Si("forwardChannelMaxRetries",2,n),this.xa=Si("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.dc||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Wc(n&&n.concurrentRequestLimit),this.Ja=new mm,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function sa(n){if(ul(n),3==n.H){var e=n.W++,t=Zt(n.I);if(we(t,"SID",n.K),we(t,"RID",e),we(t,"TYPE","terminate"),bi(n,t),(e=new yi(n,n.l,e)).L=2,e.v=Ms(Zt(t)),t=!1,v.navigator&&v.navigator.sendBeacon)try{t=v.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&v.Image&&((new Image).src=e.v,t=!0),t||(e.g=_l(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Ii(e)}gl(n)}function Bs(n){n.g&&(aa(n),n.g.cancel(),n.g=null)}function ul(n){Bs(n),n.u&&(v.clearTimeout(n.u),n.u=null),qs(n),n.i.cancel(),n.m&&("number"==typeof n.m&&v.clearTimeout(n.m),n.m=null)}function Us(n){if(!Hc(n.i)&&!n.m){n.m=!0;var e=n.Na;A||K(),E||(A(),E=!0),O.add(e,n),n.C=0}}function cl(n,e){var t;t=e?e.m:n.W++;const r=Zt(n.I);we(r,"SID",n.K),we(r,"RID",t),we(r,"AID",n.V),bi(n,r),n.o&&n.s&&ia(r,n.o,n.s),t=new yi(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=ll(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),na(n.i,t),Xo(t,r,e)}function bi(n,e){n.na&&Ir(n.na,function(t,r){we(e,r,t)}),n.h&&qc({},function(t,r){we(e,r,t)})}function ll(n,e,t){t=Math.min(n.j.length,t);var r=n.h?ye(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g;const l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{gm(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function hl(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;A||K(),E||(A(),E=!0),O.add(e,n),n.A=0}}function oa(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=pi(ye(n.Ma,n),ml(n,n.A)),n.A++,0))}function aa(n){null!=n.B&&(v.clearTimeout(n.B),n.B=null)}function dl(n){n.g=new yi(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=Zt(n.wa);we(e,"RID","rpc"),we(e,"SID",n.K),we(e,"AID",n.V),we(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&we(e,"TO",n.qa),we(e,"TYPE","xmlhttp"),bi(n,e),n.o&&n.s&&ia(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=Ms(Zt(e)),t.s=null,t.S=!0,Fc(t,n)}function qs(n){null!=n.v&&(v.clearTimeout(n.v),n.v=null)}function fl(n,e){var t=null;if(n.g==e){qs(n),aa(n),n.g=null;var r=2}else{if(!ta(n.i,e))return;t=e.F,Yc(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var i=n.C;Oe(r=Ct(),new Dc(r,t)),Us(n)}else hl(n);else if(3==(i=e.o)||0==i&&0<e.ca||!(1==r&&function vm(n,e){return!(Zc(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=pi(ye(n.Na,n,e),ml(n,n.C)),n.C++,0)))}(n,e)||2==r&&oa(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Wn(n,5);break;case 4:Wn(n,10);break;case 3:Wn(n,6);break;default:Wn(n,2)}}function ml(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Wn(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=ye(n.pb,n);t||(t=new Qn("//www.google.com/images/cleardot.gif"),v.location&&"http"==v.location.protocol||Ns(t,"https"),Ms(t)),function pm(n,e){const t=new y;if(v.Image){const r=new Image;r.onload=tt(Os,t,r,"TestLoadImage: loaded",!0,e),r.onerror=tt(Os,t,r,"TestLoadImage: error",!1,e),r.onabort=tt(Os,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=tt(Os,t,r,"TestLoadImage: timeout",!1,e),v.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else ct(2);n.H=0,n.h&&n.h.za(e),gl(n),ul(n)}function gl(n){if(n.H=0,n.ma=[],n.h){const e=Jc(n.i);(0!=e.length||0!=n.j.length)&&(at(n.ma,e),at(n.ma,n.j),n.i.i.length=0,ce(n.j),n.j.length=0),n.h.ya()}}function pl(n,e,t){var r=t instanceof Qn?Zt(t):new Qn(t);if(""!=r.g)e&&(r.g=e+"."+r.g),ks(r,r.m);else{var i=v.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Qn(null);r&&Ns(s,r),e&&(s.g=e),i&&ks(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&we(r,t,e),we(r,"VER",n.ra),bi(n,r),r}function _l(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new De(t&&n.Ha&&!n.va?new Ai({ob:!0}):n.va)).Oa(n.J),e}function yl(){}function zs(){if(Mt&&!(10<=Number(vs)))throw Error("Environmental error: no available transport.")}function Tt(n,e){xe.call(this),this.g=new al(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!mt(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!mt(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new br(this)}function Il(n){Ho.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function El(){Zo.call(this),this.status=1}function br(n){this.g=n}function Dt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ua(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function fe(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(S=De.prototype).Oa=function(n){this.M=n},S.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Yo.g(),this.C=function kc(n){return n.h||(n.h=n.i())}(this.u?this.u:Yo),this.g.onreadystatechange=ye(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void tl(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=v.FormData&&n instanceof v.FormData,!(0<=Ln(Im,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{il(this),0<this.B&&((this.L=function Em(n){return Mt&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ye(this.ua,this)):this.A=gt(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){tl(this,s)}},S.ua=function(){typeof P<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Oe(this,"timeout"),this.abort(8))},S.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Oe(this,"complete"),Oe(this,"abort"),Ls(this))},S.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ls(this,!0)),De.$.N.call(this)},S.La=function(){this.s||(this.G||this.v||this.l?rl(this):this.kb())},S.kb=function(){rl(this)},S.isActive=function(){return!!this.g},S.da=function(){try{return 2<Lt(this)?this.g.status:-1}catch{return-1}},S.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},S.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),_m(e)}},S.Ia=function(){return this.m},S.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(S=al.prototype).ra=8,S.H=1,S.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new yi(this,this.l,n);let s=this.s;if(this.U&&(s?(s=zn(s),Tr(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=ll(this,i,e),we(t=Zt(this.I),"RID",n),we(t,"CVER",22),this.F&&we(t,"X-HTTP-Session-Id",this.F),bi(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(ol(s)))+"&"+e:this.o&&ia(t,this.o,s)),na(this.i,i),this.bb&&we(t,"TYPE","init"),this.P?(we(t,"$req",e),we(t,"SID","null"),i.aa=!0,Xo(i,t,null)):Xo(i,t,e),this.H=2}}else 3==this.H&&(n?cl(this,n):0==this.j.length||Hc(this.i)||cl(this))},S.Ma=function(){if(this.u=null,dl(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=pi(ye(this.jb,this),n)}},S.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ct(10),Bs(this),dl(this))},S.ib=function(){null!=this.v&&(this.v=null,Bs(this),oa(this),ct(19))},S.pb=function(n){n?(this.l.info("Successfully pinged google.com"),ct(2)):(this.l.info("Failed to ping google.com"),ct(1))},S.isActive=function(){return!!this.h&&this.h.isActive(this)},(S=yl.prototype).Ba=function(){},S.Aa=function(){},S.za=function(){},S.ya=function(){},S.isActive=function(){return!0},S.Va=function(){},zs.prototype.g=function(n,e){return new Tt(n,e)},le(Tt,xe),Tt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;ct(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=pl(n,null,n.Y),Us(n)},Tt.prototype.close=function(){sa(this.g)},Tt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Ft(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&Us(e)},Tt.prototype.N=function(){this.g.h=null,delete this.j,sa(this.g),delete this.g,Tt.$.N.call(this)},le(Il,Ho),le(El,Zo),le(br,yl),br.prototype.Ba=function(){Oe(this.g,"a")},br.prototype.Aa=function(n){Oe(this.g,new Il(n))},br.prototype.za=function(n){Oe(this.g,new El)},br.prototype.ya=function(){Oe(this.g,"b")},le(Dt,function wm(){this.blockSize=-1}),Dt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Dt.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)ua(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){ua(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){ua(this,r),i=0;break}}this.h=i,this.i+=e},Dt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Am={};function ca(n){return-128<=n&&128>n?function kt(n,e){var t=Am;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new fe([0|e],0>e?-1:0)}):new fe([0|n],0>n?-1:0)}function Bt(n){if(isNaN(n)||!isFinite(n))return Vr;if(0>n)return Ye(Bt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=la;return new fe(e,0)}var la=4294967296,Vr=ca(0),ha=ca(1),vl=ca(16777216);function Yt(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function St(n){return-1==n.h}function Ye(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new fe(t,~n.h).add(ha)}function Gs(n,e){return n.add(Ye(e))}function js(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Vi(n,e){this.g=n,this.h=e}function $s(n,e){if(Yt(e))throw Error("division by zero");if(Yt(n))return new Vi(Vr,Vr);if(St(n))return e=$s(Ye(n),e),new Vi(Ye(e.g),Ye(e.h));if(St(e))return e=$s(n,Ye(e)),new Vi(Ye(e.g),e.h);if(30<n.g.length){if(St(n)||St(e))throw Error("slowDivide_ only works with positive integers.");for(var t=ha,r=e;0>=r.X(n);)t=wl(t),r=wl(r);var i=xr(t,1),s=xr(r,1);for(r=xr(r,2),t=xr(t,2);!Yt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=xr(r,1),t=xr(t,1)}return e=Gs(n,i.R(e)),new Vi(i,e)}for(i=Vr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Bt(t)).R(e);St(o)||0<o.X(n);)o=(s=Bt(t-=r)).R(e);Yt(s)&&(s=ha),i=i.add(s),n=Gs(n,o)}return new Vi(i,n)}function wl(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new fe(t,n.h)}function xr(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new fe(i,n.h)}(S=fe.prototype).ea=function(){if(St(this))return-Ye(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:la+r)*e,e*=la}return n},S.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(Yt(this))return"0";if(St(this))return"-"+Ye(this).toString(n);for(var e=Bt(Math.pow(n,6)),t=this,r="";;){var i=$s(t,e).g,s=((0<(t=Gs(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(Yt(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},S.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},S.X=function(n){return St(n=Gs(this,n))?-1:Yt(n)?0:1},S.abs=function(){return St(this)?Ye(this):this},S.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new fe(t,-2147483648&t[t.length-1]?-1:0)},S.R=function(n){if(Yt(this)||Yt(n))return Vr;if(St(this))return St(n)?Ye(this).R(Ye(n)):Ye(Ye(this).R(n));if(St(n))return Ye(this.R(Ye(n)));if(0>this.X(vl)&&0>n.X(vl))return Bt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);t[2*r+2*i]+=o*u,js(t,2*r+2*i),t[2*r+2*i+1]+=s*u,js(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,js(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,js(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new fe(t,0)},S.gb=function(n){return $s(this,n).h},S.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new fe(t,this.h&n.h)},S.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new fe(t,this.h|n.h)},S.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new fe(t,this.h^n.h)},zs.prototype.createWebChannel=zs.prototype.g,Tt.prototype.send=Tt.prototype.u,Tt.prototype.open=Tt.prototype.m,Tt.prototype.close=Tt.prototype.close,Vs.NO_ERROR=0,Vs.TIMEOUT=8,Vs.HTTP_ERROR=6,Nc.COMPLETE="complete",Mc.EventType=_i,_i.OPEN="a",_i.CLOSE="b",_i.ERROR="c",_i.MESSAGE="d",xe.prototype.listen=xe.prototype.O,De.prototype.listenOnce=De.prototype.P,De.prototype.getLastError=De.prototype.Sa,De.prototype.getLastErrorCode=De.prototype.Ia,De.prototype.getStatus=De.prototype.da,De.prototype.getResponseJson=De.prototype.Wa,De.prototype.getResponseText=De.prototype.ja,De.prototype.send=De.prototype.ha,De.prototype.setWithCredentials=De.prototype.Oa,Dt.prototype.digest=Dt.prototype.l,Dt.prototype.reset=Dt.prototype.reset,Dt.prototype.update=Dt.prototype.j,fe.prototype.add=fe.prototype.add,fe.prototype.multiply=fe.prototype.R,fe.prototype.modulo=fe.prototype.gb,fe.prototype.compare=fe.prototype.X,fe.prototype.toNumber=fe.prototype.ea,fe.prototype.toString=fe.prototype.toString,fe.prototype.getBits=fe.prototype.D,fe.fromNumber=Bt,fe.fromString=function Tl(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return Ye(Tl(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Bt(Math.pow(e,8)),r=Vr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Bt(Math.pow(e,s)),r=r.R(s).add(Bt(o))):r=(r=r.R(t)).add(Bt(o))}return r};var Rm=Ie.createWebChannelTransport=function(){return new zs},Pm=Ie.getStatEventTarget=function(){return Ct()},da=Ie.ErrorCode=Vs,Sm=Ie.EventType=Nc,bm=Ie.Event=Ce,Al=Ie.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Vm=Ie.FetchXmlHttpFactory=Ai,Ks=Ie.WebChannel=Mc,xm=Ie.XhrIo=De,Cm=Ie.Md5=Dt,Cr=Ie.Integer=fe;const Rl="@firebase/firestore";class Qe{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Qe.UNAUTHENTICATED=new Qe(null),Qe.GOOGLE_CREDENTIALS=new Qe("google-credentials-uid"),Qe.FIRST_PARTY=new Qe("first-party-uid"),Qe.MOCK_USER=new Qe("mock-user");let Dr="10.0.0";const yn=new Me.Yd("@firebase/firestore");function fa(){return yn.logLevel}function b(n,...e){if(yn.logLevel<=Me.in.DEBUG){const t=e.map(ma);yn.debug(`Firestore (${Dr}): ${n}`,...t)}}function Fe(n,...e){if(yn.logLevel<=Me.in.ERROR){const t=e.map(ma);yn.error(`Firestore (${Dr}): ${n}`,...t)}}function bt(n,...e){if(yn.logLevel<=Me.in.WARN){const t=e.map(ma);yn.warn(`Firestore (${Dr}): ${n}`,...t)}}function ma(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function M(n="Unexpected state"){const e=`FIRESTORE (${Dr}) INTERNAL ASSERTION FAILED: `+n;throw Fe(e),new Error(e)}function F(n,e){n||M()}function k(n,e){return n}const T={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class R extends Q.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ge{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Pl{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class km{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Qe.UNAUTHENTICATED))}shutdown(){}}class Mm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Om{constructor(e){this.t=e,this.currentUser=Qe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new Ge;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ge,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield s(r.currentUser)}))},u=c=>{b("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(b("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ge)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(b("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(F("string"==typeof r.accessToken),new Pl(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return F(null===e||"string"==typeof e),new Qe(e)}}class Fm{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Qe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Lm{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Fm(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Qe.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Sl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Bm{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&b("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,b("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{b("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):b("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(F("string"==typeof t.token),this.R=t.token,new Sl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Um(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class bl{static V(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=Um(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function $(n,e){return n<e?-1:n>e?1:0}function Nr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Vl(n){return n+"\0"}class be{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new R(T.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new R(T.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new R(T.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new R(T.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return be.fromMillis(Date.now())}static fromDate(e){return be.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new be(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?$(this.nanoseconds,e.nanoseconds):$(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class L{constructor(e){this.timestamp=e}static fromTimestamp(e){return new L(e)}static min(){return new L(new be(0,0))}static max(){return new L(new be(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class xi{constructor(e,t,r){void 0===t?t=0:t>e.length&&M(),void 0===r?r=e.length-t:r>e.length-t&&M(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===xi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof xi?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ae extends xi{construct(e,t,r){return new ae(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new R(T.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new ae(t)}static emptyPath(){return new ae([])}}const qm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ne extends xi{construct(e,t,r){return new Ne(e,t,r)}static isValidIdentifier(e){return qm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ne.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Ne(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new R(T.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new R(T.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new R(T.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new R(T.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ne(t)}static emptyPath(){return new Ne([])}}class N{constructor(e){this.path=e}static fromPath(e){return new N(ae.fromString(e))}static fromName(e){return new N(ae.fromString(e).popFirst(5))}static empty(){return new N(ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ae.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new N(new ae(e.slice()))}}class Qs{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function ga(n){return n.fields.find(e=>2===e.kind)}function Hn(n){return n.fields.filter(e=>2!==e.kind)}Qs.UNKNOWN_ID=-1;class Ws{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ci{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ci(0,vt.min())}}function xl(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=L.fromTimestamp(1e9===r?new be(t+1,0):new be(t,r));return new vt(i,N.empty(),e)}function Cl(n){return new vt(n.readTime,n.key,-1)}class vt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new vt(L.min(),N.empty(),-1)}static max(){return new vt(L.max(),N.empty(),-1)}}function pa(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=N.comparator(n.documentKey,e.documentKey),0!==t?t:$(n.largestBatchId,e.largestBatchId))}const Dl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Nl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function In(n){return _a.apply(this,arguments)}function _a(){return _a=(0,p.Z)(function*(n){if(n.code!==T.FAILED_PRECONDITION||n.message!==Dl)throw n;b("LocalStore","Unexpectedly lost primary lease")}),_a.apply(this,arguments)}class _{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new _((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof _?t:_.resolve(t)}catch(t){return _.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):_.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):_.reject(t)}static resolve(e){return new _((t,r)=>{t(e)})}static reject(e){return new _((t,r)=>{r(e)})}static waitFor(e){return new _((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=_.resolve(!1);for(const r of e)t=t.next(i=>i?_.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new _((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new _((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Hs{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.m=new Ge,this.transaction.oncomplete=()=>{this.m.resolve()},this.transaction.onabort=()=>{t.error?this.m.reject(new Di(e,t.error)):this.m.resolve()},this.transaction.onerror=r=>{const i=ya(r.target.error);this.m.reject(new Di(e,i))}}static open(e,t,r,i){try{return new Hs(t,e.transaction(i,r))}catch(s){throw new Di(t,s)}}get g(){return this.m.promise}abort(e){e&&this.m.reject(e),this.aborted||(b("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}p(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new $m(t)}}class Nt{constructor(e,t,r){this.name=e,this.version=t,this.S=r,12.2===Nt.D((0,Q.z$)())&&Fe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return b("SimpleDb","Removing database:",e),Zn(window.indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!(0,Q.hl)())return!1;if(Nt.C())return!0;const e=(0,Q.z$)(),t=Nt.D(e),r=0<t&&t<10,i=Nt.F(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.M)}static O(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static F(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}N(e){var t=this;return(0,p.Z)(function*(){return t.db||(b("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new Di(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new R(T.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new R(T.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Di(e,a))},s.onupgradeneeded=o=>{b("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.S.B(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{b("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.L&&(t.db.onversionchange=r=>t.L(r)),t.db})()}k(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,p.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.N(e);const u=Hs.open(s.db,e,o?"readonly":"readwrite",r),c=i(u).next(l=>(u.p(),l)).catch(l=>(u.abort(l),_.reject(l))).toPromise();return c.catch(()=>{}),yield u.g,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(b("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),s.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class jm{constructor(e){this.q=e,this.K=!1,this.$=null}get isDone(){return this.K}get U(){return this.$}set cursor(e){this.q=e}done(){this.K=!0}W(e){this.$=e}delete(){return Zn(this.q.delete())}}class Di extends R{constructor(e,t){super(T.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function En(n){return"IndexedDbTransactionError"===n.name}class $m{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(b("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(b("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Zn(r)}add(e){return b("SimpleDb","ADD",this.store.name,e,e),Zn(this.store.add(e))}get(e){return Zn(this.store.get(e)).next(t=>(void 0===t&&(t=null),b("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return b("SimpleDb","DELETE",this.store.name,e),Zn(this.store.delete(e))}count(){return b("SimpleDb","COUNT",this.store.name),Zn(this.store.count())}G(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.j(i,(o,a)=>{s.push(a)}).next(()=>s)}{const i=this.store.getAll(r.range);return new _((s,o)=>{i.onerror=a=>{o(a.target.error)},i.onsuccess=a=>{s(a.target.result)}})}}H(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new _((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}J(e,t){b("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.Y=!1;const i=this.cursor(r);return this.j(i,(s,o,a)=>a.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.j(i,t)}X(e){const t=this.cursor({});return new _((r,i)=>{t.onerror=s=>{const o=ya(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}j(e,t){const r=[];return new _((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new jm(a),c=t(a.primaryKey,a.value,u);if(c instanceof _){const l=c.catch(h=>(u.done(),_.reject(h)));r.push(l)}u.isDone?i():null===u.U?a.continue():a.continue(u.U)}}).next(()=>_.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Zn(n){return new _((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=ya(r.target.error);t(i)}})}let kl=!1;function ya(n){const e=Nt.D((0,Q.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new R("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return kl||(kl=!0,setTimeout(()=>{throw r},0)),r}}return n}class Km{constructor(e,t){this.asyncQueue=e,this.ee=t,this.task=null}start(){this.te(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}te(e){var t=this;b("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,p.Z)(function*(){t.task=null;try{b("IndexBackiller",`Documents written: ${yield t.ee.ne()}`)}catch(r){En(r)?b("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield In(r)}yield t.te(6e4)}))}}class Qm{constructor(e,t){this.localStore=e,this.persistence=t}ne(e=50){var t=this;return(0,p.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.re(r,e))})()}re(e,t){const r=new Set;let i=t,s=!0;return _.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return b("IndexBackiller",`Processing collection: ${o}`),this.ie(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ie(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.se(i,s)).next(a=>(b("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}se(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=Cl(s);pa(o,r)>0&&(r=o)}),new vt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let wt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.oe(i),this._e=i=>r.writeSequenceNumber(i))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}return n.ae=-1,n})();function Ni(n){return null==n}function ki(n){return 0===n&&1/n==-1/0}function Ml(n){return"number"==typeof n&&Number.isInteger(n)&&!ki(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function rt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ol(e)),e=Wm(n.get(t),e);return Ol(e)}function Wm(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Ol(n){return n+"\x01\x01"}function Ut(n){const e=n.length;if(F(e>=2),2===e)return F("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),ae.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&M(),n.charAt(o+1)){case"\x01":const a=n.substring(s,o);let u;0===i.length?u=a:(i+=a,u=i,i=""),r.push(u);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:M()}s=o+2}return new ae(r)}const Fl=["userId","batchId"];function Zs(n,e){return[n,rt(e)]}function Ll(n,e,t){return[n,rt(e),t]}const Hm={},Zm=["prefixPath","collectionGroup","readTime","documentId"],Ym=["prefixPath","collectionGroup","documentId"],Jm=["collectionGroup","readTime","prefixPath","documentId"],Xm=["canonicalId","targetId"],eg=["targetId","path"],tg=["path","targetId"],ng=["collectionId","parent"],rg=["indexId","uid"],ig=["uid","sequenceNumber"],sg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],og=["indexId","uid","orderedDocumentKey"],ag=["userId","collectionPath","documentId"],ug=["userId","collectionPath","largestBatchId"],cg=["userId","collectionGroup","largestBatchId"],Bl=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],lg=[...Bl,"documentOverlays"],Ul=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ql=Ul,hg=[...ql,"indexConfiguration","indexState","indexEntries"];class Ia extends Nl{constructor(e,t){super(),this.ue=e,this.currentSequenceNumber=t}}function We(n,e){const t=k(n);return Nt.O(t.ue,e)}function zl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Tn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Gl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Te{constructor(e,t){this.comparator=e,this.root=t||Je.EMPTY}insert(e,t){return new Te(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Je.BLACK,null,null))}remove(e){return new Te(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Je.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ys(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ys(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ys(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ys(this.root,e,this.comparator,!0)}}class Ys{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Je{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Je.RED,this.left=i??Je.EMPTY,this.right=s??Je.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Je(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Je.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Je.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Je.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Je.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw M();const e=this.left.check();if(e!==this.right.check())throw M();return e+(this.isRed()?0:1)}}Je.EMPTY=null,Je.RED=!0,Je.BLACK=!1,Je.EMPTY=new class{constructor(){this.size=0}get key(){throw M()}get value(){throw M()}get color(){throw M()}get left(){throw M()}get right(){throw M()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Je(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ae{constructor(e){this.comparator=e,this.data=new Te(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new jl(this.data.getIterator())}getIteratorFrom(e){return new jl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ae)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ae(this.comparator);return t.data=e,t}}class jl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function kr(n){return n.hasNext()?n.getNext():void 0}class pt{constructor(e){this.fields=e,e.sort(Ne.comparator)}static empty(){return new pt([])}unionWith(e){let t=new Ae(Ne.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new pt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Nr(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class $l extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class je{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new $l("Invalid base64 string: "+s):s}}(e);return new je(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new je(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}je.EMPTY_BYTE_STRING=new je("");const fg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vn(n){if(F(!!n),"string"==typeof n){let e=0;const t=fg.exec(n);if(F(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ke(n.seconds),nanos:ke(n.nanos)}}function ke(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Jt(n){return"string"==typeof n?je.fromBase64String(n):je.fromUint8Array(n)}function Js(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Xs(n){const e=n.mapValue.fields.__previous_value__;return Js(e)?Xs(e):e}function Mi(n){const e=vn(n.mapValue.fields.__local_write_time__.timestampValue);return new be(e.seconds,e.nanos)}class mg{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class wn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new wn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof wn&&e.projectId===this.projectId&&e.database===this.database}}const An={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},eo={nullValue:"NULL_VALUE"};function Rn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Js(n)?4:Hl(n)?9007199254740991:10:M()}function qt(n,e){if(n===e)return!0;const t=Rn(n);if(t!==Rn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Mi(n).isEqual(Mi(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=vn(i.timestampValue),a=vn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,Jt(n.bytesValue).isEqual(Jt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ke(i.geoPointValue.latitude)===ke(s.geoPointValue.latitude)&&ke(i.geoPointValue.longitude)===ke(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ke(i.integerValue)===ke(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=ke(i.doubleValue),a=ke(s.doubleValue);return o===a?ki(o)===ki(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Nr(n.arrayValue.values||[],e.arrayValue.values||[],qt);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(zl(o)!==zl(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!qt(o[u],a[u])))return!1;return!0}(n,e);default:return M()}var s}function Oi(n,e){return void 0!==(n.values||[]).find(t=>qt(t,e))}function Pn(n,e){if(n===e)return 0;const t=Rn(n),r=Rn(e);if(t!==r)return $(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return $(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=ke(s.integerValue||s.doubleValue),u=ke(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return Kl(n.timestampValue,e.timestampValue);case 4:return Kl(Mi(n),Mi(e));case 5:return $(n.stringValue,e.stringValue);case 6:return function(s,o){const a=Jt(s),u=Jt(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const l=$(a[c],u[c]);if(0!==l)return l}return $(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=$(ke(s.latitude),ke(o.latitude));return 0!==a?a:$(ke(s.longitude),ke(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const l=Pn(a[c],u[c]);if(l)return l}return $(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===An.mapValue&&o===An.mapValue)return 0;if(s===An.mapValue)return 1;if(o===An.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){const m=$(u[h],l[h]);if(0!==m)return m;const I=Pn(a[u[h]],c[l[h]]);if(0!==I)return I}return $(u.length,l.length)}(n.mapValue,e.mapValue);default:throw M()}}function Kl(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return $(n,e);const t=vn(n),r=vn(e),i=$(t.seconds,r.seconds);return 0!==i?i:$(t.nanos,r.nanos)}function Mr(n){return Ea(n)}function Ea(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=vn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Jt(n.bytesValue).toBase64():"referenceValue"in n?N.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Ea(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${Ea(t.fields[o])}`;return i+"}"}(n.mapValue):M()}function Yn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ta(n){return!!n&&"integerValue"in n}function Fi(n){return!!n&&"arrayValue"in n}function Ql(n){return!!n&&"nullValue"in n}function Wl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function no(n){return!!n&&"mapValue"in n}function Li(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Tn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Li(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Li(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Hl(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function gg(n){return"nullValue"in n?eo:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Yn(wn.empty(),N.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:M()}function pg(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Yn(wn.empty(),N.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?An:M()}function Zl(n,e){const t=Pn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Yl(n,e){const t=Pn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Xe{constructor(e){this.value=e}static empty(){return new Xe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!no(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Li(t)}setAll(e){let t=Ne.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Li(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());no(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];no(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Tn(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Xe(Li(this.value))}}function Jl(n){const e=[];return Tn(n.fields,(t,r)=>{const i=new Ne([t]);if(no(r)){const s=Jl(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new pt(e)}class Re{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Re(e,0,L.min(),L.min(),L.min(),Xe.empty(),0)}static newFoundDocument(e,t,r,i){return new Re(e,1,t,L.min(),r,i,0)}static newNoDocument(e,t){return new Re(e,2,t,L.min(),L.min(),Xe.empty(),0)}static newUnknownDocument(e,t){return new Re(e,3,t,L.min(),L.min(),Xe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(L.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Xe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Xe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=L.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Re&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Re(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Sn{constructor(e,t){this.position=e,this.inclusive=t}}function Xl(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?N.comparator(N.fromName(o.referenceValue),t.key):Pn(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function eh(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!qt(n.position[t],e.position[t]))return!1;return!0}class Or{constructor(e,t="asc"){this.field=e,this.dir=t}}function _g(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class th{}class X extends th{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new yg(e,t,r):"array-contains"===t?new Tg(e,r):"in"===t?new ah(e,r):"not-in"===t?new vg(e,r):"array-contains-any"===t?new wg(e,r):new X(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new Ig(e,r):new Eg(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Pn(t,this.value)):null!==t&&Rn(this.value)===Rn(t)&&this.matchesComparison(Pn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return M()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class me extends th{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new me(e,t)}matches(e){return Fr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.le(t=>t.isInequality());return null!==e?e.field:null}le(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Fr(n){return"and"===n.op}function va(n){return"or"===n.op}function wa(n){return nh(n)&&Fr(n)}function nh(n){for(const e of n.filters)if(e instanceof me)return!1;return!0}function Aa(n){if(n instanceof X)return n.field.canonicalString()+n.op.toString()+Mr(n.value);if(wa(n))return n.filters.map(e=>Aa(e)).join(",");{const e=n.filters.map(t=>Aa(t)).join(",");return`${n.op}(${e})`}}function rh(n,e){return n instanceof X?(r=n,(i=e)instanceof X&&r.op===i.op&&r.field.isEqual(i.field)&&qt(r.value,i.value)):n instanceof me?function(r,i){return i instanceof me&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&rh(o,i.filters[a]),!0)}(n,e):void M();var r,i}function ih(n,e){const t=n.filters.concat(e);return me.create(t,n.op)}function sh(n){return n instanceof X?`${(t=n).field.canonicalString()} ${t.op} ${Mr(t.value)}`:n instanceof me?function(t){return t.op.toString()+" {"+t.getFilters().map(sh).join(" ,")+"}"}(n):"Filter";var t}class yg extends X{constructor(e,t,r){super(e,t,r),this.key=N.fromName(r.referenceValue)}matches(e){const t=N.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ig extends X{constructor(e,t){super(e,"in",t),this.keys=oh(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Eg extends X{constructor(e,t){super(e,"not-in",t),this.keys=oh(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function oh(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>N.fromName(r.referenceValue))}class Tg extends X{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Fi(t)&&Oi(t.arrayValue,this.value)}}class ah extends X{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Oi(this.value.arrayValue,t)}}class vg extends X{constructor(e,t){super(e,"not-in",t)}matches(e){if(Oi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Oi(this.value.arrayValue,t)}}class wg extends X{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Fi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Oi(this.value.arrayValue,r))}}class Ag{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.he=null}}function Ra(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Ag(n,e,t,r,i,s,o)}function Jn(n){const e=k(n);if(null===e.he){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Aa(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Ni(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Mr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Mr(r)).join(",")),e.he=t}return e.he}function Bi(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!_g(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!rh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!eh(n.startAt,e.startAt)&&eh(n.endAt,e.endAt)}function ro(n){return N.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function io(n,e){return n.filters.filter(t=>t instanceof X&&t.field.isEqual(e))}function uh(n,e,t){let r=eo,i=!0;for(const s of io(n,e)){let o=eo,a=!0;switch(s.op){case"<":case"<=":o=gg(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=eo}Zl({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Zl({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function ch(n,e,t){let r=An,i=!0;for(const s of io(n,e)){let o=An,a=!0;switch(s.op){case">=":case">":o=pg(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=An}Yl({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Yl({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class Xt{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.Pe=null,this.Ie=null}}function lh(n,e,t,r,i,s,o,a){return new Xt(n,e,t,r,i,s,o,a)}function Lr(n){return new Xt(n)}function hh(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Pa(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function so(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function Sa(n){return null!==n.collectionGroup}function Xn(n){const e=k(n);if(null===e.Pe){e.Pe=[];const t=so(e),r=Pa(e);if(null!==t&&null===r)t.isKeyField()||e.Pe.push(new Or(t)),e.Pe.push(new Or(Ne.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.Pe.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new Or(Ne.keyField(),s))}}}return e.Pe}function lt(n){const e=k(n);if(!e.Ie)if("F"===e.limitType)e.Ie=Ra(e.path,e.collectionGroup,Xn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Xn(e))t.push(new Or(s.field,"desc"===s.dir?"asc":"desc"));const r=e.endAt?new Sn(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Sn(e.startAt.position,e.startAt.inclusive):null;e.Ie=Ra(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e.Ie}function ba(n,e){e.getFirstInequalityField(),so(n);const t=n.filters.concat([e]);return new Xt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function oo(n,e,t){return new Xt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ui(n,e){return Bi(lt(n),lt(e))&&n.limitType===e.limitType}function dh(n){return`${Jn(lt(n))}|lt:${n.limitType}`}function Va(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>sh(i)).join(", ")}]`),Ni(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Mr(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Mr(i)).join(",")),`Target(${r})`}(lt(n))}; limitType=${n.limitType})`}function qi(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):N.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of Xn(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,u){const c=Xl(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Xn(r),i)||r.endAt&&!function(o,a,u){const c=Xl(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Xn(r),i)));var r,i}function fh(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function mh(n){return(e,t)=>{let r=!1;for(const i of Xn(n)){const s=Rg(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function Rg(n,e,t){const r=n.field.isKeyField()?N.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?Pn(u,c):M()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M()}}class en{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Tn(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Gl(this.inner)}size(){return this.innerSize}}const Pg=new Te(N.comparator);function _t(){return Pg}const gh=new Te(N.comparator);function zi(...n){let e=gh;for(const t of n)e=e.insert(t.key,t);return e}function ph(n){let e=gh;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function zt(){return Gi()}function _h(){return Gi()}function Gi(){return new en(n=>n.toString(),(n,e)=>n.isEqual(e))}const Sg=new Te(N.comparator),bg=new Ae(N.comparator);function W(...n){let e=bg;for(const t of n)e=e.add(t);return e}const Vg=new Ae($);function xa(){return Vg}function yh(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ki(e)?"-0":e}}function Ih(n){return{integerValue:""+n}}function Eh(n,e){return Ml(e)?Ih(e):yh(n,e)}class ao{constructor(){this._=void 0}}function xg(n,e,t){return n instanceof Br?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Js(s)&&(s=Xs(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof er?vh(n,e):n instanceof tr?wh(n,e):function(i,s){const o=Th(i,s),a=Ah(o)+Ah(i.Te);return Ta(o)&&Ta(i.Te)?Ih(a):yh(i.serializer,a)}(n,e)}function Cg(n,e,t){return n instanceof er?vh(n,e):n instanceof tr?wh(n,e):t}function Th(n,e){return n instanceof Ur?Ta(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class Br extends ao{}class er extends ao{constructor(e){super(),this.elements=e}}function vh(n,e){const t=Rh(e);for(const r of n.elements)t.some(i=>qt(i,r))||t.push(r);return{arrayValue:{values:t}}}class tr extends ao{constructor(e){super(),this.elements=e}}function wh(n,e){let t=Rh(e);for(const r of n.elements)t=t.filter(i=>!qt(i,r));return{arrayValue:{values:t}}}class Ur extends ao{constructor(e,t){super(),this.serializer=e,this.Te=t}}function Ah(n){return ke(n.integerValue||n.doubleValue)}function Rh(n){return Fi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class ji{constructor(e,t){this.field=e,this.transform=t}}class Ng{constructor(e,t){this.version=e,this.transformResults=t}}class Ve{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ve}static exists(e){return new Ve(void 0,e)}static updateTime(e){return new Ve(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function uo(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class co{}function Ph(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new zr(n.key,Ve.none()):new qr(n.key,n.data,Ve.none());{const t=n.data,r=Xe.empty();let i=new Ae(Ne.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new tn(n.key,r,new pt(i.toArray()),Ve.none())}}function kg(n,e,t){n instanceof qr?function(i,s,o){const a=i.value.clone(),u=Vh(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof tn?function(i,s,o){if(!uo(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=Vh(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(bh(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function $i(n,e,t,r){return n instanceof qr?function(s,o,a,u){if(!uo(s.precondition,o))return a;const c=s.value.clone(),l=xh(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof tn?function(s,o,a,u){if(!uo(s.precondition,o))return a;const c=xh(s.fieldTransforms,u,o),l=o.data;return l.setAll(bh(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):(a=t,uo(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function Mg(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=Th(r.transform,i||null);null!=s&&(null===t&&(t=Xe.empty()),t.set(r.field,s))}return t||null}function Sh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&Nr(r,i,(s,o)=>function Dg(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof er&&i instanceof er||r instanceof tr&&i instanceof tr?Nr(r.elements,i.elements,qt):r instanceof Ur&&i instanceof Ur?qt(r.Te,i.Te):r instanceof Br&&i instanceof Br);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class qr extends co{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class tn extends co{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function bh(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Vh(n,e,t){const r=new Map;F(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Cg(o,a,t[i]))}return r}function xh(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,xg(s,o,e))}return r}class zr extends co{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ca extends co{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Da{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&kg(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=$i(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=$i(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=_h();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=Ph(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(L.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),W())}isEqual(e){return this.batchId===e.batchId&&Nr(this.mutations,e.mutations,(t,r)=>Sh(t,r))&&Nr(this.baseMutations,e.baseMutations,(t,r)=>Sh(t,r))}}class Na{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){F(e.mutations.length===r.length);let i=Sg;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new Na(e,t,r,i)}}class ka{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Fg{constructor(e,t){this.count=e,this.unchangedNames=t}}var qe,ue;function Ch(n){switch(n){default:return M();case T.CANCELLED:case T.UNKNOWN:case T.DEADLINE_EXCEEDED:case T.RESOURCE_EXHAUSTED:case T.INTERNAL:case T.UNAVAILABLE:case T.UNAUTHENTICATED:return!1;case T.INVALID_ARGUMENT:case T.NOT_FOUND:case T.ALREADY_EXISTS:case T.PERMISSION_DENIED:case T.FAILED_PRECONDITION:case T.ABORTED:case T.OUT_OF_RANGE:case T.UNIMPLEMENTED:case T.DATA_LOSS:return!0}}function Dh(n){if(void 0===n)return Fe("GRPC error has no .code"),T.UNKNOWN;switch(n){case qe.OK:return T.OK;case qe.CANCELLED:return T.CANCELLED;case qe.UNKNOWN:return T.UNKNOWN;case qe.DEADLINE_EXCEEDED:return T.DEADLINE_EXCEEDED;case qe.RESOURCE_EXHAUSTED:return T.RESOURCE_EXHAUSTED;case qe.INTERNAL:return T.INTERNAL;case qe.UNAVAILABLE:return T.UNAVAILABLE;case qe.UNAUTHENTICATED:return T.UNAUTHENTICATED;case qe.INVALID_ARGUMENT:return T.INVALID_ARGUMENT;case qe.NOT_FOUND:return T.NOT_FOUND;case qe.ALREADY_EXISTS:return T.ALREADY_EXISTS;case qe.PERMISSION_DENIED:return T.PERMISSION_DENIED;case qe.FAILED_PRECONDITION:return T.FAILED_PRECONDITION;case qe.ABORTED:return T.ABORTED;case qe.OUT_OF_RANGE:return T.OUT_OF_RANGE;case qe.UNIMPLEMENTED:return T.UNIMPLEMENTED;case qe.DATA_LOSS:return T.DATA_LOSS;default:return M()}}(ue=qe||(qe={}))[ue.OK=0]="OK",ue[ue.CANCELLED=1]="CANCELLED",ue[ue.UNKNOWN=2]="UNKNOWN",ue[ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ue[ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ue[ue.NOT_FOUND=5]="NOT_FOUND",ue[ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",ue[ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",ue[ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",ue[ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ue[ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ue[ue.ABORTED=10]="ABORTED",ue[ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",ue[ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",ue[ue.INTERNAL=13]="INTERNAL",ue[ue.UNAVAILABLE=14]="UNAVAILABLE",ue[ue.DATA_LOSS=15]="DATA_LOSS";class Ma{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return lo}static getOrCreateInstance(){return null===lo&&(lo=new Ma),lo}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let lo=null;function Nh(){return new TextEncoder}const Lg=new Cr([4294967295,4294967295],0);function kh(n){const e=Nh().encode(n),t=new Cm;return t.update(e),new Uint8Array(t.digest())}function Mh(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Cr([t,r],0),new Cr([i,s],0)]}class Oa{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ki(`Invalid padding: ${t}`);if(r<0)throw new Ki(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new Ki(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new Ki(`Invalid padding when bitmap length is 0: ${t}`);this.de=8*e.length-t,this.Ae=Cr.fromNumber(this.de)}Re(e,t,r){let i=e.add(t.multiply(Cr.fromNumber(r)));return 1===i.compare(Lg)&&(i=new Cr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ae).toNumber()}Ve(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.de)return!1;const t=kh(e),[r,i]=Mh(t);for(let s=0;s<this.hashCount;s++){const o=this.Re(r,i,s);if(!this.Ve(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new Oa(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.de)return;const t=kh(e),[r,i]=Mh(t);for(let s=0;s<this.hashCount;s++){const o=this.Re(r,i,s);this.me(o)}}me(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Ki extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Qi{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Wi.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Qi(L.min(),i,new Te($),_t(),W())}}class Wi{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Wi(r,t,W(),W(),W())}}class ho{constructor(e,t,r,i){this.fe=e,this.removedTargetIds=t,this.key=r,this.ge=i}}class Oh{constructor(e,t){this.targetId=e,this.pe=t}}class Fh{constructor(e,t,r=je.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Lh{constructor(){this.ye=0,this.we=Uh(),this.Se=je.EMPTY_BYTE_STRING,this.be=!1,this.De=!0}get current(){return this.be}get resumeToken(){return this.Se}get ve(){return 0!==this.ye}get Ce(){return this.De}Fe(e){e.approximateByteSize()>0&&(this.De=!0,this.Se=e)}Me(){let e=W(),t=W(),r=W();return this.we.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M()}}),new Wi(this.Se,this.be,e,t,r)}xe(){this.De=!1,this.we=Uh()}Oe(e,t){this.De=!0,this.we=this.we.insert(e,t)}Ne(e){this.De=!0,this.we=this.we.remove(e)}Be(){this.ye+=1}Le(){this.ye-=1}ke(){this.De=!0,this.be=!0}}class Bg{constructor(e){this.qe=e,this.Qe=new Map,this.Ke=_t(),this.$e=Bh(),this.Ue=new Te($)}We(e){for(const t of e.fe)e.ge&&e.ge.isFoundDocument()?this.Ge(t,e.ge):this.ze(t,e.key,e.ge);for(const t of e.removedTargetIds)this.ze(t,e.key,e.ge)}je(e){this.forEachTarget(e,t=>{const r=this.He(t);switch(e.state){case 0:this.Je(t)&&r.Fe(e.resumeToken);break;case 1:r.Le(),r.ve||r.xe(),r.Fe(e.resumeToken);break;case 2:r.Le(),r.ve||this.removeTarget(t);break;case 3:this.Je(t)&&(r.ke(),r.Fe(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),r.Fe(e.resumeToken));break;default:M()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qe.forEach((r,i)=>{this.Je(i)&&t(i)})}Ze(e){var t,r;const i=e.targetId,s=e.pe.count,o=this.Xe(i);if(o){const a=o.target;if(ro(a))if(0===s){const u=new N(a.path);this.ze(i,u,Re.newNoDocument(u,L.min()))}else F(1===s);else{const u=this.et(i);if(u!==s){const c=this.tt(e,u);0!==c.status&&(this.Ye(i),this.Ue=this.Ue.insert(i,2===c.status?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null===(t=Ma.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(h,m,I,x){var C,D,q,j,z,te;const pe={localCacheCount:I,existenceFilterCount:x.count},de=x.unchangedNames;return de&&(pe.bloomFilter={applied:0===h,hashCount:null!==(C=de?.hashCount)&&void 0!==C?C:0,bitmapLength:null!==(j=null===(q=null===(D=de?.bits)||void 0===D?void 0:D.bitmap)||void 0===q?void 0:q.length)&&void 0!==j?j:0,padding:null!==(te=null===(z=de?.bits)||void 0===z?void 0:z.padding)&&void 0!==te?te:0},m&&(pe.bloomFilter.mightContain=m)),pe}(c.status,null!==(r=c.nt)&&void 0!==r?r:null,u,e.pe))}}}}tt(e,t){const{unchangedNames:r,count:i}=e.pe;if(!r||!r.bits)return{status:1};const{bits:{bitmap:s="",padding:o=0},hashCount:a=0}=r;let u,c;try{u=Jt(s).toUint8Array()}catch(h){if(h instanceof $l)return bt("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),{status:1};throw h}try{c=new Oa(u,o,a)}catch(h){return bt(h instanceof Ki?"BloomFilter error: ":"Applying bloom filter failed: ",h),{status:1}}const l=h=>{const m=this.qe.rt();return c.mightContain(`projects/${m.projectId}/databases/${m.database}/documents/${h}`)};return 0===c.de?{status:1}:{status:i===t-this.it(e.targetId,l)?0:2,nt:l}}it(e,t){const r=this.qe.getRemoteKeysForTarget(e);let i=0;return r.forEach(s=>{t(s.path.canonicalString())||(this.ze(e,s,null),i++)}),i}st(e){const t=new Map;this.Qe.forEach((s,o)=>{const a=this.Xe(o);if(a){if(s.current&&ro(a.target)){const u=new N(a.target.path);null!==this.Ke.get(u)||this.ot(o,u)||this.ze(o,u,Re.newNoDocument(u,e))}s.Ce&&(t.set(o,s.Me()),s.xe())}});let r=W();this.$e.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Xe(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.Ke.forEach((s,o)=>o.setReadTime(e));const i=new Qi(e,t,this.Ue,this.Ke,r);return this.Ke=_t(),this.$e=Bh(),this.Ue=new Te($),i}Ge(e,t){if(!this.Je(e))return;const r=this.ot(e,t.key)?2:0;this.He(e).Oe(t.key,r),this.Ke=this.Ke.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e))}ze(e,t,r){if(!this.Je(e))return;const i=this.He(e);this.ot(e,t)?i.Oe(t,1):i.Ne(t),this.$e=this.$e.insert(t,this._t(t).delete(e)),r&&(this.Ke=this.Ke.insert(t,r))}removeTarget(e){this.Qe.delete(e)}et(e){const t=this.He(e).Me();return this.qe.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Be(e){this.He(e).Be()}He(e){let t=this.Qe.get(e);return t||(t=new Lh,this.Qe.set(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new Ae($),this.$e=this.$e.insert(e,t)),t}Je(e){const t=null!==this.Xe(e);return t||b("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.Qe.get(e);return t&&t.ve?null:this.qe.ut(e)}Ye(e){this.Qe.set(e,new Lh),this.qe.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ot(e,t){return this.qe.getRemoteKeysForTarget(e).has(t)}}function Bh(){return new Te(N.comparator)}function Uh(){return new Te(N.comparator)}const Ug={asc:"ASCENDING",desc:"DESCENDING"},qg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zg={and:"AND",or:"OR"};class Gg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Fa(n,e){return n.useProto3Json||Ni(e)?e:{value:e}}function Gr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qh(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function jg(n,e){return Gr(n,e.toTimestamp())}function Le(n){return F(!!n),L.fromTimestamp(function(t){const r=vn(t);return new be(r.seconds,r.nanos)}(n))}function La(n,e){return(r=n,new ae(["projects",r.projectId,"databases",r.database])).child("documents").child(e).canonicalString();var r}function zh(n){const e=ae.fromString(n);return F(Yh(e)),e}function Hi(n,e){return La(n.databaseId,e.path)}function Gt(n,e){const t=zh(e);if(t.get(1)!==n.databaseId.projectId)throw new R(T.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new R(T.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new N(jh(t))}function Ba(n,e){return La(n.databaseId,e)}function Gh(n){const e=zh(n);return 4===e.length?ae.emptyPath():jh(e)}function Zi(n){return new ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function jh(n){return F(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function $h(n,e,t){return{name:Hi(n,e),fields:t.value.mapValue.fields}}function Kh(n,e,t){const r=Gt(n,e.name),i=Le(e.updateTime),s=e.createTime?Le(e.createTime):L.min(),o=new Xe({mapValue:{fields:e.fields}}),a=Re.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Yi(n,e){let t;if(e instanceof qr)t={update:$h(n,e.key,e.value)};else if(e instanceof zr)t={delete:Hi(n,e.key)};else if(e instanceof tn)t={update:$h(n,e.key,e.data),updateMask:Jg(e.fieldMask)};else{if(!(e instanceof Ca))return M();t={verify:Hi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof Br)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof er)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof tr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ur)return{fieldPath:o.field.canonicalString(),increment:a.Te};throw M()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:jg(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:M()),t;var s}function Ua(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?Ve.updateTime(Le(s.updateTime)):void 0!==s.exists?Ve.exists(s.exists):Ve.none():Ve.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;"setToServerValue"in a?(F("REQUEST_TIME"===a.setToServerValue),u=new Br):"appendMissingElements"in a?u=new er(a.appendMissingElements.values||[]):"removeAllFromArray"in a?u=new tr(a.removeAllFromArray.values||[]):"increment"in a?u=new Ur(o,a.increment):M();const c=Ne.fromServerFormat(a.fieldPath);return new ji(c,u)}(n,i)):[];var s;if(e.update){const i=Gt(n,e.update.name),s=new Xe({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new pt((e.updateMask.fieldPaths||[]).map(l=>Ne.fromServerFormat(l)));return new tn(i,s,o,t,r)}return new qr(i,s,t,r)}if(e.delete){const i=Gt(n,e.delete);return new zr(i,t)}if(e.verify){const i=Gt(n,e.verify);return new Ca(i,t)}return M()}function Qh(n,e){return{documents:[Ba(n,e.path)]}}function qa(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Ba(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Ba(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(u){if(0!==u.length)return Zh(me.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(u){if(0!==u.length)return u.map(c=>{return{field:bn((h=c).field),direction:Hg(h.dir)};var h})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=Fa(n,e.limit);return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(u=e.startAt).inclusive,values:u.position}),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),t;var u}function Wh(n){let e=Gh(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){F(1===r);const l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){const m=Hh(h);return m instanceof me&&wa(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(m=>{return new Or(jr((x=m).field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction));var x}));let a=null;t.limit&&(a=function(h){let m;return m="object"==typeof h?h.value:h,Ni(m)?null:m}(t.limit));let u=null;var h;t.startAt&&(u=new Sn((h=t.startAt).values||[],!!h.before));let c=null;return t.endAt&&(c=function(h){return new Sn(h.values||[],!h.before)}(t.endAt)),lh(e,i,o,s,a,"F",u,c)}function Hh(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=jr(t.unaryFilter.field);return X.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=jr(t.unaryFilter.field);return X.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=jr(t.unaryFilter.field);return X.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=jr(t.unaryFilter.field);return X.create(o,"!=",{nullValue:"NULL_VALUE"});default:return M()}}(n):void 0!==n.fieldFilter?X.create(jr((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return M()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return me.create(t.compositeFilter.filters.map(r=>Hh(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M()}}(t.compositeFilter.op))}(n):M();var t}function Hg(n){return Ug[n]}function Zg(n){return qg[n]}function Yg(n){return zg[n]}function bn(n){return{fieldPath:n.canonicalString()}}function jr(n){return Ne.fromServerFormat(n.fieldPath)}function Zh(n){return n instanceof X?function(t){if("=="===t.op){if(Wl(t.value))return{unaryFilter:{field:bn(t.field),op:"IS_NAN"}};if(Ql(t.value))return{unaryFilter:{field:bn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Wl(t.value))return{unaryFilter:{field:bn(t.field),op:"IS_NOT_NAN"}};if(Ql(t.value))return{unaryFilter:{field:bn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bn(t.field),op:Zg(t.op),value:t.value}}}(n):n instanceof me?function(t){const r=t.getFilters().map(i=>Zh(i));return 1===r.length?r[0]:{compositeFilter:{op:Yg(t.op),filters:r}}}(n):M()}function Jg(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Yh(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class nn{constructor(e,t,r,i,s=L.min(),o=L.min(),a=je.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new nn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Jh{constructor(e){this.ct=e}}function Xh(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:fo(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Hi(s=n.ct,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:Gr(s,o.version.toTimestamp()),createTime:Gr(s,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:nr(e.version)};else{if(!e.isUnknownDocument())return M();r.unknownDocument={path:t.path.toArray(),version:nr(e.version)}}var s,o;return r}function fo(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function nr(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function rr(n){const e=new be(n.seconds,n.nanoseconds);return L.fromTimestamp(e)}function ir(n,e){const t=(e.baseMutations||[]).map(s=>Ua(n.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>Ua(n.ct,s)),i=be.fromMillis(e.localWriteTimeMs);return new Da(e.batchId,i,t,r)}function Ji(n){const e=rr(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?rr(n.lastLimboFreeSnapshotVersion):L.min();let r;return r=void 0!==n.query.documents?(F(1===(s=n.query).documents.length),lt(Lr(Gh(s.documents[0])))):function(s){return lt(Wh(s))}(n.query),new nn(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,je.fromBase64String(n.resumeToken));var s}function ed(n,e){const t=nr(e.snapshotVersion),r=nr(e.lastLimboFreeSnapshotVersion);let i;i=ro(e.target)?Qh(n.ct,e.target):qa(n.ct,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Jn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function za(n){const e=Wh({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?oo(e,e.limit,"L"):e}function Ga(n,e){return new ka(e.largestBatchId,Ua(n.ct,e.overlayMutation))}function td(n,e){const t=e.path.lastSegment();return[n,rt(e.path.popLast()),t]}function nd(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:nr(r.readTime),documentKey:rt(r.documentKey.path),largestBatchId:r.largestBatchId}}class ep{getBundleMetadata(e,t){return rd(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:rr(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return rd(e).put({bundleId:(i=t).id,createTime:nr(Le(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return id(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:za(s.bundledQuery),readTime:rr(s.readTime)};var s})}saveNamedQuery(e,t){return id(e).put({name:(i=t).name,readTime:nr(Le(i.readTime)),bundledQuery:i.bundledQuery});var i}}function rd(n){return We(n,"bundles")}function id(n){return We(n,"namedQueries")}class mo{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new mo(e,t.uid||"")}getOverlay(e,t){return Xi(e).get(td(this.userId,t)).next(r=>r?Ga(this.serializer,r):null)}getOverlays(e,t){const r=zt();return _.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const a=new ka(t,o);i.push(this.ht(e,a))}),_.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(rt(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Xi(e).J("collectionPathOverlayIndex",a))}),_.waitFor(s)}getOverlaysForCollection(e,t,r){const i=zt(),s=rt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Xi(e).G("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=Ga(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=zt();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Xi(e).Z({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=Ga(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(e,t){return Xi(e).put(function(i,s,o){const[a,u,c]=td(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Yi(i.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Xi(n){return We(n,"documentOverlays")}class sr{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(ke(e.integerValue));else if("doubleValue"in e){const r=ke(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),ki(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Et(t,20),"string"==typeof r?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Jt(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?Hl(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):M()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const r=e.fields||{};this.Et(t,55);for(const i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){const r=e.values||[];this.Et(t,50);for(const i of r)this.It(i,t)}gt(e,t){this.Et(t,37),N.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function tp(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function sd(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=tp(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(e/8)}sr.bt=new sr;class np{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.vt(r.value),r=t.next();this.Ct()}Ft(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.vt(r);else if(r<2048)this.vt(960|r>>>6),this.vt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.vt(480|r>>>12),this.vt(128|63&r>>>6),this.vt(128|63&r);else{const i=t.codePointAt(0);this.vt(240|i>>>18),this.vt(128|63&i>>>12),this.vt(128|63&i>>>6),this.vt(128|63&i)}}this.Ct()}Nt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{const i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Bt(e){const t=this.Lt(e),r=sd(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){const t=this.Lt(e),r=sd(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Lt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}vt(e){const t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}Ct(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class rp{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Bt(e)}Tt(){this.Gt.Qt()}}class ip{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class es{constructor(){this.Gt=new np,this.zt=new rp(this.Gt),this.jt=new ip(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class or{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new or(this.indexId,this.documentKey,this.arrayValue,r)}}function Vn(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=od(n.arrayValue,e.arrayValue),0!==t?t:(t=od(n.directionalValue,e.directionalValue),0!==t?t:N.comparator(n.documentKey,e.documentKey)))}function od(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class sp{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=r:this.Zt.push(r)}}en(e){F(e.collectionGroup===this.collectionId);const t=ga(e);if(void 0!==t&&!this.tn(t))return!1;const r=Hn(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(void 0!==this.Xt){if(!i.has(this.Xt.field.canonicalString())){const a=r[s];if(!this.nn(this.Xt,a)||!this.rn(this.Yt[o++],a))return!1}++s}for(;s<r.length;++s)if(o>=this.Yt.length||!this.rn(this.Yt[o++],r[s]))return!1;return!0}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function ad(n){var e,t;if(F(n instanceof X||n instanceof me),n instanceof X){if(n instanceof ah){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>X.create(n.field,"==",s)))||[];return me.create(i,"or")}return n}const r=n.filters.map(i=>ad(i));return me.create(r,n.op)}function op(n){if(0===n.getFilters().length)return[];const e=Ka(ad(n));return F(ud(e)),ja(e)||$a(e)?[e]:e.getFilters()}function ja(n){return n instanceof X}function $a(n){return n instanceof me&&wa(n)}function ud(n){return ja(n)||$a(n)||function(t){if(t instanceof me&&va(t)){for(const r of t.getFilters())if(!ja(r)&&!$a(r))return!1;return!0}return!1}(n)}function Ka(n){if(F(n instanceof X||n instanceof me),n instanceof X)return n;if(1===n.filters.length)return Ka(n.filters[0]);const e=n.filters.map(r=>Ka(r));let t=me.create(e,n.op);return t=go(t),ud(t)?t:(F(t instanceof me),F(Fr(t)),F(t.filters.length>1),t.filters.reduce((r,i)=>Qa(r,i)))}function Qa(n,e){let t;return F(n instanceof X||n instanceof me),F(e instanceof X||e instanceof me),t=n instanceof X?e instanceof X?me.create([n,e],"and"):cd(n,e):e instanceof X?cd(e,n):function(i,s){if(F(i.filters.length>0&&s.filters.length>0),Fr(i)&&Fr(s))return ih(i,s.getFilters());const o=va(i)?i:s,a=va(i)?s:i,u=o.filters.map(c=>Qa(c,a));return me.create(u,"or")}(n,e),go(t)}function cd(n,e){if(Fr(e))return ih(e,n.getFilters());{const t=e.filters.map(r=>Qa(n,r));return me.create(t,"or")}}function go(n){if(F(n instanceof X||n instanceof me),n instanceof X)return n;const e=n.getFilters();if(1===e.length)return go(e[0]);if(nh(n))return n;const t=e.map(i=>go(i)),r=[];return t.forEach(i=>{i instanceof X?r.push(i):i instanceof me&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:me.create(r,n.op)}class ap{constructor(){this.sn=new Wa}addToCollectionParentIndex(e,t){return this.sn.add(t),_.resolve()}getCollectionParents(e,t){return _.resolve(this.sn.getEntries(t))}addFieldIndex(e,t){return _.resolve()}deleteFieldIndex(e,t){return _.resolve()}getDocumentsMatchingTarget(e,t){return _.resolve(null)}getIndexType(e,t){return _.resolve(0)}getFieldIndexes(e,t){return _.resolve([])}getNextCollectionGroupToUpdate(e){return _.resolve(null)}getMinOffset(e,t){return _.resolve(vt.min())}getMinOffsetFromCollectionGroup(e,t){return _.resolve(vt.min())}updateCollectionGroup(e,t,r){return _.resolve()}updateIndexEntries(e,t){return _.resolve()}}class Wa{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ae(ae.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ae(ae.comparator)).toArray()}}const po=new Uint8Array(0);class up{constructor(e,t){this.user=e,this.databaseId=t,this.on=new Wa,this._n=new en(r=>Jn(r),(r,i)=>Bi(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.on.add(t)});const s={collectionId:r,parent:rt(i)};return ld(e).put(s)}return _.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Vl(t),""],!1,!0);return ld(e).G(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(Ut(o.parent))}return r})}addFieldIndex(e,t){const r=_o(e),i={indexId:(a=t).indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])};var a;delete i.indexId;const s=r.add(i);if(t.indexState){const o=ns(e);return s.next(a=>{o.put(nd(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=_o(e),i=ns(e),s=ts(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=ts(e);let i=!0;const s=new Map;return _.forEach(this.an(t),o=>this.un(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=W();const a=[];return _.forEach(s,(u,c)=>{var z;b("IndexedDbIndexManager",`Using index ${z=u,`id=${z.indexId}|cg=${z.collectionGroup}|f=${z.fields.map(te=>`${te.fieldPath}:${te.kind}`).join(",")}`} to execute ${Jn(t)}`);const l=function(z,te){const pe=ga(te);if(void 0===pe)return null;for(const de of io(z,pe.fieldPath))switch(de.op){case"array-contains-any":return de.value.arrayValue.values||[];case"array-contains":return[de.value]}return null}(c,u),h=function(z,te){const pe=new Map;for(const de of Hn(te))for(const ot of io(z,de.fieldPath))switch(ot.op){case"==":case"in":pe.set(de.fieldPath.canonicalString(),ot.value);break;case"not-in":case"!=":return pe.set(de.fieldPath.canonicalString(),ot.value),Array.from(pe.values())}return null}(c,u),m=function(z,te){const pe=[];let de=!0;for(const ot of Hn(te)){const ai=0===ot.kind?uh(z,ot.fieldPath,z.startAt):ch(z,ot.fieldPath,z.startAt);pe.push(ai.value),de&&(de=ai.inclusive)}return new Sn(pe,de)}(c,u),I=function(z,te){const pe=[];let de=!0;for(const ot of Hn(te)){const ai=0===ot.kind?ch(z,ot.fieldPath,z.endAt):uh(z,ot.fieldPath,z.endAt);pe.push(ai.value),de&&(de=ai.inclusive)}return new Sn(pe,de)}(c,u),x=this.cn(u,c,m),C=this.cn(u,c,I),D=this.ln(u,c,h),q=this.hn(u.indexId,l,x,m.inclusive,C,I.inclusive,D);return _.forEach(q,j=>r.H(j,t.limit).next(z=>{z.forEach(te=>{const pe=N.fromSegments(te.documentKey);o.has(pe)||(o=o.add(pe),a.push(pe))})}))}).next(()=>a)}return _.resolve(null)})}an(e){let t=this._n.get(e);return t||(t=0===e.filters.length?[e]:op(me.create(e.filters,"and")).map(r=>Ra(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this._n.set(e,t),t)}hn(e,t,r,i,s,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,s.length),c=u/(null!=t?t.length:1),l=[];for(let h=0;h<u;++h){const m=t?this.Pn(t[h/c]):po,I=this.In(e,m,r[h%c],i),x=this.Tn(e,m,s[h%c],o),C=a.map(D=>this.In(e,m,D,!0));l.push(...this.createRange(I,x,C))}return l}In(e,t,r,i){const s=new or(e,N.empty(),t,r);return i?s:s.Jt()}Tn(e,t,r,i){const s=new or(e,N.empty(),t,r);return i?s.Jt():s}un(e,t){const r=new sp(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const i=this.an(t);return _.forEach(i,s=>this.un(e,s).next(o=>{o?0!==r&&o.fields.length<function(u){let c=new Ae(Ne.comparator),l=!1;for(const h of u.filters)for(const m of h.getFlattenedFilters())m.field.isKeyField()||("array-contains"===m.op||"array-contains-any"===m.op?l=!0:c=c.add(m.field));for(const h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}En(e,t){const r=new es;for(const i of Hn(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.Ht(i.kind);sr.bt.Pt(s,o)}return r.Wt()}Pn(e){const t=new es;return sr.bt.Pt(e,t.Ht(0)),t.Wt()}dn(e,t){const r=new es;return sr.bt.Pt(Yn(this.databaseId,t),r.Ht(function(s){const o=Hn(s);return 0===o.length?0:o[o.length-1].kind}(e))),r.Wt()}ln(e,t,r){if(null===r)return[];let i=[];i.push(new es);let s=0;for(const o of Hn(e)){const a=r[s++];for(const u of i)if(this.An(t,o.fieldPath)&&Fi(a))i=this.Rn(i,o,a);else{const c=u.Ht(o.kind);sr.bt.Pt(a,c)}}return this.Vn(i)}cn(e,t,r){return this.ln(e,t,r.position)}Vn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}Rn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const u=new es;u.seed(a.Wt()),sr.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}An(e,t){return!!e.filters.find(r=>r instanceof X&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=_o(e),i=ns(e);return(t?r.G("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.G()).next(s=>{const o=[];return _.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){const m=h?new Ci(h.sequenceNumber,new vt(rr(h.readTime),new N(Ut(h.documentKey)),h.largestBatchId)):Ci.empty(),I=l.fields.map(([x,C])=>new Ws(Ne.fromServerFormat(x),C));return new Qs(l.indexId,l.collectionGroup,I,m)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:$(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=_o(e),s=ns(e);return this.mn(e).next(o=>i.G("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>_.forEach(a,u=>s.put(nd(u.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return _.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?_.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),_.forEach(a,u=>this.fn(e,i,u).next(c=>{const l=this.gn(s,u);return c.isEqual(l)?_.resolve():this.pn(e,s,u,c,l)}))))})}yn(e,t,r,i){return ts(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.dn(r,t.key),documentKey:t.key.path.toArray()})}wn(e,t,r,i){return ts(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.dn(r,t.key),t.key.path.toArray()])}fn(e,t,r){const i=ts(e);let s=new Ae(Vn);return i.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.dn(r,t)])},(o,a)=>{s=s.add(new or(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}gn(e,t){let r=new Ae(Vn);const i=this.En(t,e);if(null==i)return r;const s=ga(t);if(null!=s){const o=e.data.field(s.fieldPath);if(Fi(o))for(const a of o.arrayValue.values||[])r=r.add(new or(t.indexId,e.key,this.Pn(a),i))}else r=r.add(new or(t.indexId,e.key,po,i));return r}pn(e,t,r,i,s){b("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,c,l,h,m){const I=u.getIterator(),x=c.getIterator();let C=kr(I),D=kr(x);for(;C||D;){let q=!1,j=!1;if(C&&D){const z=l(C,D);z<0?j=!0:z>0&&(q=!0)}else null!=C?j=!0:q=!0;q?(h(D),D=kr(x)):j?(m(C),C=kr(I)):(C=kr(I),D=kr(x))}}(i,s,Vn,a=>{o.push(this.yn(e,t,r,a))},a=>{o.push(this.wn(e,t,r,a))}),_.waitFor(o)}mn(e){let t=1;return ns(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Vn(o,a)).filter((o,a,u)=>!a||0!==Vn(o,u[a-1]));const i=[];i.push(e);for(const o of r){const a=Vn(o,e),u=Vn(o,t);if(0===a)i[0]=e.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.Sn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,po,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,po,[]]))}return s}Sn(e,t){return Vn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(hd)}getMinOffset(e,t){return _.mapArray(this.an(t),r=>this.un(e,r).next(i=>i||M())).next(hd)}}function ld(n){return We(n,"collectionParents")}function ts(n){return We(n,"indexEntries")}function _o(n){return We(n,"indexConfiguration")}function ns(n){return We(n,"indexState")}function hd(n){F(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;pa(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new vt(e.readTime,e.documentKey,t)}const dd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class it{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new it(e,it.DEFAULT_COLLECTION_PERCENTILE,it.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function fd(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Z({range:o},(l,h,m)=>(a++,m.delete()));s.push(u.next(()=>{F(1===a)}));const c=[];for(const l of t.mutations){const h=Ll(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return _.waitFor(s).next(()=>c)}function yo(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw M();e=n.noDocument}return JSON.stringify(e).length}it.DEFAULT_COLLECTION_PERCENTILE=10,it.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,it.DEFAULT=new it(41943040,it.DEFAULT_COLLECTION_PERCENTILE,it.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),it.DISABLED=new it(-1,0,0);class Io{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.bn={}}static lt(e,t,r,i){F(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Io(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xn(e).Z({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=$r(e),o=xn(e);return o.add({}).next(a=>{F("number"==typeof a);const u=new Da(a,t,r,i),c=function(I,x,C){const D=C.baseMutations.map(j=>Yi(I.ct,j)),q=C.mutations.map(j=>Yi(I.ct,j));return{userId:x,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:D,mutations:q}}(this.serializer,this.userId,u),l=[];let h=new Ae((m,I)=>$(m.canonicalString(),I.canonicalString()));for(const m of i){const I=Ll(this.userId,m.key.path,a);h=h.add(m.key.path.popLast()),l.push(o.put(c)),l.push(s.put(I,Hm))}return h.forEach(m=>{l.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.bn[a]=u.keys()}),_.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return xn(e).get(t).next(r=>r?(F(r.userId===this.userId),ir(this.serializer,r)):null)}Dn(e,t){return this.bn[t]?_.resolve(this.bn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.bn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return xn(e).Z({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(F(a.batchId>=r),s=ir(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return xn(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xn(e).G("userMutationsIndex",t).next(r=>r.map(i=>ir(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Zs(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return $r(e).Z({range:i},(o,a,u)=>{const[c,l,h]=o,m=Ut(l);if(c===this.userId&&t.path.isEqual(m))return xn(e).get(h).next(I=>{if(!I)throw M();F(I.userId===this.userId),s.push(ir(this.serializer,I))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ae($);const i=[];return t.forEach(s=>{const o=Zs(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=$r(e).Z({range:a},(c,l,h)=>{const[m,I,x]=c,C=Ut(I);m===this.userId&&s.path.isEqual(C)?r=r.add(x):h.done()});i.push(u)}),_.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Zs(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new Ae($);return $r(e).Z({range:o},(u,c,l)=>{const[h,m,I]=u,x=Ut(m);h===this.userId&&r.isPrefixOf(x)?x.length===i&&(a=a.add(I)):l.done()}).next(()=>this.vn(e,a))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(xn(e).get(s).next(o=>{if(null===o)throw M();F(o.userId===this.userId),r.push(ir(this.serializer,o))}))}),_.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return fd(e.ue,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Cn(t.batchId)}),_.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Cn(e){delete this.bn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return _.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return $r(e).Z({range:r},(s,o,a)=>{if(s[0]===this.userId){const u=Ut(s[1]);i.push(u)}else a.done()}).next(()=>{F(0===i.length)})})}containsKey(e,t){return md(e,this.userId,t)}Fn(e){return gd(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function md(n,e,t){const r=Zs(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return $r(n).Z({range:s,Y:!0},(a,u,c)=>{const[l,h,m]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function xn(n){return We(n,"mutations")}function $r(n){return We(n,"documentMutations")}function gd(n){return We(n,"mutationQueues")}class ar{constructor(e){this.Mn=e}next(){return this.Mn+=2,this.Mn}static xn(){return new ar(0)}static On(){return new ar(-1)}}class cp{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Nn(e).next(t=>{const r=new ar(t.highestTargetId);return t.highestTargetId=r.next(),this.Bn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Nn(e).next(t=>L.fromTimestamp(new be(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Nn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Nn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Bn(e,i)))}addTargetData(e,t){return this.Ln(e,t).next(()=>this.Nn(e).next(r=>(r.targetCount+=1,this.kn(t,r),this.Bn(e,r))))}updateTargetData(e,t){return this.Ln(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Kr(e).delete(t.targetId)).next(()=>this.Nn(e)).next(r=>(F(r.targetCount>0),r.targetCount-=1,this.Bn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return Kr(e).Z((o,a)=>{const u=Ji(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>_.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Kr(e).Z((r,i)=>{const s=Ji(i);t(s)})}Nn(e){return pd(e).get("targetGlobalKey").next(t=>(F(null!==t),t))}Bn(e,t){return pd(e).put("targetGlobalKey",t)}Ln(e,t){return Kr(e).put(ed(this.serializer,t))}kn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Nn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Jn(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Kr(e).Z({range:i,index:"queryTargetsIndex"},(o,a,u)=>{const c=Ji(a);Bi(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Cn(e);return t.forEach(o=>{const a=rt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),_.waitFor(i)}removeMatchingKeys(e,t,r){const i=Cn(e);return _.forEach(t,s=>{const o=rt(s.path);return _.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Cn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Cn(e);let s=W();return i.Z({range:r,Y:!0},(o,a,u)=>{const c=Ut(o[1]),l=new N(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){const r=rt(t.path),i=IDBKeyRange.bound([r],[Vl(r)],!1,!0);let s=0;return Cn(e).Z({index:"documentTargetsIndex",Y:!0,range:i},([o,a],u,c)=>{0!==o&&(s++,c.done())}).next(()=>s>0)}ut(e,t){return Kr(e).get(t).next(r=>r?Ji(r):null)}}function Kr(n){return We(n,"targets")}function pd(n){return We(n,"targetGlobal")}function Cn(n){return We(n,"targetDocuments")}function _d([n,e],[t,r]){const i=$(n,t);return 0===i?$(e,r):i}class lp{constructor(e){this.qn=e,this.buffer=new Ae(_d),this.Qn=0}Kn(){return++this.Qn}$n(e){const t=[e,this.Kn()];if(this.buffer.size<this.qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();_d(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class yd{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Un=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Wn(6e4)}stop(){this.Un&&(this.Un.cancel(),this.Un=null)}get started(){return null!==this.Un}Wn(e){var t=this;b("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Un=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,p.Z)(function*(){t.Un=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){En(r)?b("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield In(r)}yield t.Wn(3e5)}))}}class hp{constructor(e,t){this.Gn=e,this.params=t}calculateTargetCount(e,t){return this.Gn.zn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return _.resolve(wt.ae);const r=new lp(t);return this.Gn.forEachTarget(e,i=>r.$n(i.sequenceNumber)).next(()=>this.Gn.jn(e,i=>r.$n(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Gn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Gn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(b("LruGarbageCollector","Garbage collection skipped; disabled"),_.resolve(dd)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(b("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dd):this.Hn(e,t))}getCacheSize(e){return this.Gn.getCacheSize(e)}Hn(e,t){let r,i,s,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(b("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),fa()<=Me.in.DEBUG&&b("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${i} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),_.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}}class dp{constructor(e,t){this.db=e,this.garbageCollector=function Id(n,e){return new hp(n,e)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Jn(e){let t=0;return this.jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}jn(e,t){return this.Yn(e,(r,i)=>t(i))}addReference(e,t,r){return Eo(e,r)}removeReference(e,t,r){return Eo(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Eo(e,t)}Zn(e,t){return function(i,s){let o=!1;return gd(i).X(a=>md(i,a,s).next(u=>(u&&(o=!0),_.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Yn(e,(o,a)=>{if(a<=t){const u=this.Zn(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,L.min()),Cn(e).delete([0,rt(o.path)])))});i.push(u)}}).next(()=>_.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Eo(e,t)}Yn(e,t){const r=Cn(e);let i,s=wt.ae;return r.Z({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(s!==wt.ae&&t(new N(Ut(i)),s),s=c,i=u):s=wt.ae}).next(()=>{s!==wt.ae&&t(new N(Ut(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Eo(n,e){return Cn(n).put((i=n.currentSequenceNumber,{targetId:0,path:rt(e.path),sequenceNumber:i}));var i}class Ed{constructor(){this.changes=new en(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?_.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class fp{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ur(e).put(r)}removeEntry(e,t,r){return ur(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],fo(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Xn(e,r)))}getEntry(e,t){let r=Re.newInvalidDocument(t);return ur(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(rs(t))},(i,s)=>{r=this.er(t,s)}).next(()=>r)}tr(e,t){let r={size:0,document:Re.newInvalidDocument(t)};return ur(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(rs(t))},(i,s)=>{r={document:this.er(t,s),size:yo(s)}}).next(()=>r)}getEntries(e,t){let r=_t();return this.nr(e,t,(i,s)=>{const o=this.er(i,s);r=r.insert(i,o)}).next(()=>r)}rr(e,t){let r=_t(),i=new Te(N.comparator);return this.nr(e,t,(s,o)=>{const a=this.er(s,o);r=r.insert(s,a),i=i.insert(s,yo(o))}).next(()=>({documents:r,ir:i}))}nr(e,t,r){if(t.isEmpty())return _.resolve();let i=new Ae(Ad);t.forEach(u=>i=i.add(u));const s=IDBKeyRange.bound(rs(i.first()),rs(i.last())),o=i.getIterator();let a=o.getNext();return ur(e).Z({index:"documentKeyIndex",range:s},(u,c,l)=>{const h=N.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Ad(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.W(rs(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),fo(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ur(e).G(IDBKeyRange.bound(o,a,!0)).next(u=>{let c=_t();for(const l of u){const h=this.er(N.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);h.isFoundDocument()&&(qi(t,h)||i.has(h.key))&&(c=c.insert(h.key,h))}return c})}getAllFromCollectionGroup(e,t,r,i){let s=_t();const o=wd(t,r),a=wd(t,vt.max());return ur(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.er(N.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new mp(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return vd(e).get("remoteDocumentGlobalKey").next(t=>(F(!!t),t))}Xn(e,t){return vd(e).put("remoteDocumentGlobalKey",t)}er(e,t){if(t){const r=function Xg(n,e){let t;if(e.document)t=Kh(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=N.fromSegments(e.noDocument.path),i=rr(e.noDocument.readTime);t=Re.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return M();{const r=N.fromSegments(e.unknownDocument.path),i=rr(e.unknownDocument.version);t=Re.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new be(i[0],i[1]);return L.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(L.min()))return r}return Re.newInvalidDocument(e)}}function Td(n){return new fp(n)}class mp extends Ed{constructor(e,t){super(),this.sr=e,this.trackRemovals=t,this._r=new en(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new Ae((s,o)=>$(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this._r.get(s);if(t.push(this.sr.removeEntry(e,s,a.readTime)),o.isValidDocument()){const u=Xh(this.sr.serializer,o);i=i.add(s.path.popLast());const c=yo(u);r+=c-a.size,t.push(this.sr.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){const u=Xh(this.sr.serializer,o.convertToNoDocument(L.min()));t.push(this.sr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.sr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.sr.updateMetadata(e,r)),_.waitFor(t)}getFromCache(e,t){return this.sr.tr(e,t).next(r=>(this._r.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.sr.rr(e,t).next(({documents:r,ir:i})=>(i.forEach((s,o)=>{this._r.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function vd(n){return We(n,"remoteDocumentGlobal")}function ur(n){return We(n,"remoteDocumentsV14")}function rs(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function wd(n,e){const t=e.documentKey.path.toArray();return[n,fo(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Ad(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=$(t[s],r[s]),i)return i;return i=$(t.length,r.length),i||(i=$(t[t.length-2],r[r.length-2]),i||$(t[t.length-1],r[r.length-1]))}class gp{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Rd{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&$i(r.mutation,i,pt.empty(),be.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,W()).next(()=>r))}getLocalViewOfDocuments(e,t,r=W()){const i=zt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=zi();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=zt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,W()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=_t();const o=Gi(),a=Gi();return t.forEach((u,c)=>{const l=r.get(c.key);i.has(c.key)&&(void 0===l||l.mutation instanceof tn)?s=s.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),$i(l.mutation,c,l.mutation.getFieldMask(),be.now())):o.set(c.key,pt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new gp(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Gi();let i=new Te((o,a)=>o-a),s=W();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||pt.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(i.get(a.batchId)||W()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=_h();l.forEach(m=>{if(!s.has(m)){const I=Ph(t.get(m),r.get(m));null!==I&&h.set(m,I),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return _.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return N.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Sa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var s}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):_.resolve(zt());let a=-1,u=s;return o.next(c=>_.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?_.resolve():this.remoteDocumentCache.getEntry(e,l).next(m=>{u=u.insert(l,m)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,W())).next(l=>({batchId:a,changes:ph(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new N(t)).next(r=>{let i=zi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let s=zi();return this.indexManager.getCollectionParents(e,i).next(o=>_.forEach(o,a=>{const u=(l=t,h=a.child(i),new Xt(h,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt));var l,h;return this.getDocumentsMatchingCollectionQuery(e,u,r).next(c=>{c.forEach((l,h)=>{s=s.insert(l,h)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i))).next(s=>{i.forEach((a,u)=>{const c=u.getKey();null===s.get(c)&&(s=s.insert(c,Re.newInvalidDocument(c)))});let o=zi();return s.forEach((a,u)=>{const c=i.get(a);void 0!==c&&$i(c.mutation,u,pt.empty(),be.now()),qi(t,u)&&(o=o.insert(a,u))}),o})}}class pp{constructor(e){this.serializer=e,this.ar=new Map,this.ur=new Map}getBundleMetadata(e,t){return _.resolve(this.ar.get(t))}saveBundleMetadata(e,t){return this.ar.set(t.id,{id:(i=t).id,version:i.version,createTime:Le(i.createTime)}),_.resolve();var i}getNamedQuery(e,t){return _.resolve(this.ur.get(t))}saveNamedQuery(e,t){return this.ur.set(t.name,{name:(i=t).name,query:za(i.bundledQuery),readTime:Le(i.readTime)}),_.resolve();var i}}class _p{constructor(){this.overlays=new Te(N.comparator),this.cr=new Map}getOverlay(e,t){return _.resolve(this.overlays.get(t))}getOverlays(e,t){const r=zt();return _.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),_.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.cr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.cr.delete(r)),_.resolve()}getOverlaysForCollection(e,t,r){const i=zt(),s=t.length+1,o=new N(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return _.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Te((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);null===l&&(l=zt(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=zt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return _.resolve(a)}ht(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.cr.get(i.largestBatchId).delete(r.key);this.cr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new ka(t,r));let s=this.cr.get(t);void 0===s&&(s=W(),this.cr.set(t,s)),this.cr.set(t,s.add(r.key))}}class Ha{constructor(){this.lr=new Ae(He.hr),this.Pr=new Ae(He.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(e,t){const r=new He(e,t);this.lr=this.lr.add(r),this.Pr=this.Pr.add(r)}Tr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Er(new He(e,t))}dr(e,t){e.forEach(r=>this.removeReference(r,t))}Ar(e){const t=new N(new ae([])),r=new He(t,e),i=new He(t,e+1),s=[];return this.Pr.forEachInRange([r,i],o=>{this.Er(o),s.push(o.key)}),s}Rr(){this.lr.forEach(e=>this.Er(e))}Er(e){this.lr=this.lr.delete(e),this.Pr=this.Pr.delete(e)}Vr(e){const t=new N(new ae([])),r=new He(t,e),i=new He(t,e+1);let s=W();return this.Pr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new He(e,0),r=this.lr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class He{constructor(e,t){this.key=e,this.mr=t}static hr(e,t){return N.comparator(e.key,t.key)||$(e.mr,t.mr)}static Ir(e,t){return $(e.mr,t.mr)||N.comparator(e.key,t.key)}}class yp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.gr=1,this.pr=new Ae(He.hr)}checkEmpty(e){return _.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.gr;this.gr++;const o=new Da(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.pr=this.pr.add(new He(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return _.resolve(o)}lookupMutationBatch(e,t){return _.resolve(this.yr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.wr(t+1),s=i<0?0:i;return _.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return _.resolve(0===this.mutationQueue.length?-1:this.gr-1)}getAllMutationBatches(e){return _.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new He(t,0),i=new He(t,Number.POSITIVE_INFINITY),s=[];return this.pr.forEachInRange([r,i],o=>{const a=this.yr(o.mr);s.push(a)}),_.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ae($);return t.forEach(i=>{const s=new He(i,0),o=new He(i,Number.POSITIVE_INFINITY);this.pr.forEachInRange([s,o],a=>{r=r.add(a.mr)})}),_.resolve(this.Sr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;N.isDocumentKey(s)||(s=s.child(""));const o=new He(new N(s),0);let a=new Ae($);return this.pr.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.mr)),!0)},o),_.resolve(this.Sr(a))}Sr(e){const t=[];return e.forEach(r=>{const i=this.yr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){F(0===this.br(t.batchId,"removed")),this.mutationQueue.shift();let r=this.pr;return _.forEach(t.mutations,i=>{const s=new He(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.pr=r})}Cn(e){}containsKey(e,t){const r=new He(t,0),i=this.pr.firstAfterOrEqual(r);return _.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return _.resolve()}br(e,t){return this.wr(e)}wr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}yr(e){const t=this.wr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ip{constructor(e){this.Dr=e,this.docs=new Te(N.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Dr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return _.resolve(r?r.document.mutableCopy():Re.newInvalidDocument(t))}getEntries(e,t){let r=_t();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Re.newInvalidDocument(i))}),_.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=_t();const o=t.path,a=new N(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||pa(Cl(l),r)<=0||(i.has(l.key)||qi(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return _.resolve(s)}getAllFromCollectionGroup(e,t,r,i){M()}vr(e,t){return _.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Ep(this)}getSize(e){return _.resolve(this.size)}}class Ep extends Ed{constructor(e){super(),this.sr=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.sr.addEntry(e,i)):this.sr.removeEntry(r)}),_.waitFor(t)}getFromCache(e,t){return this.sr.getEntry(e,t)}getAllFromCache(e,t){return this.sr.getEntries(e,t)}}class Tp{constructor(e){this.persistence=e,this.Cr=new en(t=>Jn(t),Bi),this.lastRemoteSnapshotVersion=L.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new Ha,this.targetCount=0,this.Or=ar.xn()}forEachTarget(e,t){return this.Cr.forEach((r,i)=>t(i)),_.resolve()}getLastRemoteSnapshotVersion(e){return _.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return _.resolve(this.Fr)}allocateTargetId(e){return this.highestTargetId=this.Or.next(),_.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Fr&&(this.Fr=t),_.resolve()}Ln(e){this.Cr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Or=new ar(t),this.highestTargetId=t),e.sequenceNumber>this.Fr&&(this.Fr=e.sequenceNumber)}addTargetData(e,t){return this.Ln(t),this.targetCount+=1,_.resolve()}updateTargetData(e,t){return this.Ln(t),_.resolve()}removeTargetData(e,t){return this.Cr.delete(t.target),this.Mr.Ar(t.targetId),this.targetCount-=1,_.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Cr.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Cr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),_.waitFor(s).next(()=>i)}getTargetCount(e){return _.resolve(this.targetCount)}getTargetData(e,t){const r=this.Cr.get(t)||null;return _.resolve(r)}addMatchingKeys(e,t,r){return this.Mr.Tr(t,r),_.resolve()}removeMatchingKeys(e,t,r){this.Mr.dr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),_.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Mr.Ar(t),_.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Mr.Vr(t);return _.resolve(r)}containsKey(e,t){return _.resolve(this.Mr.containsKey(t))}}class Za{constructor(e,t){this.Nr={},this.overlays={},this.Br=new wt(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=e(this),this.kr=new Tp(this),this.indexManager=new ap,this.remoteDocumentCache=new Ip(r=>this.referenceDelegate.qr(r)),this.serializer=new Jh(t),this.Qr=new pp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _p,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Nr[e.toKey()];return r||(r=new yp(t,this.referenceDelegate),this.Nr[e.toKey()]=r),r}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(e,t,r){b("MemoryPersistence","Starting transaction:",e);const i=new vp(this.Br.next());return this.referenceDelegate.Kr(),r(i).next(s=>this.referenceDelegate.$r(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ur(e,t){return _.or(Object.values(this.Nr).map(r=>()=>r.containsKey(e,t)))}}class vp extends Nl{constructor(e){super(),this.currentSequenceNumber=e}}class To{constructor(e){this.persistence=e,this.Wr=new Ha,this.Gr=null}static zr(e){return new To(e)}get jr(){if(this.Gr)return this.Gr;throw M()}addReference(e,t,r){return this.Wr.addReference(r,t),this.jr.delete(r.toString()),_.resolve()}removeReference(e,t,r){return this.Wr.removeReference(r,t),this.jr.add(r.toString()),_.resolve()}markPotentiallyOrphaned(e,t){return this.jr.add(t.toString()),_.resolve()}removeTarget(e,t){this.Wr.Ar(t.targetId).forEach(i=>this.jr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Kr(){this.Gr=new Set}$r(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _.forEach(this.jr,r=>{const i=N.fromPath(r);return this.Hr(e,i).next(s=>{s||t.removeEntry(i,L.min())})}).next(()=>(this.Gr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hr(e,t).next(r=>{r?this.jr.delete(t.toString()):this.jr.add(t.toString())})}qr(e){return 0}Hr(e,t){return _.or([()=>_.resolve(this.Wr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ur(e,t)])}}class wp{constructor(e){this.serializer=e}B(e,t,r,i){const s=new Hs("createOrUpgrade",t);var u;r<1&&i>=1&&(e.createObjectStore("owner"),(u=e).createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Fl,{unique:!0}),u.createObjectStore("documentMutations"),Pd(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=_.resolve();return r<3&&i>=3&&(0!==r&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),Pd(e)),o=o.next(()=>function(u){const c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:L.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(u,c){return c.store("mutations").G().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Fl,{unique:!0});const h=c.store("mutations"),m=l.map(I=>h.put(I));return _.waitFor(m)})}(e,s))),o=o.next(()=>{!function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Yr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.Zr(s)))),r<7&&i>=7&&(o=o.next(()=>this.Xr(s))),r<8&&i>=8&&(o=o.next(()=>this.ei(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ti(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(u){const c=u.createObjectStore("documentOverlays",{keyPath:ag});c.createIndex("collectionPathOverlayIndex",ug,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",cg,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){const c=u.createObjectStore("remoteDocumentsV14",{keyPath:Zm});c.createIndex("documentKeyIndex",Ym),c.createIndex("collectionGroupIndex",Jm)}(e)).next(()=>this.ni(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ri(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:rg}).createIndex("sequenceNumberIndex",ig,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:sg}).createIndex("documentKeyIndex",og,{unique:!1})}(e))),o}Zr(e){let t=0;return e.store("remoteDocuments").Z((r,i)=>{t+=yo(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Yr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.G().next(i=>_.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.G("userMutationsIndex",o).next(a=>_.forEach(a,u=>{F(u.userId===s.userId);const c=ir(this.serializer,u);return fd(e,s.userId,c).next(()=>{})}))}))}Xr(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Z((o,a)=>{const u=new ae(o),c=[0,rt(u)];s.push(t.get(c).next(l=>l?_.resolve():t.put({targetId:0,path:rt(u),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>_.waitFor(s))})}ei(e,t){e.createObjectStore("collectionParents",{keyPath:ng});const r=t.store("collectionParents"),i=new Wa,s=o=>{if(i.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:rt(u)})}};return t.store("remoteDocuments").Z({Y:!0},(o,a)=>{const u=new ae(o);return s(u.popLast())}).next(()=>t.store("documentMutations").Z({Y:!0},([o,a,u],c)=>{const l=Ut(a);return s(l.popLast())}))}ti(e){const t=e.store("targets");return t.Z((r,i)=>{const s=Ji(i),o=ed(this.serializer,s);return t.put(o)})}ni(e,t){const r=t.store("remoteDocuments"),i=[];return r.Z((s,o)=>{const a=t.store("remoteDocumentsV14"),u=(h=o,h.document?new N(ae.fromString(h.document.name).popFirst(5)):h.noDocument?N.fromSegments(h.noDocument.path):h.unknownDocument?N.fromSegments(h.unknownDocument.path):M()).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var h;i.push(a.put(c))}).next(()=>_.waitFor(i))}ri(e,t){const r=t.store("mutations"),i=Td(this.serializer),s=new Za(To.zr,this.serializer.ct);return r.G().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:W();ir(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),_.forEach(a,(u,c)=>{const l=new Qe(c),h=mo.lt(this.serializer,l),m=s.getIndexManager(l),I=Io.lt(l,this.serializer,m,s.referenceDelegate);return new Rd(i,I,h,m).recalculateAndSaveOverlaysForDocumentKeys(new Ia(t,wt.ae),u).next()})})}}function Pd(n){n.createObjectStore("targetDocuments",{keyPath:eg}).createIndex("documentTargetsIndex",tg,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Xm,{unique:!0}),n.createObjectStore("targetGlobal")}const Ya="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ja{constructor(e,t,r,i,s,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ii=s,this.window=o,this.document=a,this.si=c,this.oi=l,this._i=h,this.Br=null,this.Lr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ai=null,this.inForeground=!1,this.ui=null,this.ci=null,this.li=Number.NEGATIVE_INFINITY,this.hi=m=>Promise.resolve(),!Ja.v())throw new R(T.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new dp(this,i),this.Pi=t+"main",this.serializer=new Jh(u),this.Ii=new Nt(this.Pi,this._i,new wp(this.serializer)),this.kr=new cp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Td(this.serializer),this.Qr=new ep,this.window&&this.window.localStorage?this.Ti=this.window.localStorage:(this.Ti=null,!1===l&&Fe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ei().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new R(T.FAILED_PRECONDITION,Ya);return this.di(),this.Ai(),this.Ri(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.kr.getHighestSequenceNumber(e))}).then(e=>{this.Br=new wt(e,this.si)}).then(()=>{this.Lr=!0}).catch(e=>(this.Ii&&this.Ii.close(),Promise.reject(e)))}Vi(e){var t=this;return this.hi=function(){var r=(0,p.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ii.k(function(){var t=(0,p.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((0,p.Z)(function*(){t.started&&(yield t.Ei())})))}Ei(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>wo(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.mi(e).next(t=>{t||(this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.hi(!1)))})}).next(()=>this.fi(e)).next(t=>this.isPrimary&&!t?this.gi(e).next(()=>!1):!!t&&this.pi(e).next(()=>!0))).catch(e=>{if(En(e))return b("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return b("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ii.enqueueRetryable(()=>this.hi(e)),this.isPrimary=e})}mi(e){return is(e).get("owner").next(t=>_.resolve(this.yi(t)))}wi(e){return wo(e).delete(this.clientId)}Si(){var e=this;return(0,p.Z)(function*(){if(e.isPrimary&&!e.bi(e.li,18e5)){e.li=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=We(r,"clientMetadata");return i.G().next(s=>{const o=e.Di(s,18e5),a=s.filter(u=>-1===o.indexOf(u));return _.forEach(a,u=>i.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Ti)for(const r of t)e.Ti.removeItem(e.vi(r.clientId))}})()}Ri(){this.ci=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ei().then(()=>this.Si()).then(()=>this.Ri()))}yi(e){return!!e&&e.ownerId===this.clientId}fi(e){return this.oi?_.resolve(!0):is(e).get("owner").next(t=>{if(null!==t&&this.bi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.yi(t)&&this.networkEnabled)return!0;if(!this.yi(t)){if(!t.allowTabSynchronization)throw new R(T.FAILED_PRECONDITION,Ya);return!1}}return!(!this.networkEnabled||!this.inForeground)||wo(e).G().next(r=>void 0===this.Di(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&b("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,p.Z)(function*(){e.Lr=!1,e.Fi(),e.ci&&(e.ci.cancel(),e.ci=null),e.Mi(),e.xi(),yield e.Ii.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Ia(t,wt.ae);return e.gi(r).next(()=>e.wi(r))}),e.Ii.close(),e.Oi()})()}Di(e,t){return e.filter(r=>this.bi(r.updateTimeMs,t)&&!this.Ci(r.clientId))}Ni(){return this.runTransaction("getActiveClients","readonly",e=>wo(e).G().next(t=>this.Di(t,18e5).map(r=>r.clientId)))}get started(){return this.Lr}getMutationQueue(e,t){return Io.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new up(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return mo.lt(this.serializer,e)}getBundleCache(){return this.Qr}runTransaction(e,t,r){b("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this._i)?hg:14===u?ql:13===u?Ul:12===u?lg:11===u?Bl:void M();var u;let o;return this.Ii.runTransaction(e,i,s,a=>(o=new Ia(a,this.Br?this.Br.next():wt.ae),"readwrite-primary"===t?this.mi(o).next(u=>!!u||this.fi(o)).next(u=>{if(!u)throw Fe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.hi(!1)),new R(T.FAILED_PRECONDITION,Dl);return r(o)}).next(u=>this.pi(o).next(()=>u)):this.Bi(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Bi(e){return is(e).get("owner").next(t=>{if(null!==t&&this.bi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)&&!this.yi(t)&&!(this.oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new R(T.FAILED_PRECONDITION,Ya)})}pi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return is(e).put("owner",t)}static v(){return Nt.v()}gi(e){const t=is(e);return t.get("owner").next(r=>this.yi(r)?(b("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):_.resolve())}bi(e,t){const r=Date.now();return!(e<r-t||e>r&&(Fe(`Detected an update time that is in the future: ${e} > ${r}`),1))}di(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ui=()=>{this.ii.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ei()))},this.document.addEventListener("visibilitychange",this.ui),this.inForeground="visible"===this.document.visibilityState)}Mi(){this.ui&&(this.document.removeEventListener("visibilitychange",this.ui),this.ui=null)}Ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ai=()=>{this.Fi();const t=/(?:Version|Mobile)\/1[456]/;(0,Q.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ai))}xi(){this.ai&&(this.window.removeEventListener("pagehide",this.ai),this.ai=null)}Ci(e){var t;try{const r=null!==(null===(t=this.Ti)||void 0===t?void 0:t.getItem(this.vi(e)));return b("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Fe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Fi(){if(this.Ti)try{this.Ti.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){Fe("Failed to set zombie client id.",e)}}Oi(){if(this.Ti)try{this.Ti.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function is(n){return We(n,"owner")}function wo(n){return We(n,"clientMetadata")}function Xa(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class eu{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Li=r,this.ki=i}static qi(e,t){let r=W(),i=W();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new eu(e,t.fromCache,r,i)}}class Sd{constructor(){this.Qi=!1}initialize(e,t){this.Ki=e,this.indexManager=t,this.Qi=!0}getDocumentsMatchingQuery(e,t,r,i){return this.$i(e,t).next(s=>s||this.Ui(e,t,i,r)).next(s=>s||this.Wi(e,t))}$i(e,t){if(hh(t))return _.resolve(null);let r=lt(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=oo(t,null,"F"),r=lt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=W(...s);return this.Ki.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Gi(t,a);return this.zi(t,c,o,u.readTime)?this.$i(e,oo(t,null,"F")):this.ji(e,c,t,u)}))})))}Ui(e,t,r,i){return hh(t)||i.isEqual(L.min())?this.Wi(e,t):this.Ki.getDocuments(e,r).next(s=>{const o=this.Gi(t,s);return this.zi(t,o,r,i)?this.Wi(e,t):(fa()<=Me.in.DEBUG&&b("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Va(t)),this.ji(e,o,t,xl(i,-1)))})}Gi(e,t){let r=new Ae(mh(e));return t.forEach((i,s)=>{qi(e,s)&&(r=r.add(s))}),r}zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Wi(e,t){return fa()<=Me.in.DEBUG&&b("QueryEngine","Using full collection scan to execute query:",Va(t)),this.Ki.getDocumentsMatchingQuery(e,t,vt.min())}ji(e,t,r,i){return this.Ki.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class Ap{constructor(e,t,r,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new Te($),this.Yi=new en(s=>Jn(s),Bi),this.Zi=new Map,this.Xi=e.getRemoteDocumentCache(),this.kr=e.getTargetCache(),this.Qr=e.getBundleCache(),this.es(r)}es(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rd(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function bd(n,e,t,r){return new Ap(n,e,t,r)}function Vd(n,e){return tu.apply(this,arguments)}function tu(){return tu=(0,p.Z)(function*(n,e){const t=k(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.es(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=W();for(const c of i){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of s){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({ts:c,removedBatchIds:o,addedBatchIds:a}))})})}),tu.apply(this,arguments)}function Rp(n,e){const t=k(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Xi.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){const h=c.batch,m=h.keys();let I=_.resolve();return m.forEach(x=>{I=I.next(()=>l.getEntry(u,x)).next(C=>{const D=c.docVersions.get(x);F(null!==D),C.version.compareTo(D)<0&&(h.applyToRemoteDocument(C,c),C.isValidDocument()&&(C.setReadTime(c.commitVersion),l.addEntry(C)))})}),I.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=W();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function xd(n){const e=k(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.kr.getLastRemoteSnapshotVersion(t))}function Pp(n,e){const t=k(n),r=e.snapshotVersion;let i=t.Ji;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.Xi.newChangeBuffer({trackRemovals:!0});i=t.Ji;const a=[];e.targetChanges.forEach((l,h)=>{const m=i.get(h);if(!m)return;a.push(t.kr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.kr.addMatchingKeys(s,l.addedDocuments,h)));let I=m.withSequenceNumber(s.currentSequenceNumber);var C,D,q;null!==e.targetMismatches.get(h)?I=I.withResumeToken(je.EMPTY_BYTE_STRING,L.min()).withLastLimboFreeSnapshotVersion(L.min()):l.resumeToken.approximateByteSize()>0&&(I=I.withResumeToken(l.resumeToken,r)),i=i.insert(h,I),D=I,q=l,(0===(C=m).resumeToken.approximateByteSize()||D.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=3e8||q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0)&&a.push(t.kr.updateTargetData(s,I))});let u=_t(),c=W();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(Cd(s,o,e.documentUpdates).next(l=>{u=l.ns,c=l.rs})),!r.isEqual(L.min())){const l=t.kr.getLastRemoteSnapshotVersion(s).next(h=>t.kr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return _.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.Ji=i,s))}function Cd(n,e,t){let r=W(),i=W();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=_t();return t.forEach((a,u)=>{const c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(L.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):b("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{ns:o,rs:i}})}function Sp(n,e){const t=k(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Qr(n,e){const t=k(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.kr.getTargetData(r,e).next(s=>s?(i=s,_.resolve(i)):t.kr.allocateTargetId(r).next(o=>(i=new nn(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.kr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Ji.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ji=t.Ji.insert(r.targetId,r),t.Yi.set(e,r.targetId)),r})}function Wr(n,e,t){return nu.apply(this,arguments)}function nu(){return nu=(0,p.Z)(function*(n,e,t){const r=k(n),i=r.Ji.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!En(o))throw o;b("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ji=r.Ji.remove(e),r.Yi.delete(i.target)}),nu.apply(this,arguments)}function Ao(n,e,t){const r=k(n);let i=L.min(),s=W();return r.persistence.runTransaction("Execute query","readonly",o=>function(u,c,l){const h=k(u),m=h.Yi.get(l);return void 0!==m?_.resolve(h.Ji.get(m)):h.kr.getTargetData(c,l)}(r,o,lt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.kr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.Hi.getDocumentsMatchingQuery(o,e,t?i:L.min(),t?s:W())).next(a=>(kd(r,fh(e),a),{documents:a,ss:s})))}function Dd(n,e){const t=k(n),r=k(t.kr),i=t.Ji.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ut(s,e).next(o=>o?o.target:null))}function Nd(n,e){const t=k(n),r=t.Zi.get(e)||L.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Xi.getAllFromCollectionGroup(i,e,xl(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(kd(t,e,i),i))}function kd(n,e,t){let r=n.Zi.get(e)||L.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Zi.set(e,r)}function ru(){return ru=(0,p.Z)(function*(n,e,t,r){const i=k(n);let s=W(),o=_t();for(const c of t){const l=e.os(c.metadata.name);c.document&&(s=s.add(l));const h=e._s(c);h.setReadTime(e.us(c.metadata.readTime)),o=o.insert(l,h)}const a=i.Xi.newChangeBuffer({trackRemovals:!0}),u=yield Qr(i,(l=r,lt(Lr(ae.fromString(`__bundle__/docs/${l}`)))));var l;return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>Cd(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.kr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.kr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.ns,l.rs)).next(()=>l.ns)))}),ru.apply(this,arguments)}function Vp(n,e){return iu.apply(this,arguments)}function iu(){return iu=(0,p.Z)(function*(n,e,t=W()){const r=yield Qr(n,lt(za(e.bundledQuery))),i=k(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=Le(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qr.saveNamedQuery(s,e);const a=r.withResumeToken(je.EMPTY_BYTE_STRING,o);return i.Ji=i.Ji.insert(a.targetId,a),i.kr.updateTargetData(s,a).next(()=>i.kr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.kr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Qr.saveNamedQuery(s,e))})}),iu.apply(this,arguments)}function Md(n,e){return`firestore_clients_${n}_${e}`}function Od(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function su(n,e){return`firestore_targets_${n}_${e}`}class Ro{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static cs(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new R(i.error.code,i.error.message))),o?new Ro(e,t,i.state,s):(Fe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ls(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ss{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static cs(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new R(r.error.code,r.error.message))),s?new ss(e,r.state,i):(Fe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ls(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Po{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static cs(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=xa();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Ml(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new Po(e,s):(Fe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class ou{constructor(e,t){this.clientId=e,this.onlineState=t}static cs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ou(t.clientId,t.onlineState):(Fe("SharedClientState",`Failed to parse online state: ${e}`),null)}}class au{constructor(){this.activeTargetIds=xa()}hs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ps(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ls(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class uu{constructor(e,t,r,i,s){this.window=e,this.ii=t,this.persistenceKey=r,this.Is=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ts=this.Es.bind(this),this.ds=new Te($),this.started=!1,this.As=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Rs=Md(this.persistenceKey,this.Is),this.Vs=`firestore_sequence_number_${this.persistenceKey}`,this.ds=this.ds.insert(this.Is,new au),this.fs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.gs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.ps=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.ys=`firestore_online_state_${this.persistenceKey}`,this.ws=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ts)}static v(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,p.Z)(function*(){const t=yield e.syncEngine.Ni();for(const i of t){if(i===e.Is)continue;const s=e.getItem(Md(e.persistenceKey,i));if(s){const o=Po.cs(i,s);o&&(e.ds=e.ds.insert(o.clientId,o))}}e.Ss();const r=e.storage.getItem(e.ys);if(r){const i=e.bs(r);i&&e.Ds(i)}for(const i of e.As)e.Es(i);e.As=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.vs(this.ds)}isActiveQueryTarget(e){let t=!1;return this.ds.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Cs(e,"pending")}updateMutationState(e,t,r){this.Cs(e,t,r),this.Fs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(su(this.persistenceKey,e));if(r){const i=ss.cs(e,r);i&&(t=i.state)}}return this.Ms.hs(e),this.Ss(),t}removeLocalQueryTarget(e){this.Ms.Ps(e),this.Ss()}isLocalQueryTarget(e){return this.Ms.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(su(this.persistenceKey,e))}updateQueryState(e,t,r){this.xs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Fs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Os(e)}notifyBundleLoaded(e){this.Ns(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ts),this.removeItem(this.Rs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return b("SharedClientState","READ",e,t),t}setItem(e,t){b("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){b("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Es(e){var t=this;const r=e;if(r.storageArea===this.storage){if(b("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Rs)return void Fe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((0,p.Z)(function*(){if(t.started){if(null!==r.key)if(t.fs.test(r.key)){if(null==r.newValue){const i=t.Bs(r.key);return t.Ls(i,null)}{const i=t.ks(r.key,r.newValue);if(i)return t.Ls(i.clientId,i)}}else if(t.gs.test(r.key)){if(null!==r.newValue){const i=t.qs(r.key,r.newValue);if(i)return t.Qs(i)}}else if(t.ps.test(r.key)){if(null!==r.newValue){const i=t.Ks(r.key,r.newValue);if(i)return t.$s(i)}}else if(r.key===t.ys){if(null!==r.newValue){const i=t.bs(r.newValue);if(i)return t.Ds(i)}}else if(r.key===t.Vs){const i=function(o){let a=wt.ae;if(null!=o)try{const u=JSON.parse(o);F("number"==typeof u),a=u}catch(u){Fe("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(r.newValue);i!==wt.ae&&t.sequenceNumberHandler(i)}else if(r.key===t.ws){const i=t.Us(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Ws(s)))}}else t.As.push(r)}))}}get Ms(){return this.ds.get(this.Is)}Ss(){this.setItem(this.Rs,this.Ms.ls())}Cs(e,t,r){const i=new Ro(this.currentUser,e,t,r),s=Od(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ls())}Fs(e){const t=Od(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Os(e){this.storage.setItem(this.ys,JSON.stringify({clientId:this.Is,onlineState:e}))}xs(e,t,r){const i=su(this.persistenceKey,e),s=new ss(e,t,r);this.setItem(i,s.ls())}Ns(e){const t=JSON.stringify(Array.from(e));this.setItem(this.ws,t)}Bs(e){const t=this.fs.exec(e);return t?t[1]:null}ks(e,t){const r=this.Bs(e);return Po.cs(r,t)}qs(e,t){const r=this.gs.exec(e),i=Number(r[1]);return Ro.cs(new Qe(void 0!==r[2]?r[2]:null),i,t)}Ks(e,t){const r=this.ps.exec(e),i=Number(r[1]);return ss.cs(i,t)}bs(e){return ou.cs(e)}Us(e){return JSON.parse(e)}Qs(e){var t=this;return(0,p.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Gs(e.batchId,e.state,e.error);b("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}$s(e){return this.syncEngine.zs(e.targetId,e.state,e.error)}Ls(e,t){const r=t?this.ds.insert(e,t):this.ds.remove(e),i=this.vs(this.ds),s=this.vs(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.js(o,a).then(()=>{this.ds=r})}Ds(e){this.ds.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}vs(e){let t=xa();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Fd{constructor(){this.Hs=new au,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Hs.hs(e),this.Js[e]||"not-current"}updateQueryState(e,t,r){this.Js[e]=t}removeLocalQueryTarget(e){this.Hs.Ps(e)}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){delete this.Js[e]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(e){return this.Hs.activeTargetIds.has(e)}start(){return this.Hs=new au,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class xp{Ys(e){}shutdown(){}}class Ld{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(e){this.ro.push(e)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){b("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ro)e(0)}no(){b("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ro)e(1)}static v(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let So=null;function cu(){return null===So?So=268435456+Math.round(2147483648*Math.random()):So++,"0x"+So.toString(16)}const Cp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Dp{constructor(e){this.so=e.so,this.oo=e.oo}_o(e){this.ao=e}uo(e){this.co=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.so(e)}ho(){this.ao()}Po(e){this.co(e)}Io(e){this.lo(e)}}const st="WebChannelConnection";class Np extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.To=(t.ssl?"https":"http")+"://"+t.host,this.Eo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get Ao(){return!1}Ro(t,r,i,s,o){const a=cu(),u=this.Vo(t,r);b("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const c={};return this.mo(c,s,o),this.fo(t,u,c,i).then(l=>(b("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw bt("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}po(t,r,i,s,o,a){return this.Ro(t,r,i,s,o)}mo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Dr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Vo(t,r){return`${this.To}/v1/${r}:${Cp[t]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}fo(e,t,r,i){const s=cu();return new Promise((o,a)=>{const u=new xm;u.setWithCredentials(!0),u.listenOnce(Sm.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case da.NO_ERROR:const l=u.getResponseJson();b(st,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case da.TIMEOUT:b(st,`RPC '${e}' ${s} timed out`),a(new R(T.DEADLINE_EXCEEDED,"Request time out"));break;case da.HTTP_ERROR:const h=u.getStatus();if(b(st,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);const I=m?.error;if(I&&I.status&&I.message){const x=function(D){const q=D.toLowerCase().replace(/_/g,"-");return Object.values(T).indexOf(q)>=0?q:T.UNKNOWN}(I.status);a(new R(x,I.message))}else a(new R(T.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new R(T.UNAVAILABLE,"Connection failed."));break;default:M()}}finally{b(st,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);b(st,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}yo(e,t,r){const i=cu(),s=[this.To,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Rm(),a=Pm(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new Vm({})),this.mo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const l=s.join("");b(st,`Creating RPC '${e}' stream ${i}: ${l}`,u);const h=o.createWebChannel(l,u);let m=!1,I=!1;const x=new Dp({so:D=>{I?b(st,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(m||(b(st,`Opening RPC '${e}' stream ${i} transport.`),h.open(),m=!0),b(st,`RPC '${e}' stream ${i} sending:`,D),h.send(D))},oo:()=>h.close()}),C=(D,q,j)=>{D.listen(q,z=>{try{j(z)}catch(te){setTimeout(()=>{throw te},0)}})};return C(h,Ks.EventType.OPEN,()=>{I||b(st,`RPC '${e}' stream ${i} transport opened.`)}),C(h,Ks.EventType.CLOSE,()=>{I||(I=!0,b(st,`RPC '${e}' stream ${i} transport closed`),x.Po())}),C(h,Ks.EventType.ERROR,D=>{I||(I=!0,bt(st,`RPC '${e}' stream ${i} transport errored:`,D),x.Po(new R(T.UNAVAILABLE,"The operation could not be completed")))}),C(h,Ks.EventType.MESSAGE,D=>{var q;if(!I){const j=D.data[0];F(!!j);const te=j.error||(null===(q=j[0])||void 0===q?void 0:q.error);if(te){b(st,`RPC '${e}' stream ${i} received error:`,te);const pe=te.status;let de=function(Qy){const Xf=qe[Qy];if(void 0!==Xf)return Dh(Xf)}(pe),ot=te.message;void 0===de&&(de=T.INTERNAL,ot="Unknown error status: "+pe+" with message "+te.message),I=!0,x.Po(new R(de,ot)),h.close()}else b(st,`RPC '${e}' stream ${i} received:`,j),x.Io(j)}}),C(a,bm.STAT_EVENT,D=>{D.stat===Al.PROXY?b(st,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===Al.NOPROXY&&b(st,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.ho()},0),x}}function Bd(){return typeof window<"u"?window:null}function bo(){return typeof document<"u"?document:null}function os(n){return new Gg(n,!0)}class lu{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ii=e,this.timerId=t,this.wo=r,this.So=i,this.bo=s,this.Do=0,this.vo=null,this.Co=Date.now(),this.reset()}reset(){this.Do=0}Fo(){this.Do=this.bo}Mo(e){this.cancel();const t=Math.floor(this.Do+this.xo()),r=Math.max(0,Date.now()-this.Co),i=Math.max(0,t-r);i>0&&b("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Do} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.vo=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Co=Date.now(),e())),this.Do*=this.So,this.Do<this.wo&&(this.Do=this.wo),this.Do>this.bo&&(this.Do=this.bo)}Oo(){null!==this.vo&&(this.vo.skipDelay(),this.vo=null)}cancel(){null!==this.vo&&(this.vo.cancel(),this.vo=null)}xo(){return(Math.random()-.5)*this.Do}}class Ud{constructor(e,t,r,i,s,o,a,u){this.ii=e,this.No=r,this.Bo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Lo=0,this.ko=null,this.qo=null,this.stream=null,this.Qo=new lu(e,t)}Ko(){return 1===this.state||5===this.state||this.$o()}$o(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Uo()}stop(){var e=this;return(0,p.Z)(function*(){e.Ko()&&(yield e.close(0))})()}Wo(){this.state=0,this.Qo.reset()}Go(){this.$o()&&null===this.ko&&(this.ko=this.ii.enqueueAfterDelay(this.No,6e4,()=>this.zo()))}jo(e){this.Ho(),this.stream.send(e)}zo(){var e=this;return(0,p.Z)(function*(){if(e.$o())return e.close(0)})()}Ho(){this.ko&&(this.ko.cancel(),this.ko=null)}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}close(e,t){var r=this;return(0,p.Z)(function*(){r.Ho(),r.Jo(),r.Qo.cancel(),r.Lo++,4!==e?r.Qo.reset():t&&t.code===T.RESOURCE_EXHAUSTED?(Fe(t.toString()),Fe("Using maximum backoff delay to prevent overloading the backend."),r.Qo.Fo()):t&&t.code===T.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Yo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.uo(t)})()}Yo(){}auth(){this.state=1;const e=this.Zo(this.Lo),t=this.Lo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Lo===t&&this.Xo(r,i)},r=>{e(()=>{const i=new R(T.UNKNOWN,"Fetching auth token failed: "+r.message);return this.e_(i)})})}Xo(e,t){const r=this.Zo(this.Lo);this.stream=this.t_(e,t),this.stream._o(()=>{r(()=>(this.state=2,this.qo=this.ii.enqueueAfterDelay(this.Bo,1e4,()=>(this.$o()&&(this.state=3),Promise.resolve())),this.listener._o()))}),this.stream.uo(i=>{r(()=>this.e_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Uo(){var e=this;this.state=5,this.Qo.Mo((0,p.Z)(function*(){e.state=0,e.start()}))}e_(e){return b("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Zo(e){return t=>{this.ii.enqueueAndForget(()=>this.Lo===e?t():(b("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class kp extends Ud{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}t_(e,t){return this.connection.yo("Listen",e,t)}onMessage(e){this.Qo.reset();const t=function Kg(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(c=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===c?1:"REMOVE"===c?2:"CURRENT"===c?3:"RESET"===c?4:M(),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(F(void 0===l||"string"==typeof l),je.fromBase64String(l||"")):(F(void 0===l||l instanceof Uint8Array),je.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=void 0===c.code?T.UNKNOWN:Dh(c.code);return new R(l,c.message||"")}(o);t=new Fh(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=Gt(n,r.document.name),s=Le(r.document.updateTime),o=r.document.createTime?Le(r.document.createTime):L.min(),a=new Xe({mapValue:{fields:r.document.fields}}),u=Re.newFoundDocument(i,s,o,a);t=new ho(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,i=Gt(n,r.document),s=r.readTime?Le(r.readTime):L.min(),o=Re.newNoDocument(i,s);t=new ho([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=Gt(n,r.document);t=new ho([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return M();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new Fg(i,s);t=new Oh(r.targetId,o)}}var c;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return L.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?L.min():o.readTime?Le(o.readTime):L.min()}(e);return this.listener.n_(t,r)}r_(e){const t={};t.database=Zi(this.serializer),t.addTarget=function(s,o){let a;const u=o.target;if(a=ro(u)?{documents:Qh(s,u)}:{query:qa(s,u)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=qh(s,o.resumeToken);const c=Fa(s,o.expectedCount);null!==c&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(L.min())>0){a.readTime=Gr(s,o.snapshotVersion.toTimestamp());const c=Fa(s,o.expectedCount);null!==c&&(a.expectedCount=c)}return a}(this.serializer,e);const r=function Wg(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.jo(t)}i_(e){const t={};t.database=Zi(this.serializer),t.removeTarget=e,this.jo(t)}}class Mp extends Ud{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.s_=!1}get o_(){return this.s_}start(){this.s_=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.s_&&this.__([])}t_(e,t){return this.connection.yo("Write",e,t)}onMessage(e){if(F(!!e.streamToken),this.lastStreamToken=e.streamToken,this.s_){this.Qo.reset();const t=function Qg(n,e){return n&&n.length>0?(F(void 0!==e),n.map(t=>function(i,s){let o=Le(i.updateTime?i.updateTime:s);return o.isEqual(L.min())&&(o=Le(s)),new Ng(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Le(e.commitTime);return this.listener.a_(r,t)}return F(!e.writeResults||0===e.writeResults.length),this.s_=!0,this.listener.u_()}c_(){const e={};e.database=Zi(this.serializer),this.jo(e)}__(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Yi(this.serializer,r))};this.jo(t)}}class Op extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.l_=!1}h_(){if(this.l_)throw new R(T.FAILED_PRECONDITION,"The client has already been terminated.")}Ro(e,t,r){return this.h_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Ro(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===T.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new R(T.UNKNOWN,i.toString())})}po(e,t,r,i){return this.h_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.po(e,t,r,s,o,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===T.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new R(T.UNKNOWN,s.toString())})}terminate(){this.l_=!0}}class Lp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.I_=0,this.T_=null,this.E_=!0}d_(){0===this.I_&&(this.A_("Unknown"),this.T_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.T_=null,this.R_("Backend didn't respond within 10 seconds."),this.A_("Offline"),Promise.resolve())))}V_(e){"Online"===this.state?this.A_("Unknown"):(this.I_++,this.I_>=1&&(this.m_(),this.R_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.A_("Offline")))}set(e){this.m_(),this.I_=0,"Online"===e&&(this.E_=!1),this.A_(e)}A_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}R_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.E_?(Fe(t),this.E_=!1):b("OnlineStateTracker",t)}m_(){null!==this.T_&&(this.T_.cancel(),this.T_=null)}}class Bp{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.f_=[],this.g_=new Map,this.p_=new Set,this.y_=[],this.w_=s,this.w_.Ys(a=>{r.enqueueAndForget((0,p.Z)(function*(){var u;Dn(o)&&(b("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(l){const h=k(l);h.p_.add(4),yield Hr(h),h.S_.set("Unknown"),h.p_.delete(4),yield as(h)}),function c(l){return u.apply(this,arguments)})(o))}))}),this.S_=new Lp(r,i)}}function as(n){return du.apply(this,arguments)}function du(){return du=(0,p.Z)(function*(n){if(Dn(n))for(const e of n.y_)yield e(!0)}),du.apply(this,arguments)}function Hr(n){return fu.apply(this,arguments)}function fu(){return fu=(0,p.Z)(function*(n){for(const e of n.y_)yield e(!1)}),fu.apply(this,arguments)}function Vo(n,e){const t=k(n);t.g_.has(e.targetId)||(t.g_.set(e.targetId,e),pu(t)?gu(t):Yr(t).$o()&&mu(t,e))}function us(n,e){const t=k(n),r=Yr(t);t.g_.delete(e),r.$o()&&qd(t,e),0===t.g_.size&&(r.$o()?r.Go():Dn(t)&&t.S_.set("Unknown"))}function mu(n,e){if(n.b_.Be(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(L.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Yr(n).r_(e)}function qd(n,e){n.b_.Be(e),Yr(n).i_(e)}function gu(n){n.b_=new Bg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>n.g_.get(e)||null,rt:()=>n.datastore.serializer.databaseId}),Yr(n).start(),n.S_.d_()}function pu(n){return Dn(n)&&!Yr(n).Ko()&&n.g_.size>0}function Dn(n){return 0===k(n).p_.size}function zd(n){n.b_=void 0}function Up(n){return _u.apply(this,arguments)}function _u(){return _u=(0,p.Z)(function*(n){n.g_.forEach((e,t)=>{mu(n,e)})}),_u.apply(this,arguments)}function qp(n,e){return yu.apply(this,arguments)}function yu(){return yu=(0,p.Z)(function*(n,e){zd(n),pu(n)?(n.S_.V_(e),gu(n)):n.S_.set("Unknown")}),yu.apply(this,arguments)}function zp(n,e,t){return Iu.apply(this,arguments)}function Iu(){return Iu=(0,p.Z)(function*(n,e,t){if(n.S_.set("Online"),e instanceof Fh&&2===e.state&&e.cause)try{yield(r=(0,p.Z)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.g_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.g_.delete(u),s.b_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){b("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield xo(n,r)}else if(e instanceof ho?n.b_.We(e):e instanceof Oh?n.b_.Ze(e):n.b_.je(e),!t.isEqual(L.min()))try{const r=yield xd(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.b_.st(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){const l=s.g_.get(c);l&&s.g_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{const l=s.g_.get(u);if(!l)return;s.g_.set(u,l.withResumeToken(je.EMPTY_BYTE_STRING,l.snapshotVersion)),qd(s,u);const h=new nn(l.target,u,c,l.sequenceNumber);mu(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){b("RemoteStore","Failed to raise snapshot:",r),yield xo(n,r)}var r}),Iu.apply(this,arguments)}function xo(n,e,t){return Eu.apply(this,arguments)}function Eu(){return Eu=(0,p.Z)(function*(n,e,t){if(!En(e))throw e;n.p_.add(1),yield Hr(n),n.S_.set("Offline"),t||(t=()=>xd(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){b("RemoteStore","Retrying IndexedDB access"),yield t(),n.p_.delete(1),yield as(n)}))}),Eu.apply(this,arguments)}function Gd(n,e){return e().catch(t=>xo(n,t,e))}function Zr(n){return Tu.apply(this,arguments)}function Tu(){return Tu=(0,p.Z)(function*(n){const e=k(n),t=Nn(e);let r=e.f_.length>0?e.f_[e.f_.length-1].batchId:-1;for(;Gp(e);)try{const i=yield Sp(e.localStore,r);if(null===i){0===e.f_.length&&t.Go();break}r=i.batchId,jp(e,i)}catch(i){yield xo(e,i)}jd(e)&&$d(e)}),Tu.apply(this,arguments)}function Gp(n){return Dn(n)&&n.f_.length<10}function jp(n,e){n.f_.push(e);const t=Nn(n);t.$o()&&t.o_&&t.__(e.mutations)}function jd(n){return Dn(n)&&!Nn(n).Ko()&&n.f_.length>0}function $d(n){Nn(n).start()}function $p(n){return vu.apply(this,arguments)}function vu(){return vu=(0,p.Z)(function*(n){Nn(n).c_()}),vu.apply(this,arguments)}function Kp(n){return wu.apply(this,arguments)}function wu(){return wu=(0,p.Z)(function*(n){const e=Nn(n);for(const t of n.f_)e.__(t.mutations)}),wu.apply(this,arguments)}function Qp(n,e,t){return Au.apply(this,arguments)}function Au(){return Au=(0,p.Z)(function*(n,e,t){const r=n.f_.shift(),i=Na.from(r,e,t);yield Gd(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Zr(n)}),Au.apply(this,arguments)}function Wp(n,e){return Ru.apply(this,arguments)}function Ru(){return Ru=(0,p.Z)(function*(n,e){var t;e&&Nn(n).o_&&(yield(t=(0,p.Z)(function*(i,s){if(Ch(a=s.code)&&a!==T.ABORTED){const o=i.f_.shift();Nn(i).Wo(),yield Gd(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Zr(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),jd(n)&&$d(n)}),Ru.apply(this,arguments)}function Kd(n,e){return Pu.apply(this,arguments)}function Pu(){return Pu=(0,p.Z)(function*(n,e){const t=k(n);t.asyncQueue.verifyOperationInProgress(),b("RemoteStore","RemoteStore received new credentials");const r=Dn(t);t.p_.add(3),yield Hr(t),r&&t.S_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.p_.delete(3),yield as(t)}),Pu.apply(this,arguments)}function Su(n,e){return bu.apply(this,arguments)}function bu(){return bu=(0,p.Z)(function*(n,e){const t=k(n);e?(t.p_.delete(2),yield as(t)):e||(t.p_.add(2),yield Hr(t),t.S_.set("Unknown"))}),bu.apply(this,arguments)}function Yr(n){return n.D_||(n.D_=function(t,r,i){const s=k(t);return s.h_(),new kp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{_o:Up.bind(null,n),uo:qp.bind(null,n),n_:zp.bind(null,n)}),n.y_.push(function(){var e=(0,p.Z)(function*(t){t?(n.D_.Wo(),pu(n)?gu(n):n.S_.set("Unknown")):(yield n.D_.stop(),zd(n))});return function(t){return e.apply(this,arguments)}}())),n.D_}function Nn(n){return n.v_||(n.v_=function(t,r,i){const s=k(t);return s.h_(),new Mp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{_o:$p.bind(null,n),uo:Wp.bind(null,n),u_:Kp.bind(null,n),a_:Qp.bind(null,n)}),n.y_.push(function(){var e=(0,p.Z)(function*(t){t?(n.v_.Wo(),yield Zr(n)):(yield n.v_.stop(),n.f_.length>0&&(b("RemoteStore",`Stopping write stream with ${n.f_.length} pending writes`),n.f_=[]))});return function(t){return e.apply(this,arguments)}}())),n.v_}class Vu{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ge,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new Vu(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new R(T.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Jr(n,e){if(Fe("AsyncQueue",`${e}: ${n}`),En(n))return new R(T.UNAVAILABLE,`${e}: ${n}`);throw n}class Xr{constructor(e){this.comparator=e?(t,r)=>e(t,r)||N.comparator(t.key,r.key):(t,r)=>N.comparator(t.key,r.key),this.keyedMap=zi(),this.sortedSet=new Te(this.comparator)}static emptySet(e){return new Xr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Xr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Xr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Qd{constructor(){this.C_=new Te(N.comparator)}track(e){const t=e.doc.key,r=this.C_.get(t);r?0!==e.type&&3===r.type?this.C_=this.C_.insert(t,e):3===e.type&&1!==r.type?this.C_=this.C_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.C_=this.C_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.C_=this.C_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.C_=this.C_.remove(t):1===e.type&&2===r.type?this.C_=this.C_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.C_=this.C_.insert(t,{type:2,doc:e.doc}):M():this.C_=this.C_.insert(t,e)}F_(){const e=[];return this.C_.inorderTraversal((t,r)=>{e.push(r)}),e}}class ei{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new ei(e,t,Xr.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ui(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class Hp{constructor(){this.M_=void 0,this.listeners=[]}}class Zp{constructor(){this.queries=new en(e=>dh(e),Ui),this.onlineState="Unknown",this.x_=new Set}}function xu(n,e){return Cu.apply(this,arguments)}function Cu(){return Cu=(0,p.Z)(function*(n,e){const t=k(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new Hp),i)try{s.M_=yield t.onListen(r)}catch(o){const a=Jr(o,`Initialization of query '${Va(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.listeners.push(e),e.O_(t.onlineState),s.M_&&e.N_(s.M_)&&ku(t)}),Cu.apply(this,arguments)}function Du(n,e){return Nu.apply(this,arguments)}function Nu(){return Nu=(0,p.Z)(function*(n,e){const t=k(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Nu.apply(this,arguments)}function Yp(n,e){const t=k(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.listeners)a.N_(i)&&(r=!0);o.M_=i}}r&&ku(t)}function Jp(n,e,t){const r=k(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function ku(n){n.x_.forEach(e=>{e.next()})}class Mu{constructor(e,t,r){this.query=e,this.B_=t,this.L_=!1,this.k_=null,this.onlineState="Unknown",this.options=r||{}}N_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new ei(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.L_?this.q_(e)&&(this.B_.next(e),t=!0):this.Q_(e,this.onlineState)&&(this.K_(e),t=!0),this.k_=e,t}onError(e){this.B_.error(e)}O_(e){this.onlineState=e;let t=!1;return this.k_&&!this.L_&&this.Q_(this.k_,e)&&(this.K_(this.k_),t=!0),t}Q_(e,t){return!e.fromCache||(!this.options.U_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}q_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.k_&&this.k_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}K_(e){e=ei.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.L_=!0,this.B_.next(e)}}class Xp{constructor(e,t){this.W_=e,this.byteLength=t}G_(){return"metadata"in this.W_}}class Wd{constructor(e){this.serializer=e}os(e){return Gt(this.serializer,e)}_s(e){return e.metadata.exists?Kh(this.serializer,e.document,!1):Re.newNoDocument(this.os(e.metadata.name),this.us(e.metadata.readTime))}us(e){return Le(e)}}class e_{constructor(e,t,r){this.z_=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Hd(e)}j_(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.W_.namedQuery)this.queries.push(e.W_.namedQuery);else if(e.W_.documentMetadata){this.documents.push({metadata:e.W_.documentMetadata}),e.W_.documentMetadata.exists||++t;const r=ae.fromString(e.W_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.W_.document&&(this.documents[this.documents.length-1].document=e.W_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}H_(e){const t=new Map,r=new Wd(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.os(i.metadata.name);for(const o of i.metadata.queries){const a=(t.get(o)||W()).add(s);t.set(o,a)}}return t}complete(){var e=this;return(0,p.Z)(function*(){const t=yield function bp(n,e,t,r){return ru.apply(this,arguments)}(e.localStore,new Wd(e.serializer),e.documents,e.z_.id),r=e.H_(e.documents);for(const i of e.queries)yield Vp(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,J_:e.collectionGroups,Y_:t}})()}}function Hd(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Zd{constructor(e){this.key=e}}class Yd{constructor(e){this.key=e}}class Jd{constructor(e,t){this.query=e,this.Z_=t,this.X_=null,this.hasCachedResults=!1,this.current=!1,this.ea=W(),this.mutatedKeys=W(),this.ta=mh(e),this.na=new Xr(this.ta)}get ra(){return this.Z_}ia(e,t){const r=t?t.sa:new Qd,i=t?t.na:this.na;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{const m=i.get(l),I=qi(this.query,h)?h:null,x=!!m&&this.mutatedKeys.has(m.key),C=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations);let D=!1;m&&I?m.data.isEqual(I.data)?x!==C&&(r.track({type:3,doc:I}),D=!0):this.oa(m,I)||(r.track({type:2,doc:I}),D=!0,(u&&this.ta(I,u)>0||c&&this.ta(I,c)<0)&&(a=!0)):!m&&I?(r.track({type:0,doc:I}),D=!0):m&&!I&&(r.track({type:1,doc:m}),D=!0,(u||c)&&(a=!0)),D&&(I?(o=o.add(I),s=C?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{na:o,sa:r,zi:a,mutatedKeys:s}}oa(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.na;this.na=e.na,this.mutatedKeys=e.mutatedKeys;const s=e.sa.F_();s.sort((c,l)=>function(m,I){const x=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M()}};return x(m)-x(I)}(c.type,l.type)||this.ta(c.doc,l.doc)),this._a(r);const o=t?this.aa():[],a=0===this.ea.size&&this.current?1:0,u=a!==this.X_;return this.X_=a,0!==s.length||u?{snapshot:new ei(this.query,e.na,i,s,e.mutatedKeys,0===a,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),ua:o}:{ua:o}}O_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({na:this.na,sa:new Qd,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{ua:[]}}ca(e){return!this.Z_.has(e)&&!!this.na.has(e)&&!this.na.get(e).hasLocalMutations}_a(e){e&&(e.addedDocuments.forEach(t=>this.Z_=this.Z_.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Z_=this.Z_.delete(t)),this.current=e.current)}aa(){if(!this.current)return[];const e=this.ea;this.ea=W(),this.na.forEach(r=>{this.ca(r.key)&&(this.ea=this.ea.add(r.key))});const t=[];return e.forEach(r=>{this.ea.has(r)||t.push(new Yd(r))}),this.ea.forEach(r=>{e.has(r)||t.push(new Zd(r))}),t}la(e){this.Z_=e.ss,this.ea=W();const t=this.ia(e.documents);return this.applyChanges(t,!0)}ha(){return ei.fromInitialDocuments(this.query,this.na,this.mutatedKeys,0===this.X_,this.hasCachedResults)}}class t_{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class n_{constructor(e){this.key=e,this.Pa=!1}}class r_{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ia={},this.Ta=new en(a=>dh(a),Ui),this.Ea=new Map,this.da=new Set,this.Aa=new Te(N.comparator),this.Ra=new Map,this.Va=new Ha,this.ma={},this.fa=new Map,this.ga=ar.On(),this.onlineState="Unknown",this.pa=void 0}get isPrimaryClient(){return!0===this.pa}}function i_(n,e){return Ou.apply(this,arguments)}function Ou(){return Ou=(0,p.Z)(function*(n,e){const t=sc(n);let r,i;const s=t.Ta.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.ha();else{const o=yield Qr(t.localStore,lt(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield Fu(t,e,r,"current"===a,o.resumeToken),t.isPrimaryClient&&Vo(t.remoteStore,o)}return i}),Ou.apply(this,arguments)}function Fu(n,e,t,r,i){return Lu.apply(this,arguments)}function Lu(){return Lu=(0,p.Z)(function*(n,e,t,r,i){n.ya=(h,m,I)=>{return(x=(0,p.Z)(function*(D,q,j,z){let te=q.view.ia(j);te.zi&&(te=yield Ao(D.localStore,q.query,!1).then(({documents:ot})=>q.view.ia(ot,te)));const pe=z&&z.targetChanges.get(q.targetId),de=q.view.applyChanges(te,D.isPrimaryClient,pe);return Wu(D,q.targetId,de.ua),de.snapshot}),function C(D,q,j,z){return x.apply(this,arguments)})(n,h,m,I);var x};const s=yield Ao(n.localStore,e,!0),o=new Jd(e,s.ss),a=o.ia(s.documents),u=Wi.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=o.applyChanges(a,n.isPrimaryClient,u);Wu(n,t,c.ua);const l=new t_(e,t,o);return n.Ta.set(e,l),n.Ea.has(t)?n.Ea.get(t).push(e):n.Ea.set(t,[e]),c.snapshot}),Lu.apply(this,arguments)}function s_(n,e){return Bu.apply(this,arguments)}function Bu(){return Bu=(0,p.Z)(function*(n,e){const t=k(n),r=t.Ta.get(e),i=t.Ea.get(r.targetId);if(i.length>1)return t.Ea.set(r.targetId,i.filter(s=>!Ui(s,e))),void t.Ta.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Wr(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),us(t.remoteStore,r.targetId),ti(t,r.targetId)}).catch(In))):(ti(t,r.targetId),yield Wr(t.localStore,r.targetId,!0))}),Bu.apply(this,arguments)}function Uu(){return Uu=(0,p.Z)(function*(n,e,t){const r=oc(n);try{const i=yield function(o,a){const u=k(o),c=be.now(),l=a.reduce((I,x)=>I.add(x.key),W());let h,m;return u.persistence.runTransaction("Locally write mutations","readwrite",I=>{let x=_t(),C=W();return u.Xi.getEntries(I,l).next(D=>{x=D,x.forEach((q,j)=>{j.isValidDocument()||(C=C.add(q))})}).next(()=>u.localDocuments.getOverlayedDocuments(I,x)).next(D=>{h=D;const q=[];for(const j of a){const z=Mg(j,h.get(j.key).overlayedDocument);null!=z&&q.push(new tn(j.key,z,Jl(z.value.mapValue),Ve.exists(!0)))}return u.mutationQueue.addMutationBatch(I,c,q,a)}).next(D=>{m=D;const q=D.applyToLocalDocumentSet(h,C);return u.documentOverlayCache.saveOverlays(I,D.batchId,q)})}).then(()=>({batchId:m.batchId,changes:ph(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.ma[o.currentUser.toKey()];c||(c=new Te($)),c=c.insert(a,u),o.ma[o.currentUser.toKey()]=c}(r,i.batchId,t),yield rn(r,i.changes),yield Zr(r.remoteStore)}catch(i){const s=Jr(i,"Failed to persist write");t.reject(s)}}),Uu.apply(this,arguments)}function Xd(n,e){return qu.apply(this,arguments)}function qu(){return qu=(0,p.Z)(function*(n,e){const t=k(n);try{const r=yield Pp(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Ra.get(s);o&&(F(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Pa=!0:i.modifiedDocuments.size>0?F(o.Pa):i.removedDocuments.size>0&&(F(o.Pa),o.Pa=!1))}),yield rn(t,r,e)}catch(r){yield In(r)}}),qu.apply(this,arguments)}function ef(n,e,t){const r=k(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.Ta.forEach((s,o)=>{const a=o.view.O_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=k(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(const m of h.listeners)m.O_(a)&&(c=!0)}),c&&ku(u)}(r.eventManager,e),i.length&&r.Ia.n_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function a_(n,e,t){return zu.apply(this,arguments)}function zu(){return zu=(0,p.Z)(function*(n,e,t){const r=k(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Ra.get(e),s=i&&i.key;if(s){let o=new Te(N.comparator);o=o.insert(s,Re.newNoDocument(s,L.min()));const a=W().add(s),u=new Qi(L.min(),new Map,new Te($),o,a);yield Xd(r,u),r.Aa=r.Aa.remove(s),r.Ra.delete(e),Hu(r)}else yield Wr(r.localStore,e,!1).then(()=>ti(r,e,t)).catch(In)}),zu.apply(this,arguments)}function u_(n,e){return Gu.apply(this,arguments)}function Gu(){return Gu=(0,p.Z)(function*(n,e){const t=k(n),r=e.batch.batchId;try{const i=yield Rp(t.localStore,e);Qu(t,r,null),Ku(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield rn(t,i)}catch(i){yield In(i)}}),Gu.apply(this,arguments)}function c_(n,e,t){return ju.apply(this,arguments)}function ju(){return ju=(0,p.Z)(function*(n,e,t){const r=k(n);try{const i=yield function(o,a){const u=k(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(F(null!==h),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);Qu(r,e,t),Ku(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield rn(r,i)}catch(i){yield In(i)}}),ju.apply(this,arguments)}function $u(){return $u=(0,p.Z)(function*(n,e){const t=k(n);Dn(t.remoteStore)||b("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const a=k(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(-1===r)return void e.resolve();const i=t.fa.get(r)||[];i.push(e),t.fa.set(r,i)}catch(r){const i=Jr(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),$u.apply(this,arguments)}function Ku(n,e){(n.fa.get(e)||[]).forEach(t=>{t.resolve()}),n.fa.delete(e)}function Qu(n,e,t){const r=k(n);let i=r.ma[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.ma[r.currentUser.toKey()]=i}}function ti(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ea.get(e))n.Ta.delete(r),t&&n.Ia.wa(r,t);n.Ea.delete(e),n.isPrimaryClient&&n.Va.Ar(e).forEach(r=>{n.Va.containsKey(r)||tf(n,r)})}function tf(n,e){n.da.delete(e.path.canonicalString());const t=n.Aa.get(e);null!==t&&(us(n.remoteStore,t),n.Aa=n.Aa.remove(e),n.Ra.delete(t),Hu(n))}function Wu(n,e,t){for(const r of t)r instanceof Zd?(n.Va.addReference(r.key,e),h_(n,r)):r instanceof Yd?(b("SyncEngine","Document no longer in limbo: "+r.key),n.Va.removeReference(r.key,e),n.Va.containsKey(r.key)||tf(n,r.key)):M()}function h_(n,e){const t=e.key,r=t.path.canonicalString();n.Aa.get(t)||n.da.has(r)||(b("SyncEngine","New document in limbo: "+t),n.da.add(r),Hu(n))}function Hu(n){for(;n.da.size>0&&n.Aa.size<n.maxConcurrentLimboResolutions;){const e=n.da.values().next().value;n.da.delete(e);const t=new N(ae.fromString(e)),r=n.ga.next();n.Ra.set(r,new n_(t)),n.Aa=n.Aa.insert(t,r),Vo(n.remoteStore,new nn(lt(Lr(t.path)),r,"TargetPurposeLimboResolution",wt.ae))}}function rn(n,e,t){return Zu.apply(this,arguments)}function Zu(){return Zu=(0,p.Z)(function*(n,e,t){const r=k(n),i=[],s=[],o=[];var a;r.Ta.isEmpty()||(r.Ta.forEach((a,u)=>{o.push(r.ya(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);const l=eu.qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Ia.n_(i),yield(a=(0,p.Z)(function*(c,l){const h=k(c);try{yield h.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>_.forEach(l,I=>_.forEach(I.Li,x=>h.persistence.referenceDelegate.addReference(m,I.targetId,x)).next(()=>_.forEach(I.ki,x=>h.persistence.referenceDelegate.removeReference(m,I.targetId,x)))))}catch(m){if(!En(m))throw m;b("LocalStore","Failed to update sequence numbers: "+m)}for(const m of l){const I=m.targetId;if(!m.fromCache){const x=h.Ji.get(I),D=x.withLastLimboFreeSnapshotVersion(x.snapshotVersion);h.Ji=h.Ji.insert(I,D)}}}),function u(c,l){return a.apply(this,arguments)})(r.localStore,s))}),Zu.apply(this,arguments)}function d_(n,e){return Yu.apply(this,arguments)}function Yu(){return Yu=(0,p.Z)(function*(n,e){const t=k(n);if(!t.currentUser.isEqual(e)){b("SyncEngine","User change. New user:",e.toKey());const r=yield Vd(t.localStore,e);t.currentUser=e,(s=t).fa.forEach(a=>{a.forEach(u=>{u.reject(new R(T.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.fa.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield rn(t,r.ts)}var s}),Yu.apply(this,arguments)}function f_(n,e){const t=k(n),r=t.Ra.get(e);if(r&&r.Pa)return W().add(r.key);{let i=W();const s=t.Ea.get(e);if(!s)return i;for(const o of s){const a=t.Ta.get(o);i=i.unionWith(a.view.ra)}return i}}function m_(n,e){return Ju.apply(this,arguments)}function Ju(){return Ju=(0,p.Z)(function*(n,e){const t=k(n),r=yield Ao(t.localStore,e.query,!0),i=e.view.la(r);return t.isPrimaryClient&&Wu(t,e.targetId,i.ua),i}),Ju.apply(this,arguments)}function g_(n,e){return Xu.apply(this,arguments)}function Xu(){return Xu=(0,p.Z)(function*(n,e){const t=k(n);return Nd(t.localStore,e).then(r=>rn(t,r))}),Xu.apply(this,arguments)}function p_(n,e,t,r){return ec.apply(this,arguments)}function ec(){return ec=(0,p.Z)(function*(n,e,t,r){const i=k(n),s=yield function(a,u){const c=k(a),l=k(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Dn(h,u).next(m=>m?c.localDocuments.getDocuments(h,m):_.resolve(null)))}(i.localStore,e);var u;null!==s?("pending"===t?yield Zr(i.remoteStore):"acknowledged"===t||"rejected"===t?(Qu(i,e,r||null),Ku(i,e),u=e,k(k(i.localStore).mutationQueue).Cn(u)):M(),yield rn(i,s)):b("SyncEngine","Cannot apply mutation batch with id: "+e)}),ec.apply(this,arguments)}function tc(){return tc=(0,p.Z)(function*(n,e){const t=k(n);if(sc(t),oc(t),!0===e&&!0!==t.pa){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield nf(t,r.toArray());t.pa=!0,yield Su(t.remoteStore,!0);for(const s of i)Vo(t.remoteStore,s)}else if(!1===e&&!1!==t.pa){const r=[];let i=Promise.resolve();t.Ea.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(ti(t,o),Wr(t.localStore,o,!0))),us(t.remoteStore,o)}),yield i,yield nf(t,r),function(o){const a=k(o);a.Ra.forEach((u,c)=>{us(a.remoteStore,c)}),a.Va.Rr(),a.Ra=new Map,a.Aa=new Te(N.comparator)}(t),t.pa=!1,yield Su(t.remoteStore,!1)}}),tc.apply(this,arguments)}function nf(n,e,t){return nc.apply(this,arguments)}function nc(){return nc=(0,p.Z)(function*(n,e,t){const r=k(n),i=[],s=[];for(const o of e){let a;const u=r.Ea.get(o);if(u&&0!==u.length){a=yield Qr(r.localStore,lt(u[0]));for(const c of u){const l=r.Ta.get(c),h=yield m_(r,l);h.snapshot&&s.push(h.snapshot)}}else{const c=yield Dd(r.localStore,o);a=yield Qr(r.localStore,c),yield Fu(r,rf(c),o,!1,a.resumeToken)}i.push(a)}return r.Ia.n_(s),i}),nc.apply(this,arguments)}function rf(n){return lh(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function y_(n){return t=k(n).localStore,k(k(t).persistence).Ni();var t}function I_(n,e,t,r){return rc.apply(this,arguments)}function rc(){return rc=(0,p.Z)(function*(n,e,t,r){const i=k(n);if(i.pa)return void b("SyncEngine","Ignoring unexpected query state notification.");const s=i.Ea.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield Nd(i.localStore,fh(s[0])),a=Qi.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,je.EMPTY_BYTE_STRING);yield rn(i,o,a);break}case"rejected":yield Wr(i.localStore,e,!0),ti(i,e,r);break;default:M()}}),rc.apply(this,arguments)}function E_(n,e,t){return ic.apply(this,arguments)}function ic(){return ic=(0,p.Z)(function*(n,e,t){const r=sc(n);if(r.pa){for(const i of e){if(r.Ea.has(i)){b("SyncEngine","Adding an already active target "+i);continue}const s=yield Dd(r.localStore,i),o=yield Qr(r.localStore,s);yield Fu(r,rf(s),o.targetId,!1,o.resumeToken),Vo(r.remoteStore,o)}for(const i of t)r.Ea.has(i)&&(yield Wr(r.localStore,i,!1).then(()=>{us(r.remoteStore,i),ti(r,i)}).catch(In))}}),ic.apply(this,arguments)}function sc(n){const e=k(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Xd.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=f_.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=a_.bind(null,e),e.Ia.n_=Yp.bind(null,e.eventManager),e.Ia.wa=Jp.bind(null,e.eventManager),e}function oc(n){const e=k(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=u_.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=c_.bind(null,e),e}class cs{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.serializer=os(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return bd(this.persistence,new Sd,e.initialUser,this.serializer)}createPersistence(e){return new Za(To.zr,this.serializer)}createSharedClientState(e){return new Fd}terminate(){var e=this;return(0,p.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class ac extends cs{constructor(e,t,r){super(),this.ba=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e),yield r.ba.initialize(r,e),yield oc(r.ba.syncEngine),yield Zr(r.ba.remoteStore),yield r.persistence.Vi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return bd(this.persistence,new Sd,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new yd(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new Qm(t,this.persistence);return new Km(e.asyncQueue,r)}createPersistence(e){const t=Xa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?it.withCacheSize(this.cacheSizeBytes):it.DEFAULT;return new Ja(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Bd(),bo(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Fd}}class sf extends ac{constructor(e,t){super(e,t,!1),this.ba=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e);const i=r.ba.syncEngine;r.sharedClientState instanceof uu&&(r.sharedClientState.syncEngine={Gs:p_.bind(null,i),zs:I_.bind(null,i),js:E_.bind(null,i),Ni:y_.bind(null,i),Ws:g_.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.Vi(function(){var s=(0,p.Z)(function*(o){yield function __(n,e){return tc.apply(this,arguments)}(r.ba.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=Bd();if(!uu.v(t))throw new R(T.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Xa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new uu(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ni{initialize(e,t){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>ef(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=d_.bind(null,r.syncEngine),yield Su(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Zp}createDatastore(e){const t=os(e.databaseInfo.databaseId),r=new Np(e.databaseInfo);return new Op(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>ef(this.syncEngine,t,0),a=Ld.v()?new Ld:new xp,new Bp(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){const h=new r_(i,s,o,a,u,c);return l&&(h.pa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,p.Z)(function*(r){const i=k(r);b("RemoteStore","RemoteStore shutting down."),i.p_.add(5),yield Hr(i),i.w_.shutdown(),i.S_.set("Unknown")}),function t(r){return e.apply(this,arguments)})(this.remoteStore);var e}}function of(n,e=10240){let t=0;return{read:()=>(0,p.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Co{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Da(this.observer.next,e)}error(e){this.observer.error?this.Da(this.observer.error,e):Fe("Uncaught Error in snapshot listener:",e.toString())}va(){this.muted=!0}Da(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class w_{constructor(e,t){this.Ca=e,this.serializer=t,this.metadata=new Ge,this.buffer=new Uint8Array,this.Fa=new TextDecoder("utf-8"),this.Ma().then(r=>{r&&r.G_()?this.metadata.resolve(r.W_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.W_)}`))},r=>this.metadata.reject(r))}close(){return this.Ca.cancel()}getMetadata(){var e=this;return(0,p.Z)(function*(){return e.metadata.promise})()}Sa(){var e=this;return(0,p.Z)(function*(){return yield e.getMetadata(),e.Ma()})()}Ma(){var e=this;return(0,p.Z)(function*(){const t=yield e.xa();if(null===t)return null;const r=e.Fa.decode(t),i=Number(r);isNaN(i)&&e.Oa(`length string (${r}) is not valid number`);const s=yield e.Na(i);return new Xp(JSON.parse(s),t.length+i)})()}Ba(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}xa(){var e=this;return(0,p.Z)(function*(){for(;e.Ba()<0&&!(yield e.La()););if(0===e.buffer.length)return null;const t=e.Ba();t<0&&e.Oa("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Na(e){var t=this;return(0,p.Z)(function*(){for(;t.buffer.length<e;)(yield t.La())&&t.Oa("Reached the end of bundle when more is expected.");const r=t.Fa.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Oa(e){throw this.Ca.cancel(),new Error(`Invalid bundle format: ${e}`)}La(){var e=this;return(0,p.Z)(function*(){const t=yield e.Ca.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class A_{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new R(T.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,p.Z)(function*(o,a){const u=k(o),c=Zi(u.serializer)+"/documents",l={documents:a.map(x=>Hi(u.serializer,x))},h=yield u.po("BatchGetDocuments",c,l,a.length),m=new Map;h.forEach(x=>{const C=function $g(n,e){return"found"in e?function(r,i){F(!!i.found);const s=Gt(r,i.found.name),o=Le(i.found.updateTime),a=i.found.createTime?Le(i.found.createTime):L.min(),u=new Xe({mapValue:{fields:i.found.fields}});return Re.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){F(!!i.missing),F(!!i.readTime);const s=Gt(r,i.missing),o=Le(i.readTime);return Re.newNoDocument(s,o)}(n,e):M()}(u.serializer,x);m.set(C.key.toString(),C)});const I=[];return a.forEach(x=>{const C=m.get(x.toString());F(!!C),I.push(C)}),I}),function s(o,a){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new zr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=N.fromPath(i);e.mutations.push(new Ca(s,e.precondition(s)))}),yield(r=(0,p.Z)(function*(s,o){const a=k(s),u=Zi(a.serializer)+"/documents",c={writes:o.map(l=>Yi(a.serializer,l))};yield a.Ro("Commit",u,c)}),function i(s,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw M();t=L.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new R(T.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(L.min())?Ve.exists(!1):Ve.updateTime(t):Ve.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(L.min()))throw new R(T.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ve.updateTime(t)}return Ve.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class R_{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.ka=r.maxAttempts,this.Qo=new lu(this.asyncQueue,"transaction_retry")}run(){this.ka-=1,this.qa()}qa(){var e=this;this.Qo.Mo((0,p.Z)(function*(){const t=new A_(e.datastore),r=e.Qa(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.Ka(s)}))}).catch(i=>{e.Ka(i)})}))}Qa(e){try{const t=this.updateFunction(e);return!Ni(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Ka(e){this.ka>0&&this.$a(e)?(this.ka-=1,this.asyncQueue.enqueueAndForget(()=>(this.qa(),Promise.resolve()))):this.deferred.reject(e)}$a(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Ch(t)}return!1}}class P_{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Qe.UNAUTHENTICATED,this.clientId=bl.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,p.Z)(function*(a){b("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(b("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,p.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new R(T.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Ge;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Jr(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Do(n,e){return uc.apply(this,arguments)}function uc(){return uc=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),b("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,p.Z)(function*(s){r.isEqual(s)||(yield Vd(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),uc.apply(this,arguments)}function cc(n,e){return lc.apply(this,arguments)}function lc(){return lc=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield hc(n);b("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>Kd(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>Kd(e.remoteStore,s)),n._onlineComponents=e}),lc.apply(this,arguments)}function af(n){return"FirebaseError"===n.name?n.code===T.FAILED_PRECONDITION||n.code===T.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function hc(n){return dc.apply(this,arguments)}function dc(){return dc=(0,p.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){b("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Do(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!af(t))throw t;bt("Error using user provided cache. Falling back to memory cache: "+t),yield Do(n,new cs)}}else b("FirestoreClient","Using default OfflineComponentProvider"),yield Do(n,new cs);return n._offlineComponents}),dc.apply(this,arguments)}function No(n){return fc.apply(this,arguments)}function fc(){return fc=(0,p.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(b("FirestoreClient","Using user provided OnlineComponentProvider"),yield cc(n,n._uninitializedComponentsProvider._online)):(b("FirestoreClient","Using default OnlineComponentProvider"),yield cc(n,new ni))),n._onlineComponents}),fc.apply(this,arguments)}function uf(n){return hc(n).then(e=>e.persistence)}function ko(n){return hc(n).then(e=>e.localStore)}function cf(n){return No(n).then(e=>e.remoteStore)}function mc(n){return No(n).then(e=>e.syncEngine)}function ri(n){return gc.apply(this,arguments)}function gc(){return gc=(0,p.Z)(function*(n){const e=yield No(n),t=e.eventManager;return t.onListen=i_.bind(null,e.syncEngine),t.onUnlisten=s_.bind(null,e.syncEngine),t}),gc.apply(this,arguments)}function hf(n,e,t={}){const r=new Ge;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,o,a,u,c){const l=new Co({next:m=>{o.enqueueAndForget(()=>Du(s,h));const I=m.docs.has(a);!I&&m.fromCache?c.reject(new R(T.UNAVAILABLE,"Failed to get document because the client is offline.")):I&&m.fromCache&&u&&"server"===u.source?c.reject(new R(T.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(m)},error:m=>c.reject(m)}),h=new Mu(Lr(a.path),l,{includeMetadataChanges:!0,U_:!0});return xu(s,h)}(yield ri(n),n.asyncQueue,e,t,r)})),r.promise}function df(n,e,t={}){const r=new Ge;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,o,a,u,c){const l=new Co({next:m=>{o.enqueueAndForget(()=>Du(s,h)),m.fromCache&&"server"===u.source?c.reject(new R(T.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(m)},error:m=>c.reject(m)}),h=new Mu(a,l,{includeMetadataChanges:!0,U_:!0});return xu(s,h)}(yield ri(n),n.asyncQueue,e,t,r)})),r.promise}function ff(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const mf=new Map;function pc(n,e,t){if(!t)throw new R(T.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function gf(n,e,t,r){if(!0===e&&!0===r)throw new R(T.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pf(n){if(!N.isDocumentKey(n))throw new R(T.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _f(n){if(N.isDocumentKey(n))throw new R(T.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Mo(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":M()}function ee(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new R(T.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Mo(n);throw new R(T.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function yf(n,e){if(e<=0)throw new R(T.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class If{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new R(T.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new R(T.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}gf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=ff(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new R(T.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new R(T.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new R(T.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ls{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new If({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new R(T.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new R(T.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new If(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new km;switch(r.type){case"firstParty":return new Lm(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new R(T.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=mf.get(t);r&&(b("ComponentProvider","Removing Datastore"),mf.delete(t),r.terminate())}(this),Promise.resolve()}}class et{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new et(this.firestore,e,this._query)}}class Pe{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new jt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pe(this.firestore,e,this._key)}}class jt extends et{constructor(e,t,r){super(e,t,Lr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pe(this.firestore,null,new N(e))}withConverter(e){return new jt(this.firestore,e,this._path)}}function Tf(n,e,...t){if(n=(0,Q.m9)(n),pc("collection","path",e),n instanceof ls){const r=ae.fromString(e,...t);return _f(r),new jt(n,null,r)}{if(!(n instanceof Pe||n instanceof jt))throw new R(T.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ae.fromString(e,...t));return _f(r),new jt(n.firestore,null,r)}}function Oo(n,e,...t){if(n=(0,Q.m9)(n),1===arguments.length&&(e=bl.V()),pc("doc","path",e),n instanceof ls){const r=ae.fromString(e,...t);return pf(r),new Pe(n,null,new N(r))}{if(!(n instanceof Pe||n instanceof jt))throw new R(T.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ae.fromString(e,...t));return pf(r),new Pe(n.firestore,n instanceof jt?n.converter:null,new N(r))}}function vf(n,e){return n=(0,Q.m9)(n),e=(0,Q.m9)(e),(n instanceof Pe||n instanceof jt)&&(e instanceof Pe||e instanceof jt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function _c(n,e){return n=(0,Q.m9)(n),e=(0,Q.m9)(e),n instanceof et&&e instanceof et&&n.firestore===e.firestore&&Ui(n._query,e._query)&&n.converter===e.converter}class O_{constructor(){this.Ua=Promise.resolve(),this.Wa=[],this.Ga=!1,this.za=[],this.ja=null,this.Ha=!1,this.Ja=!1,this.Ya=[],this.Qo=new lu(this,"async_queue_retry"),this.Za=()=>{const t=bo();t&&b("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Qo.Oo()};const e=bo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Za)}get isShuttingDown(){return this.Ga}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Xa(),this.eu(e)}enterRestrictedMode(e){if(!this.Ga){this.Ga=!0,this.Ja=e||!1;const t=bo();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Za)}}enqueue(e){if(this.Xa(),this.Ga)return new Promise(()=>{});const t=new Ge;return this.eu(()=>this.Ga&&this.Ja?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Wa.push(e),this.tu()))}tu(){var e=this;return(0,p.Z)(function*(){if(0!==e.Wa.length){try{yield e.Wa[0](),e.Wa.shift(),e.Qo.reset()}catch(t){if(!En(t))throw t;b("AsyncQueue","Operation failed with retryable error: "+t)}e.Wa.length>0&&e.Qo.Mo(()=>e.tu())}})()}eu(e){const t=this.Ua.then(()=>(this.Ha=!0,e().catch(r=>{throw this.ja=r,this.Ha=!1,Fe("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this.Ha=!1,r))));return this.Ua=t,t}enqueueAfterDelay(e,t,r){this.Xa(),this.Ya.indexOf(e)>-1&&(t=0);const i=Vu.createAndSchedule(this,e,t,r,s=>this.nu(s));return this.za.push(i),i}Xa(){this.ja&&M()}verifyOperationInProgress(){}ru(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.Ua,yield t}while(t!==e.Ua)})()}iu(e){for(const t of this.za)if(t.timerId===e)return!0;return!1}su(e){return this.ru().then(()=>{this.za.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.za)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ru()})}ou(e){this.Ya.push(e)}nu(e){const t=this.za.indexOf(e);this.za.splice(t,1)}}function yc(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class F_{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ge,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Se extends ls{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new O_,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||wf(this),this._firestoreClient.terminate()}}function Be(n){return n._firestoreClient||wf(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function wf(n){var e,t,r;const i=n._freezeSettings(),s=(u=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new mg(n._databaseId,u,n._persistenceKey,(l=i).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,ff(l.experimentalLongPollingOptions),l.useFetchStreams));var u,l;n._firestoreClient=new P_(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Af(n,e,t){const r=new Ge;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield Do(n,t),yield cc(n,e),r.resolve()}catch(i){const s=i;if(!af(s))throw s;bt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function Rf(n){if(n._initialized||n._terminated)throw new R(T.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class $t{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $t(je.fromBase64String(e))}catch(t){throw new R(T.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new $t(je.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class sn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new R(T.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ne(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cr{constructor(e){this._methodName=e}}class Fo{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new R(T.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new R(T.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return $(this._lat,e._lat)||$(this._long,e._long)}}const W_=/^__.*__$/;class H_{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new tn(e,this.data,this.fieldMask,t,this.fieldTransforms):new qr(e,this.data,t,this.fieldTransforms)}}class Pf{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new tn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Sf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M()}}class Lo{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this._u(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get au(){return this.settings.au}uu(e){return new Lo(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}cu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.uu({path:r,lu:!1});return i.hu(e),i}Pu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.uu({path:r,lu:!1});return i._u(),i}Iu(e){return this.uu({path:void 0,lu:!0})}Tu(e){return qo(e,this.settings.methodName,this.settings.Eu||!1,this.path,this.settings.du)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}_u(){if(this.path)for(let e=0;e<this.path.length;e++)this.hu(this.path.get(e))}hu(e){if(0===e.length)throw this.Tu("Document fields must not be empty");if(Sf(this.au)&&W_.test(e))throw this.Tu('Document fields cannot begin and end with "__"')}}class Z_{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||os(e)}Au(e,t,r,i=!1){return new Lo({au:e,methodName:t,du:r,path:Ne.emptyPath(),lu:!1,Eu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function lr(n){const e=n._freezeSettings(),t=os(n._databaseId);return new Z_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Bo(n,e,t,r,i,s={}){const o=n.Au(s.merge||s.mergeFields?2:0,e,t,i);vc("Data must be an object, but it was:",o,r);const a=xf(r,o);let u,c;if(s.merge)u=new pt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const h of s.mergeFields){const m=fs(e,h,t);if(!o.contains(m))throw new R(T.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);Df(l,m)||l.push(m)}u=new pt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new H_(new Xe(a),u,c)}class ds extends cr{_toFieldTransform(e){if(2!==e.au)throw e.Tu(1===e.au?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ds}}function bf(n,e,t){return new Lo({au:3,du:e.settings.du,methodName:n._methodName,lu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Ic extends cr{_toFieldTransform(e){return new ji(e.path,new Br)}isEqual(e){return e instanceof Ic}}class Y_ extends cr{constructor(e,t){super(e),this.Ru=t}_toFieldTransform(e){const t=bf(this,e,!0),r=this.Ru.map(s=>hr(s,t)),i=new er(r);return new ji(e.path,i)}isEqual(e){return this===e}}class J_ extends cr{constructor(e,t){super(e),this.Ru=t}_toFieldTransform(e){const t=bf(this,e,!0),r=this.Ru.map(s=>hr(s,t)),i=new tr(r);return new ji(e.path,i)}isEqual(e){return this===e}}class X_ extends cr{constructor(e,t){super(e),this.Vu=t}_toFieldTransform(e){const t=new Ur(e.serializer,Eh(e.serializer,this.Vu));return new ji(e.path,t)}isEqual(e){return this===e}}function Ec(n,e,t,r){const i=n.Au(1,e,t);vc("Data must be an object, but it was:",i,r);const s=[],o=Xe.empty();Tn(r,(u,c)=>{const l=Uo(e,u,t);c=(0,Q.m9)(c);const h=i.Pu(l);if(c instanceof ds)s.push(l);else{const m=hr(c,h);null!=m&&(s.push(l),o.set(l,m))}});const a=new pt(s);return new Pf(o,a,i.fieldTransforms)}function Tc(n,e,t,r,i,s){const o=n.Au(1,e,t),a=[fs(e,r,t)],u=[i];if(s.length%2!=0)throw new R(T.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)a.push(fs(e,s[m])),u.push(s[m+1]);const c=[],l=Xe.empty();for(let m=a.length-1;m>=0;--m)if(!Df(c,a[m])){const I=a[m];let x=u[m];x=(0,Q.m9)(x);const C=o.Pu(I);if(x instanceof ds)c.push(I);else{const D=hr(x,C);null!=D&&(c.push(I),l.set(I,D))}}const h=new pt(c);return new Pf(l,h,o.fieldTransforms)}function Vf(n,e,t,r=!1){return hr(t,n.Au(r?4:3,e))}function hr(n,e){if(Cf(n=(0,Q.m9)(n)))return vc("Unsupported field value:",e,n),xf(n,e);if(n instanceof cr)return function(r,i){if(!Sf(i.au))throw i.Tu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Tu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.lu&&4!==e.au)throw e.Tu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=hr(a,i.Iu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,Q.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return Eh(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=be.fromDate(r);return{timestampValue:Gr(i.serializer,s)}}if(r instanceof be){const s=new be(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Gr(i.serializer,s)}}if(r instanceof Fo)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof $t)return{bytesValue:qh(i.serializer,r._byteString)};if(r instanceof Pe){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Tu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:La(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Tu(`Unsupported field value: ${Mo(r)}`)}(n,e)}function xf(n,e){const t={};return Gl(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Tn(n,(r,i)=>{const s=hr(i,e.cu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function Cf(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof be||n instanceof Fo||n instanceof $t||n instanceof Pe||n instanceof cr)}function vc(n,e,t){if(!Cf(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=Mo(t);throw e.Tu("an object"===r?n+" a custom object":n+" "+r)}var i}function fs(n,e,t){if((e=(0,Q.m9)(e))instanceof sn)return e._internalPath;if("string"==typeof e)return Uo(n,e);throw qo("Field path arguments must be of type string or ",n,!1,void 0,t)}const ey=new RegExp("[~\\*/\\[\\]]");function Uo(n,e,t){if(e.search(ey)>=0)throw qo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new sn(...e.split("."))._internalPath}catch{throw qo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function qo(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new R(T.INVALID_ARGUMENT,a+n+u)}function Df(n,e){return n.some(t=>t.isEqual(e))}class ms{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Pe(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new ty(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(zo("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ty extends ms{data(){return super.data()}}function zo(n,e){return"string"==typeof e?Uo(n,e):e instanceof sn?e._internalPath:e._delegate._internalPath}function Nf(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new R(T.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class wc{}class gs extends wc{}function kn(n,e,...t){let r=[];e instanceof wc&&r.push(e),r=r.concat(t),function(s){const o=s.filter(u=>u instanceof ii).length,a=s.filter(u=>u instanceof ps).length;if(o>1||o>0&&a>0)throw new R(T.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class ps extends gs{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new ps(e,t,r)}_apply(e){const t=this._parse(e);return Ff(e._query,t),new et(e.firestore,e.converter,ba(e._query,t))}_parse(e){const t=lr(e.firestore);return function(s,o,a,u,c,l,h){let m;if(c.isKeyField()){if("array-contains"===l||"array-contains-any"===l)throw new R(T.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if("in"===l||"not-in"===l){Of(h,l);const I=[];for(const x of h)I.push(Mf(u,s,x));m={arrayValue:{values:I}}}else m=Mf(u,s,h)}else"in"!==l&&"not-in"!==l&&"array-contains-any"!==l||Of(h,l),m=Vf(a,"where",h,"in"===l||"not-in"===l);return X.create(c,l,m)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class ii extends wc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ii(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:me.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const u of a)Ff(o,u),o=ba(o,u)}(e._query,t),new et(e.firestore,e.converter,ba(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Ac extends gs{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ac(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new R(T.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new R(T.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const a=new Or(s,o);return function(c,l){if(null===Pa(c)){const h=so(c);null!==h&&Lf(0,h,l.field)}}(i,a),a}(e._query,this._field,this._direction);return new et(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new Xt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class Go extends gs{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Go(e,t,r)}_apply(e){return new et(e.firestore,e.converter,oo(e._query,this._limit,this._limitType))}}class jo extends gs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new jo(e,t,r)}_apply(e){const t=kf(e,this.type,this._docOrFields,this._inclusive);return new et(e.firestore,e.converter,(s=t,new Xt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class $o extends gs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new $o(e,t,r)}_apply(e){const t=kf(e,this.type,this._docOrFields,this._inclusive);return new et(e.firestore,e.converter,(s=t,new Xt((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function kf(n,e,t,r){if(t[0]=(0,Q.m9)(t[0]),t[0]instanceof ms)return function(s,o,a,u,c){if(!u)throw new R(T.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const l=[];for(const h of Xn(s))if(h.field.isKeyField())l.push(Yn(o,u.key));else{const m=u.data.field(h.field);if(Js(m))throw new R(T.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===m){const I=h.field.canonicalString();throw new R(T.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${I}' (used as the orderBy) does not exist.`)}l.push(m)}return new Sn(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=lr(n.firestore);return function(o,a,u,c,l,h){const m=o.explicitOrderBy;if(l.length>m.length)throw new R(T.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const I=[];for(let x=0;x<l.length;x++){const C=l[x];if(m[x].field.isKeyField()){if("string"!=typeof C)throw new R(T.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof C}`);if(!Sa(o)&&-1!==C.indexOf("/"))throw new R(T.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${C}' contains a slash.`);const D=o.path.child(ae.fromString(C));if(!N.isDocumentKey(D))throw new R(T.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);const q=new N(D);I.push(Yn(a,q))}else{const D=Vf(u,c,C);I.push(D)}}return new Sn(I,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Mf(n,e,t){if("string"==typeof(t=(0,Q.m9)(t))){if(""===t)throw new R(T.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Sa(e)&&-1!==t.indexOf("/"))throw new R(T.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ae.fromString(t));if(!N.isDocumentKey(r))throw new R(T.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Yn(n,new N(r))}if(t instanceof Pe)return Yn(n,t._key);throw new R(T.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Mo(t)}.`)}function Of(n,e){if(!Array.isArray(n)||0===n.length)throw new R(T.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ff(n,e){if(e.isInequality()){const r=so(n),i=e.field;if(null!==r&&!r.isEqual(i))throw new R(T.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);const s=Pa(n);null!==s&&Lf(0,i,s)}const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new R(T.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Lf(n,e,t){if(!t.isEqual(e))throw new R(T.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Rc{convertValue(e,t="none"){switch(Rn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ke(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Jt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw M()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Tn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Fo(ke(e.latitude),ke(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Xs(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Mi(e));default:return null}}convertTimestamp(e){const t=vn(e);return new be(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ae.fromString(e);F(Yh(r));const i=new wn(r.get(1),r.get(3)),s=new N(r.popFirst(5));return i.isEqual(t)||Fe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Ko(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class ly extends Rc{constructor(e){super(),this.firestore=e}convertBytes(e){return new $t(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pe(this.firestore,null,t)}}class dr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class on extends ms{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new _s(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(zo("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class _s extends on{data(e={}){return super.data(e)}}class Mn{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new dr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new _s(this._firestore,this._userDataWriter,r.key,r,new dr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new R(T.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new _s(i._firestore,i._userDataWriter,a.doc.key,a.doc,new dr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new _s(i._firestore,i._userDataWriter,a.doc.key,a.doc,new dr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return 0!==a.type&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:dy(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function dy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M()}}function Uf(n,e){return n instanceof on&&e instanceof on?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Mn&&e instanceof Mn&&n._firestore===e._firestore&&_c(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class On extends Rc{constructor(e){super(),this.firestore=e}convertBytes(e){return new $t(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pe(this.firestore,null,t)}}function qf(n,e,t){n=ee(n,Pe);const r=ee(n.firestore,Se),i=Ko(n.converter,e,t);return si(r,[Bo(lr(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,Ve.none())])}function zf(n,e,t,...r){n=ee(n,Pe);const i=ee(n.firestore,Se),s=lr(i);let o;return o="string"==typeof(e=(0,Q.m9)(e))||e instanceof sn?Tc(s,"updateDoc",n._key,e,t,r):Ec(s,"updateDoc",n._key,e),si(i,[o.toMutation(n._key,Ve.exists(!0))])}function Gf(n,...e){var t,r,i;n=(0,Q.m9)(n);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||yc(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(yc(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(i=h.complete)||void 0===i?void 0:i.bind(h)}let u,c,l;if(n instanceof Pe)c=ee(n.firestore,Se),l=Lr(n._key.path),u={next:h=>{e[o]&&e[o](Pc(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=ee(n,et);c=ee(h.firestore,Se),l=h._query;const m=new On(c);u={next:I=>{e[o]&&e[o](new Mn(c,m,h,I))},error:e[o+1],complete:e[o+2]},Nf(n._query)}return function(m,I,x,C){const D=new Co(C),q=new Mu(I,D,x);return m.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return xu(yield ri(m),q)})),()=>{D.va(),m.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return Du(yield ri(m),q)}))}}(Be(c),l,a,u)}function si(n,e){return function(r,i){const s=new Ge;return r.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function o_(n,e,t){return Uu.apply(this,arguments)}(yield mc(r),i,s)})),s.promise}(Be(n),e)}function Pc(n,e,t){const r=t.docs.get(e._key),i=new On(n);return new on(n,i,e._key,r,new dr(t.hasPendingWrites,t.fromCache),e.converter)}const xy={maxAttempts:5};class jf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=lr(e)}set(e,t,r){this._verifyNotCommitted();const i=Fn(e,this._firestore),s=Ko(i.converter,t,r),o=Bo(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,Ve.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Fn(e,this._firestore);let o;return o="string"==typeof(t=(0,Q.m9)(t))||t instanceof sn?Tc(this._dataReader,"WriteBatch.update",s._key,t,r,i):Ec(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Ve.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Fn(e,this._firestore);return this._mutations=this._mutations.concat(new zr(t._key,Ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new R(T.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Fn(n,e){if((n=(0,Q.m9)(n)).firestore!==e)throw new R(T.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Cy extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=lr(t)}get(t){const r=Fn(t,this._firestore),i=new ly(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return M();const o=s[0];if(o.isFoundDocument())return new ms(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new ms(this._firestore,i,r._key,null,r.converter);throw M()})}set(t,r,i){const s=Fn(t,this._firestore),o=Ko(s.converter,r,i),a=Bo(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){const o=Fn(t,this._firestore);let a;return a="string"==typeof(r=(0,Q.m9)(r))||r instanceof sn?Tc(this._dataReader,"Transaction.update",o._key,r,i,s):Ec(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Fn(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Fn(e,this._firestore),r=new On(this._firestore);return super.get(e).then(i=>new on(this._firestore,r,t._key,i._document,new dr(!1,!1),t.converter))}}function Sc(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new R("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Kf(){if(typeof Uint8Array>"u")throw new R("unimplemented","Uint8Arrays are not available in this environment.")}function Qf(){if(!function dg(){return typeof atob<"u"}())throw new R("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){Dr=re.SDK_VERSION,(0,re._registerComponent)(new se.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new Se(new Om(r.getProvider("auth-internal")),new Bm(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new R(T.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wn(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),(0,re.registerVersion)(Rl,"4.0.0",e),(0,re.registerVersion)(Rl,"4.0.0","esm2017")}();class ys{constructor(e){this._delegate=e}static fromBase64String(e){return Qf(),new ys($t.fromBase64String(e))}static fromUint8Array(e){return Kf(),new ys($t.fromUint8Array(e))}toBase64(){return Qf(),this._delegate.toBase64()}toUint8Array(){return Kf(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function bc(n){return function Uy(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class qy{enableIndexedDbPersistence(e,t){return function B_(n,e){Rf(n=ee(n,Se));const t=Be(n);if(t._uninitializedComponentsProvider)throw new R(T.FAILED_PRECONDITION,"SDK cache is already specified.");bt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new ni;return Af(t,i,new ac(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function U_(n){Rf(n=ee(n,Se));const e=Be(n);if(e._uninitializedComponentsProvider)throw new R(T.FAILED_PRECONDITION,"SDK cache is already specified.");bt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new ni;return Af(e,r,new sf(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function q_(n){if(n._initialized&&!n._terminated)throw new R(T.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ge;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(t=(0,p.Z)(function*(i){if(!Nt.v())return Promise.resolve();const s=i+"main";yield Nt.delete(s)}),function r(i){return t.apply(this,arguments)})(Xa(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Wf{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof wn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&bt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function Ef(n,e,t,r={}){var i;const s=(n=ee(n,ls))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&bt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=Qe.MOCK_USER;else{a=(0,Q.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new R(T.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Qe(c)}n._authCredentials=new Mm(new Pl(a,u))}}(this._delegate,e,t,r)}enableNetwork(){return function G_(n){return function S_(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield uf(n),t=yield cf(n);return e.setNetworkEnabled(!0),function(i){const s=k(i);return s.p_.delete(0),as(s)}(t)}))}(Be(n=ee(n,Se)))}(this._delegate)}disableNetwork(){return function j_(n){return function b_(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield uf(n),t=yield cf(n);return e.setNetworkEnabled(!1),(r=(0,p.Z)(function*(s){const o=k(s);o.p_.add(0),yield Hr(o),o.S_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(Be(n=ee(n,Se)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,gf("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function z_(n){return function(t){const r=new Ge;return t.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function l_(n,e){return $u.apply(this,arguments)}(yield mc(t),r)})),r.promise}(Be(n=ee(n,Se)))}(this._delegate)}onSnapshotsInSync(e){return function Ty(n,e){return function C_(n,e){const t=new Co(e);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return i=yield ri(n),s=t,k(i).x_.add(s),void s.next();var i,s})),()=>{t.va(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return i=yield ri(n),s=t,void k(i).x_.delete(s);var i,s}))}}(Be(n=ee(n,Se)),yc(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new R("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new oi(this,Tf(this._delegate,e))}catch(t){throw ht(t,"collection()","Firestore.collection()")}}doc(e){try{return new Vt(this,Oo(this._delegate,e))}catch(t){throw ht(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new dt(this,function M_(n,e){if(n=ee(n,ls),pc("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new R(T.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new et(n,null,(r=e,new Xt(ae.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw ht(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function Dy(n,e,t){n=ee(n,Se);const r=Object.assign(Object.assign({},xy),t);return function(s){if(s.maxAttempts<1)throw new R(T.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){const u=new Ge;return s.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const c=yield function lf(n){return No(n).then(e=>e.datastore)}(s);new R_(s.asyncQueue,c,a,o,u).run()})),u.promise}(Be(n),i=>e(new Cy(n,i)),r)}(this._delegate,t=>e(new Hf(this,t)))}batch(){return Be(this._delegate),new Zf(new jf(this._delegate,e=>si(this._delegate,e)))}loadBundle(e){return function $_(n,e){const t=Be(n=ee(n,Se)),r=new F_;return function D_(n,e,t,r){const i=function(o,a){let u;return u="string"==typeof o?Nh().encode(o):o,l=function(l,h){if(l instanceof Uint8Array)return of(l,h);if(l instanceof ArrayBuffer)return of(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),new w_(l,a);var l}(t,os(e));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function T_(n,e,t){const r=k(n);var i;(i=(0,p.Z)(function*(o,a,u){try{const c=yield a.getMetadata();if(yield function(x,C){const D=k(x),q=Le(C.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",j=>D.Qr.getBundleMetadata(j,C.id)).then(j=>!!j&&j.createTime.compareTo(q)>=0)}(o.localStore,c))return yield a.close(),u._completeWith({taskState:"Success",documentsLoaded:(x=c).totalDocuments,bytesLoaded:x.totalBytes,totalDocuments:x.totalDocuments,totalBytes:x.totalBytes}),Promise.resolve(new Set);u._updateProgress(Hd(c));const l=new e_(c,o.localStore,a.serializer);let h=yield a.Sa();for(;h;){const I=yield l.j_(h);I&&u._updateProgress(I),h=yield a.Sa()}const m=yield l.complete();return yield rn(o,m.Y_,void 0),yield function(x,C){const D=k(x);return D.persistence.runTransaction("Save bundle","readwrite",q=>D.Qr.saveBundleMetadata(q,C))}(o.localStore,c),u._completeWith(m.progress),Promise.resolve(m.J_)}catch(c){return bt("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}var x}),function s(o,a,u){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield mc(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function K_(n,e){return function N_(n,e){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(r,i){const s=k(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Qr.getNamedQuery(o,i))}(yield ko(n),e)}))}(Be(n=ee(n,Se)),e).then(t=>t?new et(n,null,t.query):null)}(this._delegate,e).then(t=>t?new dt(this,t):null)}}class Qo extends Rc{constructor(e){super(),this.firestore=e}convertBytes(e){return new ys(new $t(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Vt.forKey(t,this.firestore,null)}}class Hf{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Qo(e)}get(e){const t=mr(e);return this._delegate.get(t).then(r=>new Is(this._firestore,new on(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=mr(e);return r?(Sc("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=mr(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=mr(e);return this._delegate.delete(t),this}}class Zf{constructor(e){this._delegate=e}set(e,t,r){const i=mr(e);return r?(Sc("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=mr(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=mr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class fr{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new _s(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Es(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=fr.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new fr(e,new Qo(e),t),i.set(t,s)),s}}fr.INSTANCES=new WeakMap;class Vt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Qo(e)}static forPath(e,t,r){if(e.length%2!=0)throw new R("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Vt(t,new Pe(t._delegate,r,new N(e)))}static forKey(e,t,r){return new Vt(t,new Pe(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new oi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new oi(this.firestore,Tf(this._delegate,e))}catch(t){throw ht(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,Q.m9)(e))instanceof Pe&&vf(this._delegate,e)}set(e,t){t=Sc("DocumentReference.set",t);try{return t?qf(this._delegate,e,t):qf(this._delegate,e)}catch(r){throw ht(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?zf(this._delegate,e):zf(this._delegate,e,t,...r)}catch(i){throw ht(i,"updateDoc()","DocumentReference.update()")}}delete(){return function Iy(n){return si(ee(n.firestore,Se),[new zr(n._key,Ve.none())])}(this._delegate)}onSnapshot(...e){const t=Yf(e),r=Jf(e,i=>new Is(this.firestore,new on(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Gf(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function my(n){n=ee(n,Pe);const e=ee(n.firestore,Se),t=Be(e),r=new On(e);return function V_(n,e){const t=new Ge;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,o,a){try{const u=yield function(l,h){const m=k(l);return m.persistence.runTransaction("read document","readonly",I=>m.localDocuments.getDocument(I,h))}(s,o);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new R(T.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const c=Jr(u,`Failed to get document '${o} from cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield ko(n),e,t);var r})),t.promise}(t,n._key).then(i=>new on(e,r,n._key,i,new dr(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function gy(n){n=ee(n,Pe);const e=ee(n.firestore,Se);return hf(Be(e),n._key,{source:"server"}).then(t=>Pc(e,n,t))}(this._delegate):function fy(n){n=ee(n,Pe);const e=ee(n.firestore,Se);return hf(Be(e),n._key).then(t=>Pc(e,n,t))}(this._delegate),t.then(r=>new Is(this.firestore,new on(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Vt(this.firestore,this._delegate.withConverter(e?fr.getInstance(this.firestore,e):null))}}function ht(n,e,t){return n.message=n.message.replace(e,t),n}function Yf(n){for(const e of n)if("object"==typeof e&&!bc(e))return e;return{}}function Jf(n,e){var t,r;let i;return i=bc(n[0])?n[0]:bc(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Is{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Vt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Uf(this._delegate,e._delegate)}}class Es extends Is{data(e){const t=this._delegate.data(e);return function Nm(n,e){n||M()}(void 0!==t),t}}class dt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Qo(e)}where(e,t,r){try{return new dt(this.firestore,kn(this._delegate,function ny(n,e,t){const r=e,i=zo("where",n);return ps._create(i,r,t)}(e,t,r)))}catch(i){throw ht(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new dt(this.firestore,kn(this._delegate,function ry(n,e="asc"){const t=e,r=zo("orderBy",n);return Ac._create(r,t)}(e,t)))}catch(r){throw ht(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new dt(this.firestore,kn(this._delegate,function iy(n){return yf("limit",n),Go._create("limit",n,"F")}(e)))}catch(t){throw ht(t,"limit()","Query.limit()")}}limitToLast(e){try{return new dt(this.firestore,kn(this._delegate,function sy(n){return yf("limitToLast",n),Go._create("limitToLast",n,"L")}(e)))}catch(t){throw ht(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new dt(this.firestore,kn(this._delegate,function oy(...n){return jo._create("startAt",n,!0)}(...e)))}catch(t){throw ht(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new dt(this.firestore,kn(this._delegate,function ay(...n){return jo._create("startAfter",n,!1)}(...e)))}catch(t){throw ht(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new dt(this.firestore,kn(this._delegate,function uy(...n){return $o._create("endBefore",n,!1)}(...e)))}catch(t){throw ht(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new dt(this.firestore,kn(this._delegate,function cy(...n){return $o._create("endAt",n,!0)}(...e)))}catch(t){throw ht(t,"endAt()","Query.endAt()")}}isEqual(e){return _c(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function _y(n){n=ee(n,et);const e=ee(n.firestore,Se),t=Be(e),r=new On(e);return function x_(n,e){const t=new Ge;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,o,a){try{const u=yield Ao(s,o,!0),c=new Jd(o,u.ss),l=c.ia(u.documents),h=c.applyChanges(l,!1);a.resolve(h.snapshot)}catch(u){const c=Jr(u,`Failed to execute query '${o} against cache`);a.reject(c)}}),function i(s,o,a){return r.apply(this,arguments)})(yield ko(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Mn(e,r,n,i))}(this._delegate):"server"===e?.source?function yy(n){n=ee(n,et);const e=ee(n.firestore,Se),t=Be(e),r=new On(e);return df(t,n._query,{source:"server"}).then(i=>new Mn(e,r,n,i))}(this._delegate):function py(n){n=ee(n,et);const e=ee(n.firestore,Se),t=Be(e),r=new On(e);return Nf(n._query),df(t,n._query).then(i=>new Mn(e,r,n,i))}(this._delegate),t.then(r=>new Vc(this.firestore,new Mn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Yf(e),r=Jf(e,i=>new Vc(this.firestore,new Mn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Gf(this._delegate,t,r)}withConverter(e){return new dt(this.firestore,this._delegate.withConverter(e?fr.getInstance(this.firestore,e):null))}}class Gy{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Es(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Vc{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new dt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Es(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Gy(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Es(this._firestore,r))})}isEqual(e){return Uf(this._delegate,e._delegate)}}class oi extends dt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Vt(this.firestore,e):null}doc(e){try{return new Vt(this.firestore,void 0===e?Oo(this._delegate):Oo(this._delegate,e))}catch(t){throw ht(t,"doc()","CollectionReference.doc()")}}add(e){return function Ey(n,e){const t=ee(n.firestore,Se),r=Oo(n),i=Ko(n.converter,e);return si(t,[Bo(lr(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,Ve.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Vt(this.firestore,t))}isEqual(e){return vf(this._delegate,e._delegate)}withConverter(e){return new oi(this.firestore,this._delegate.withConverter(e?fr.getInstance(this.firestore,e):null))}}function mr(n){return ee(n,Pe)}class xc{constructor(...e){this._delegate=new sn(...e)}static documentId(){return new xc(Ne.keyField().canonicalString())}isEqual(e){return(e=(0,Q.m9)(e))instanceof sn&&this._delegate._internalPath.isEqual(e._internalPath)}}class gr{constructor(e){this._delegate=e}static serverTimestamp(){const e=function ky(){return new Ic("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new gr(e)}static delete(){const e=function Ny(){return new ds("deleteField")}();return e._methodName="FieldValue.delete",new gr(e)}static arrayUnion(...e){const t=function My(...n){return new Y_("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new gr(t)}static arrayRemove(...e){const t=function Oy(...n){return new J_("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new gr(t)}static increment(e){const t=function Fy(n){return new X_("increment",n)}(e);return t._methodName="FieldValue.increment",new gr(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const jy={Firestore:Wf,GeoPoint:Fo,Timestamp:be,Blob:ys,Transaction:Hf,WriteBatch:Zf,DocumentReference:Vt,DocumentSnapshot:Is,Query:dt,QueryDocumentSnapshot:Es,QuerySnapshot:Vc,CollectionReference:oi,FieldPath:xc,FieldValue:gr,setLogLevel:function zy(n){!function Dm(n){yn.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function Ky(n){(function $y(n,e){n.INTERNAL.registerComponent(new se.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},jy)))})(n,(e,t)=>new Wf(e,t,new qy)),n.registerVersion("@firebase/firestore-compat","0.3.13")}(ne.Z)},5861:(pr,ft,he)=>{function ne(re,se,Me,Q,$e,Ie,S){try{var P=re[Ie](S),v=P.value}catch(B){return void Me(B)}P.done?se(v):Promise.resolve(v).then(Q,$e)}function p(re){return function(){var se=this,Me=arguments;return new Promise(function(Q,$e){var Ie=re.apply(se,Me);function S(v){ne(Ie,Q,$e,S,P,"next",v)}function P(v){ne(Ie,Q,$e,S,P,"throw",v)}S(void 0)})}}he.d(ft,{Z:()=>p})}}]);